<!-- Add class="debug" to <main> for debugging -->
<main id="megaverse" class="xdebug">
  <div>
    <button class="metal linear" type="action" name="act_core">Core</button>
    <button class="metal linear" type="action" name="act_skills">Skills</button>
    <button class="metal linear" type="action" name="act_wp">WPs</button>
    <button class="metal linear" type="action" name="act_powersabilities">
      Abilities
    </button>
    <button class="metal linear" type="action" name="act_magic">Magic</button>
    <button class="metal linear" type="action" name="act_psionics">
      Psionics
    </button>
    <button class="metal linear" type="action" name="act_modifiers">
      Modifiers
    </button>
    <button class="metal linear" type="action" name="act_bonuses">
      Bonuses
    </button>
    <button class="metal linear" type="action" name="act_equipment">
      Equipment
    </button>
    <button class="metal linear" type="action" name="act_importexport">
      Imp/Exp
    </button>
    <img
      class="logo"
      src="https://db4sgowjqfwig.cloudfront.net/game_systems/22/assets/1100695/rifts-logo.png"
    />
  </div>
  <input type="hidden" class="tabstoggle" name="attr_sheetTab" value="core" />
  <!-- inject:partials/datalists.html -->
  <datalist id="distance-units">
  <option value="m"></option>
  <option value="km"></option>
  <option value="ft"></option>
  <option value="yd"></option>
  <option value="mi"></option>
</datalist>
<datalist id="damage-units">
  <option value="MDC"></option>
  <option value="SDC"></option>
</datalist>
<datalist id="time-units">
  <option value="seconds"></option>
  <option value="melees"></option>
  <option value="minutes"></option>
  <option value="hours"></option>
  <option value="days"></option>
  <option value="weeks"></option>
  <option value="months"></option>
  <option value="years"></option>
</datalist>
<datalist id="frequency-units">
  <option value="per second"></option>
  <option value="per melee"></option>
  <option value="per minute"></option>
  <option value="per hour"></option>
  <option value="per day"></option>
  <option value="per week"></option>
  <option value="per month"></option>
  <option value="per year"></option>
</datalist>
<datalist id="spell-schools">
  <option value="Invocation"></option>
  <option value="Elemental"></option>
  <option value="Necromancy"></option>
</datalist>
<datalist id="combat-modifiers">
  <option value="Custom - Type Your Own"></option>
  <option value="Hand to Hand: Basic"></option>
  <option value="Hand to Hand: Dragon"></option>
  <option value="RPA Basic"></option>
  <option value="RPA Elite: Glitter Boy"></option>
  <option value="Weapon: NG-P7"></option>
  <option value="Weapon: TW Flame Sword"></option>
  <option value="Armor: Crusader"></option>
  <option value="Power Armor: Glitter Boy"></option>
  <option value="TW: Armor of Ithan"></option>
  <option value="Spell: Superhuman Speed"></option>
  <option value="Psionic: Sixth Sense"></option>
  <option value="Magic Amulet: Charm"></option>
</datalist>
<datalist id="weapon-proficiencies">
  <option value="W.P. Archery"></option>
  <option value="W.P. Axe"></option>
  <option value="W.P. Blunt"></option>
  <option value="W.P. Chain"></option>
  <option value="W.P. Forked"></option>
  <option value="W.P. Knife"></option>
  <option value="W.P. Grappling Hook"></option>
  <option value="W.P. Pole Arm"></option>
  <option value="W.P. Rope"></option>
  <option value="W.P. Shield"></option>
  <option value="W.P. Spear"></option>
  <option value="W.P. Staff"></option>
  <option value="W.P. Sword"></option>
  <option value="W.P. Targeting"></option>
  <option value="W.P. Whip"></option>
</datalist>
<datalist id="weapon-proficiencies-modern">
  <option value="W.P. Handguns"></option>
  <option value="W.P. Rifles"></option>
  <option value="W.P. Energy Heavy"></option>
  <option value="W.P. Energy Pistol"></option>
  <option value="W.P. Energy Rifle"></option>
  <option value="W.P. Heavy"></option>
  <option value="W.P. Speargun"></option>
  <option value="W.P. Shotgun"></option>
  <option value="W.P. Submachinegun"></option>
  <option value="W.P. Flamethrower"></option>
</datalist>

  <!-- endinject -->

  <!-- inject:partials/core.html -->
  <div class="core">
  <br />
  <h1>Character Statistics</h1>
  <div class="grid-container">
    <div class="section-one character-background">
      <label
        ><span>Character Name</span>
        <input
          id="character-name"
          type="text"
          value=""
          name="attr_character_name"
      /></label>
      <label
        ><span>True Name</span>
        <input type="text" value="" name="attr_truename_name"
      /></label>
      <label
        ><span>Race</span>
        <input type="text" value="" name="attr_character_race"
      /></label>
      <label
        ><span>Character Class</span>
        <input type="text" value="" name="attr_occ"
      /></label>
      <label
        ><span>Strength Type</span>
        <select class="" name="attr_character_ps_type" value="normal">
          <option value="1">Normal</option>
          <option value="2">Augmented</option>
          <option value="3">Robotic</option>
          <option value="3.5">Giant Robotic</option>
          <option value="4">Supernatural</option>
        </select></label
      >
      <label
        ><span>Level</span> <input type="number" name="attr_character_level"
      /></label>
      <label
        ><span>Experience</span> <input type="number" name="attr_experience"
      /></label>
      <label
        ><span>Alignment</span>
        <select class="select" name="attr_alignment" value="0">
          <option value="0"></option>
          <option value="Principled">Principled</option>
          <option value="Scrupulous">Scrupulous</option>
          <option value="Unprincipled">Unprincipled</option>
          <option value="Anarchist">Anarchist</option>
          <option value="Taoist">Taoist</option>
          <option value="Miscreant">Miscreant</option>
          <option value="Abberant">Aberrant</option>
          <option value="Diabolic">Diabolic</option>
        </select></label
      >
      <label
        ><span>Age</span>
        <input
          class="attribute"
          type="number"
          value=""
          name="attr_character_age"
      /></label>
      <label
        ><span>Gender</span>
        <input type="text" value="" name="attr_character_gender"
      /></label>
      <label
        ><span>Height</span>
        <input type="text" value="" name="attr_character_height"
      /></label>
      <label
        ><span>Weight</span>
        <input type="text" value="" name="attr_character_weight"
      /></label>
      <label
        ><span>Family Origin</span>
        <input type="text" value="" name="attr_character_familyorigin"
      /></label>
      <label
        ><span>Environment</span>
        <input value="" name="attr_character_environment"
      /></label>
      <label
        ><span>Native Language(s)</span>
        <input type="text" value="" name="attr_character_languages"
      /></label>
      <label
        ><span>Insanity, if any</span>
        <input type="text" value="" name="attr_character_insanity"
      /></label>
      <label
        ><span>Disposition</span>
        <input type="text" value="" name="attr_character_disposition"
      /></label>
    </div>

    <div class="section-two">
      <div class="ss-2a">
        <label for="iq">I.Q.</label>
        <input
          id="iq"
          type="number"
          value="0"
          name="attr_iq"
          title="Intelligence Quotient"
        />
        <input
          class="attribute-bonus"
          type="number"
          value="0"
          name="attr_iq_bonus"
          title="+ Skills %"
          readonly
        />
        <input
          class="attribute-bonus"
          type="number"
          value="0"
          name="attr_perception_bonus"
          title="+ Perception (Rifter #13, p.16)"
          readonly
        />

        <label for="mental-endurance">M.E.</label>
        <input
          id="mental-endurance"
          type="number"
          value="0"
          name="attr_me"
          title="Mental Endurance"
        />
        <input
          class="attribute"
          type="number"
          value="0"
          name="attr_me_bonus"
          title="+ Save vs. Psionics"
          readonly
        />
        <div></div>

        <label for="mental-affinity">M.A.</label>
        <input
          id="mental-affinity"
          type="number"
          value="0"
          name="attr_ma"
          title="Mental Affinity"
        />
        <input
          type="number"
          value="0"
          name="attr_ma_bonus"
          title="% Trust/Intimidate"
          readonly
        />
        <div></div>

        <label for="physical-strength">P.S.</label>
        <input
          id="physical-strength"
          type="number"
          value="0"
          name="attr_ps"
          title="Physical Strength"
        />
        <input
          class="attribute"
          type="number"
          value="0"
          name="attr_ps_bonus"
          title="+ SDC Damage"
          readonly
        />
        <div></div>

        <label for="physical-prowess">P.P</label>
        <input
          id="physical-prowess"
          type="number"
          value="0"
          name="attr_pp"
          title="Physical Prowess"
        />
        <input
          class="attribute"
          type="number"
          value="0"
          name="attr_pp_bonus"
          title="+ Strike/Parry/Dodge/Entangle/Disarm"
          readonly
        />
        <div></div>

        <label for="physical-endurance">P.E.</label>
        <input
          id="physical-endurance"
          type="number"
          value="0"
          name="attr_pe"
          title="Physical Endurance"
        />
        <input
          class="attribute"
          type="number"
          value="0"
          name="attr_pe_bonus"
          title="+ Magic/Poison/Toxins"
          readonly
        />
        <input
          class="attribute"
          type="number"
          value="0"
          name="attr_pe_coma_bonus"
          title="+ Coma/Death %"
          readonly
        />

        <label for="physical-beauty">P.B.</label>
        <input
          id="physical-beauty"
          type="number"
          value="0"
          name="attr_pb"
          title="Physical Beauty"
        />
        <input
          class="attribute"
          type="number"
          value="0"
          name="attr_pb_bonus"
          title="% Charm/Impress"
          readonly
        />
        <div></div>

        <label for="speed">Spd</label>
        <input
          id="speed"
          type="number"
          value="0"
          name="attr_spd"
          title="Speed"
        />
      </div>
      <div class="ss-2b">
        <label for="trust-intimidate">Trust/Intimidate</label>
        <input
          id="trust-intimidate"
          type="number"
          value="0"
          name="attr_trust_intimidate"
        /><span>%</span>

        <label for="charm-impress">Charm/Impress</label>
        <input
          id="charm-impress"
          type="number"
          value="0"
          name="attr_charm_impress"
        /><span>%</span>
      </div>
      <div class="ss-2c">
        <label for="restrained-punch">Restrained Punch</label>
        <input
          id="restrained-punch"
          type="text"
          name="attr_restrained_punch"
          value="0"
        />
        <select name="attr_restrained_punch_unit" value="sdc">
          <option value="sdc">SDC</option>
          <option value="mdc">MDC</option>
        </select>

        <label for="punch">Punch</label>
        <input id="punch" type="text" name="attr_punch" value="0" />
        <select name="attr_punch_unit" value="sdc">
          <option value="sdc">SDC</option>
          <option value="mdc">MDC</option>
        </select>

        <label for="power-punch">Power Punch</label>
        <input id="power-punch" type="text" name="attr_power_punch" value="0" />
        <select name="attr_power_punch_unit" value="sdc">
          <option value="sdc">SDC</option>
          <option value="mdc">MDC</option>
        </select>

        <label for="kick">Kick</label>
        <input id="kick" type="text" name="attr_kick" value="0" />
        <select name="attr_kick_unit" value="sdc">
          <option value="sdc">SDC</option>
          <option value="mdc">MDC</option>
        </select>

        <label for="leap-kick">Leap Kick</label>
        <input id="leap-kick" type="text" name="attr_leap_kick" value="0" />
        <select name="attr_leap_kick_unit" value="sdc">
          <option value="sdc">SDC</option>
          <option value="mdc">MDC</option>
        </select>

        <label for="lift">Lift</label>
        <input id="lift" type="number" value="0" name="attr_lift" value="0" />
        <div>lbs</div>

        <label for="carry">Carry</label>
        <input id="carry" type="number" value="0" name="attr_carry" value="0" />
        <div>lbs</div>

        <label for="throw">Throw (&frac12; Carry)</label>
        <input
          id="throw"
          type="number"
          value="0"
          name="attr_throw_distance"
          value="0"
        />
        <div>Feet</div>

        <label for="carry-max">Carry Max</label>
        <input
          id="carry-max"
          type="number"
          value="0"
          name="attr_carry_max"
        />Minutes

        <label for="carry-running">Carry (Running)</label>
        <input
          id="carry-running"
          type="number"
          value="0"
          name="attr_carry_running"
        />Minutes

        <label for="hold-max">Hold Max.</label>
        <input
          id="hold-max"
          type="number"
          value="0"
          name="attr_hold_max"
        />Melees
      </div>
    </div>
    <div class="section-three">
      <label
        ><span>Hit Points</span>
        <input type="number" value="0" name="attr_character_hp" />
      </label>
      <label>
        <span>S.D.C.</span>
        <input type="number" value="0" name="attr_character_sdc" />
      </label>
      <label
        ><span>A.R.</span
        ><input type="number" value="0" name="attr_character_ar"
      /></label>
      <label
        ><span>M.D.C.</span>
        <input type="number" value="0" name="attr_character_mdc" />
      </label>
      <label
        ><span>P.P.E.</span>
        <input type="number" value="0" name="attr_character_ppe" />
      </label>
      <label
        ><span>I.S.P.</span
        ><input type="number" value="0" name="attr_character_isp"
      /></label>
      <label
        ><span>H.F.</span><input type="number" value="0" name="attr_hf"
      /></label>
      <label
        ><span>Perception</span>
        <input id="perception" type="number" value="0" name="attr_perception" />
        <button
          type="roll"
          value="Perception: [[d20+@{perception}]]"
          name="roll_perception"
        />
      </label>
    </div>
  </div>

  <h2>Movement</h2>
  <div class="movement-container">
    <div></div>
    <label for="mph">MPH</label>
    <label for="ft-melee">Ft/Melee</label>
    <label for="ft-attack">Ft/Attack</label>
    <label for="cruising">Cruising</label>
    <label for="run-at-max">Run at Max</label>
    <label>Run</label>
    <input id="mph" type="number" value="0" readonly name="attr_run_mph" />
    <input
      id="ft-melee"
      type="number"
      value="0"
      readonly
      name="attr_run_ft_melee"
    />
    <input
      id="ft-attack"
      type="number"
      value="0"
      readonly
      name="attr_run_ft_attack"
    />
    <input id="cruising" type="number" value="0" name="attr_run_cruising" />
    <div>
      <input
        id="run-at-max"
        type="number"
        value="0"
        disabled="true"
        name="attr_run_at_max"
      />
      minutes
    </div>

    <label>Leaping Distance</label>
    <input type="number" name="attr_leapup" value="0" />
    <div>feet up?</div>
    <input type="number" name="attr_leapout" value="0" />
    <div>feet out?</div>
    <div></div>
  </div>
  <br />
  <div class="repeating-movement">
    <fieldset class="repeating_movement">
      <h5>Additional Movement Type</h5>
      <h5>MPH</h5>
      <h5>Ft/Melee</h5>
      <h5>Ft/Attack</h5>
      <h5>Cruising</h5>
      <h5>Max speed duration</h5>
      <input type="text" value="" name="attr_name" />
      <input type="number" value="0" name="attr_mph" />
      <input type="number" value="0" name="attr_ft_melee" />
      <input type="number" value="0" name="attr_ft_attack" readonly />
      <input type="number" value="0" name="attr_cruising" />
      <label
        ><input type="number" value="0" name="attr_dur_at_max" /> minutes</label
      >
    </fieldset>
  </div>
</div>

  <!-- endinject -->

  <br />

  <!-- inject:partials/skills.html -->
  <div class="skills">
  <h3>Skills</h3>
  <details>
    <summary><b>Instructions</b></summary>
    <p>
      Note that skills include IQ bonus. New skills will default to level 1. All
      skills levels will increase with your character level, and recalculate the
      Total.
    </p>
    <p>
      Click the <b>&#9432;</b> icon to expand each row so you can copy/paste the
      skill description to make life easier for your GM. Note that each section
      includes a read-only Row ID that can be used in macros.
    </p>
  </details>
  <p>Click <b>Instructions</b> for detailed instructions.</p>
  <fieldset class="repeating_skills">
    <details class="info">
      <summary>
        <div class="values">
          <h5>Info</h5>
          <h5>Skill</h5>
          <h5>Category</h5>
          <h5>Base</h5>
          <h5>Bonus</h5>
          <h5>Per Level</h5>
          <h5>Level</h5>
          <h5>Total</h5>
          <h5></h5>
          <b class="click-expand"
            ><span title="Click for more info">&nbsp;&#9432;</span></b
          >
          <input type="text" value="" name="attr_name" />
          <select name="attr_category" value="occ">
            <option value="occ">O.C.C.</option>
            <option value="related">O.C.C. Related</option>
            <option value="secondary">Secondary</option>
          </select>
          <input type="number" value="0" name="attr_base" />
          <input type="number" value="0" name="attr_bonus" />
          <input type="number" value="0" name="attr_perlevel" />
          <input type="number" value="1" name="attr_level" />
          <input type="hidden" value="0" name="attr_total" />
          <span class="readonly" name="attr_total"></span>
          <button
            type="roll"
            value="@{character_name} @{name} check: [[d100<@{total}]]"
            name="roll_skill"
          />
        </div>
      </summary>
      <textarea class="full" name="attr_description" value=""></textarea>
      <div class="macro-help">
        <label
          ><span><b>Row ID:</b></span>
          <input type="text" readonly name="attr_rowid" value=""
        /></label>
      </div>
    </details>
  </fieldset>
</div>

  <!-- endinject -->

  <!-- inject:partials/weapon_proficiencies.html -->
  <div class="wp">
  <div class="wp-container">
    <details>
      <summary><b>Instructions</b></summary>
      <p>
        Add a row and select a WP from the list. Weapon Proficiencies
        <b>automatically</b> calculate their bonuses based on level.
      </p>
      <p>Weapon Proficiencies are automatically added to the Bonuses tab</p>
    </details>
    <p>Click <b>Instructions</b> for detailed instructions.</p>
    <h3>Ancient Weapon Proficiencies</h3>
    <fieldset class="repeating_wp">
      <h5>Weapon Proficiency</h5>
      <h5>Strike</h5>
      <h5>Parry</h5>
      <h5>Disarm</h5>
      <h5>Throw</h5>
      <h5>Entangle</h5>
      <h5>RoF</h5>
      <h5>Level</h5>
      <h5>Row ID</h5>
      <input type="hidden" name="attr_bonus_id" value="" />
      <input type="text" list="weapon-proficiencies" name="attr_name" />
      <input type="number" value="0" name="attr_strike" />
      <input type="number" value="0" name="attr_parry" />
      <input type="number" value="0" name="attr_disarm" />
      <input type="number" value="0" name="attr_throw" />
      <input type="number" value="0" name="attr_entangle" />
      <input type="number" value="0" name="attr_rof" />
      <input type="number" value="0" name="attr_level" />
      <input type="string" value="" name="attr_rowid" readonly />
    </fieldset>
    <hr />
    <h3>Modern Weapon Proficiencies</h3>
    <fieldset class="repeating_wpmodern">
      <h5>Weapon Proficiency</h5>
      <h5>Single</h5>
      <h5>Burst</h5>
      <h5>Level</h5>
      <h5>Row ID</h5>
      <input type="hidden" name="attr_bonus_id" value="" />
      <input type="text" list="weapon-proficiencies-modern" name="attr_name" />
      <input type="number" value="0" name="attr_strike_range_single" />
      <input type="number" value="0" name="attr_strike_range_burst" />
      <input type="number" value="0" name="attr_level" />
      <input type="text" value="" name="attr_rowid" readonly />
    </fieldset>
  </div>
</div>

  <!-- endinject -->

  <div class="powersabilities">
    <h3>Natural Abilities / Powers</h3>
    <details>
      <summary><b>Instructions</b></summary>
      <p>
        Enter some natural abilities/powers that are neither magic nor psionic
        in nature. Click the <b>&#9432;</b> icon to expand each row.
      </p>
      <p>
        Range, Duration, Frequency, Damage, D.C., and Skill are all calculated
        from the per-level values you enter in the details. For Starting Damage
        and Damage per Level enter values that roll20 would use for dice rolls.
        Ex. "4d6", "1d6", etc.
      </p>
      <!-- inject:partials/repeated_instructions.html -->
      <p>
  The Modifiers section has fields for <b>anything</b> that can be modified.
  Attributes, PS type, MDC, ISP, PPE, combat bonuses, saving throw bonuses, etc.
  This section is available for any Ability, Psionic, Magic, as well in its own
  Modifiers tab. If you have a magic amulet that gives +1 to save vs. magic,
  create an entry on the Modifier tab and add it. If you have an NG-P7 that does
  1d4*10 damage, create an entry on the Modifier tab and add it. Superhuman
  Speed sets your speed to an absolute value of 44 and adds +2 to parry and +6
  to dodge. Add those in the modifiers section in the spell details on the Magic
  tab. Use the <b>|x|</b> checkbox next to Spd to indicate that the value is
  absolute, and not additive. If adding a Magic Spell, Psionic, or Ability that
  includes modifiers, check the <b>Add to Bonuses</b> checkbox. This will make
  those modifiers available on the Bonuses tab to be used in a Profile (see the
  Bonuses tab instructions for details on Profiles).
</p>
<p>
  Note that each section includes a read-only Row ID that can be used in macros.
</p>
<p>
  Don't forget to copy/paste the power description into the Description field to
  make life easier for your GM. Also use that field for any macros you may need
  like Strike with an arbitrary bonus.
</p>

      <!-- endinject -->
    </details>
    <p>Click <b>Instructions</b> for detailed instructions.</p>
    <div class="repeating-bonuses-outer">
      <fieldset class="repeating_powersabilities">
        <details class="info">
          <!-- inject:partials/powersabilities.html -->
          <summary>
  <div class="abilities-list">
    <h5>Info</h5>
    <h5>Ability</h5>
    <h5>Range</h5>
    <h5>Duration</h5>
    <h5>Frequency</h5>
    <h5>Damage</h5>
    <h5></h5>
    <h5 title="Damage Capacity">D.C.</h5>
    <h5>Skill</h5>
    <h5></h5>
    <b class="click-expand"
      ><span title="Click for more info">&nbsp;&#9432;</span></b
    >
    <input type="text" value="" name="attr_name" />
    <input type="hidden" value="0" name="attr_range" />
    <span name="attr_range"></span>
    <input type="hidden" value="0" name="attr_duration" />
    <span name="attr_duration"></span>
    <input type="hidden" value="0" name="attr_frequency" />
    <span name="attr_frequency"></span>
    <input type="text" value="0" name="attr_damage" readonly />
    <button
      type="roll"
      value="@{character_name} @{name} [[@{damage}]] @{damage_unit}"
      name="roll_powerability_damage"
    />
    <input type="hidden" value="0" name="attr_dc" />
    <span name="attr_dc"></span>
    <input type="hidden" value="0" name="attr_percentage" />
    <span name="attr_percentage"></span>
    <button
      type="roll"
      value="@{character_name} @{name} check: [[d100<@{percentage}]]"
      name="roll_powerability_skill"
    />
  </div>
</summary>
<br />
<label
  ><input type="checkbox" name="attr_addtobonuses" value="1" /> Add to
  Bonuses</label
>
<br />
<div class="ability-details">
  <label
    ><span>Starting range</span
    ><input type="number" value="0" name="attr_range_starting"
  /></label>
  <label
    ><span>Range per level</span
    ><input type="number" value="0" name="attr_range_per_level"
  /></label>
  <label
    ><span>Range unit</span
    ><input type="text" value="" name="attr_range_unit" list="distance-units" />
  </label>
  <label
    ><span>Starting duration</span
    ><input type="number" value="0" name="attr_duration_starting"
  /></label>
  <label
    ><span>Duration per level</span
    ><input type="number" value="0" name="attr_duration_per_level"
  /></label>
  <label
    ><span>Duration unit</span
    ><input type="text" value="" name="attr_duration_unit" list="time-units" />
  </label>
  <label
    ><span>Starting frequency</span
    ><input type="number" value="0" name="attr_frequency_starting"
  /></label>
  <label
    ><span>Frequency per level</span
    ><input type="number" value="0" name="attr_frequency_per_level"
  /></label>
  <label
    ><span>Frequency unit</span
    ><input
      type="text"
      value=""
      name="attr_frequency_unit"
      list="frequency-units"
    />
  </label>
  <label
    ><span>Starting damage</span
    ><input type="text" value="0" name="attr_damage_starting"
  /></label>
  <label
    ><span>Damage per level</span
    ><input type="text" value="0" name="attr_damage_per_level"
  /></label>
  <label
    ><span>Damage unit</span
    ><input type="text" value="" name="attr_damage_unit" list="damage-units" />
  </label>
  <label
    ><span>Starting D.C.</span
    ><input type="number" value="0" name="attr_dc_starting"
  /></label>
  <label
    ><span>D.C. per level</span
    ><input type="number" value="0" name="attr_dc_per_level"
  /></label>
  <label
    ><span>D.C. unit</span
    ><input type="text" value="" name="attr_dc_unit" list="damage-units" />
  </label>
  <label
    ><span>Starting skill %</span
    ><input type="number" value="0" name="attr_percentage_starting"
  /></label>
  <label
    ><span>Skill % per level</span
    ><input type="number" value="0" name="attr_percentage_per_level"
  /></label>
  <label></label>
</div>

          <!-- endinject -->
          <h2>Modifiers</h2>
          <!-- inject:partials/repeating_bonuses_details.html -->
          <input type="hidden" name="attr_bonus_id" value="" />
<details>
  <summary>
    <h3>Attributes</h3>
  </summary>
  <div class="bonus-type-container attributes">
    <label
      ><span>I.Q.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_iq"
        title="Intelligence Quotient"
      />
      <label class="abs"
        ><input type="checkbox" value="1" name="attr_iq_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_iq_bonus"
        title="+ Skills %"
      />
      <span name="attr_mod_iq_bonus" title="+ Skills %"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_perception_bonus"
        title="+ Perception (Rifter #13, p.16)"
      />
      <span
        name="attr_mod_perception_bonus"
        title="+ Perception (Rifter #13, p.16)"
      ></span>
    </label>
    <label
      ><span>M.E.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_me"
        title="Mental Endurance"
      />
      <label class="abs"
        ><input type="checkbox" value="1" name="attr_me_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_me_bonus"
        title="+ Save vs. Psionics"
      />
      <span name="attr_mod_me_bonus" title="+ Save vs. Psionics"></span>
    </label>
    <label
      ><span>M.A.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_ma"
        title="Mental Affinity"
      /><label class="abs"
        ><input type="checkbox" value="1" name="attr_ma_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_ma_bonus"
        title="% Trust/Intimidate"
      />
      <span name="attr_mod_ma_bonus" title="% Trust/Intimidate"></span>
    </label>
    <label
      ><span>P.S.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_ps"
        title="Physical Strength"
      /><label class="abs"
        ><input type="checkbox" value="1" name="attr_ps_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_ps_bonus"
        title="+ SDC Damage"
      />
      <span name="attr_mod_ps_bonus" title="+ SDC Damage"></span>
    </label>
    <label
      ><span>P.P.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_pp"
        title="Physical Prowess"
      /><label class="abs"
        ><input type="checkbox" value="1" name="attr_pp_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_pp_bonus"
        title="+ Strike/Parry/Dodge/Entangle/Disarm"
      />
      <span
        name="attr_mod_pp_bonus"
        title="+ Strike/Parry/Dodge/Entangle/Disarm"
      ></span>
    </label>
    <label
      ><span>P.E.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_pe"
        title="Physical Endurance"
      /><label class="abs"
        ><input type="checkbox" value="1" name="attr_pe_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_pe_bonus"
        title="+ Magic/Poison/Toxins"
      />
      <span name="attr_mod_pe_bonus" title="+ Magic/Poison/Toxins"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_pe_coma_bonus"
        title="+ Coma/Death %"
      />
      <span name="attr_mod_pe_coma_bonus" title="+ Coma/Death %"></span>
    </label>
    <label
      ><span>P.B.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_pb"
        title="Physical Beauty"
      /><label class="abs"
        ><input type="checkbox" value="1" name="attr_pb_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_pb_bonus"
        title="% Charm/Impress"
      />
      <span name="attr_mod_pb_bonus" title="% Charm/Impress"></span>
    </label>
    <label
      ><span>Spd</span>
      <input type="number" value="0" name="attr_mod_spd" title="Speed" /><label
        class="abs"
        ><input type="checkbox" value="1" name="attr_spd_abs" />|x|</label
      ></label
    >
  </div>
  <hr />
  <div class="bonus-ps-container">
    <label class="select"
      ><span>PS Type</span>
      <select class="" name="attr_mod_character_ps_type" value="normal">
        <option value="1">Normal</option>
        <option value="2">Augmented</option>
        <option value="3">Robotic</option>
        <option value="3.5">Giant Robotic</option>
        <option value="4">Supernatural</option>
      </select></label
    >
    <label
      ><span>Restrained Punch</span>
      <input type="text" name="attr_mod_restrained_punch" value="0" />
      <select name="attr_mod_restrained_punch_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Punch</span>
      <input type="text" name="attr_mod_punch" value="0" />
      <select name="attr_mod_punch_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Power Punch</span>
      <input type="text" name="attr_mod_power_punch" value="0" />
      <select name="attr_mod_power_punch_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Kick</span>
      <input type="text" name="attr_mod_kick" value="0" />
      <select name="attr_mod_kick_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Leap Kick</span>
      <input type="text" name="attr_mod_leap_kick" value="0" />
      <select name="attr_mod_leap_kick_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select>
    </label>

    <label
      ><span>Lift</span>
      <input type="number" value="0" name="attr_mod_lift" value="0" />
      <span>lbs</span>
    </label>

    <label
      ><span>Carry</span>
      <input type="number" value="0" name="attr_mod_carry" value="0" />
      <span>lbs</span></label
    >

    <label
      ><span>Throw (&frac12; Carry)</span>
      <input type="number" value="0" name="attr_mod_throw_distance" value="0" />
      <span>Feet</span></label
    >

    <label
      ><span>Carry Max</span>
      <input type="number" value="0" name="attr_mod_carry_max" /><span
        >Minutes</span
      ></label
    >

    <label
      ><span>Carry (Running)</span>
      <input type="number" value="0" name="attr_mod_carry_running" /><span
        >Minutes</span
      ></label
    >

    <label
      ><span>Hold Max.</span>
      <input type="number" value="0" name="attr_mod_hold_max" /><span
        >Melees</span
      ></label
    >
  </div>
  <hr />
</details>
<div class="bonus-type-container">
  <label
    ><span title="Hit Points">H.P.</span
    ><input type="number" value="0" name="attr_hp"
  /></label>
  <label
    ><span>S.D.C.</span><input type="number" value="0" name="attr_sdc"
  /></label>
  <label
    ><span>A.R.</span><input type="number" value="0" name="attr_ar"
  /></label>
  <label
    ><span>M.D.C.</span><input type="number" value="0" name="attr_mdc"
  /></label>
  <label
    ><span>P.P.E.</span><input type="number" value="0" name="attr_ppe"
  /></label>
  <label
    ><span>I.S.P.</span><input type="number" value="0" name="attr_isp"
  /></label>
  <label
    ><span>H.F.</span><input type="number" value="0" name="attr_mod_hf" /><label
      class="abs"
      ><input type="checkbox" value="1" name="attr_hf_abs" />|x|</label
    ></label
  >
</div>
<hr />
<h3>Combat</h3>
<div class="bonus-type-container">
  <label
    ><span>Attacks</span>
    <input type="number" value="0" name="attr_attacks" />
  </label>
  <label
    ><span>Initiative</span>
    <input type="number" value="0" name="attr_initiative" />
    <button
      type="roll"
      value="Initiative: [[d20+@{initiative}]]"
      name="roll_bonus_initiative"
    />
  </label>
  <label
    ><span>Strike</span>
    <input type="number" value="0" name="attr_strike" />
    <button
      type="roll"
      value="Strike: [[d20+@{strike}]]"
      name="roll_bonus_strike"
    />
  </label>
  <label
    ><span>Parry</span>
    <input type="number" value="0" name="attr_parry" />
    <button
      type="roll"
      value="Parry: [[d20+@{parry}]]"
      name="roll_bonus_parry"
    />
  </label>
  <label
    ><span>Dodge</span>
    <input type="number" value="0" name="attr_dodge" />
    <button
      type="roll"
      value="Dodge: [[d20+@{dodge}]]"
      name="roll_bonus_dodge"
    />
  </label>
  <label
    ><span>Throw</span>
    <input type="number" value="0" name="attr_throw" />
    <button
      type="roll"
      value="Throw: [[d20+@{throw}]]"
      name="roll_bonus_throw"
    />
  </label>
  <label
    ><span>Disarm</span>
    <input type="number" value="0" name="attr_disarm" />
    <button
      type="roll"
      value="Disarm: [[d20+@{disarm}]]"
      name="roll_bonus_disarm"
    />
  </label>
  <label
    ><span>Entangle</span>
    <input type="number" value="0" name="attr_entangle" />
    <button
      type="roll"
      value="Entangle: [[d20+@{entangle}]]"
      name="roll_bonus_entangle"
    />
  </label>
  <label
    ><span>Pull Punch</span>
    <input type="number" value="0" name="attr_pull" />
    <button
      type="roll"
      value="Pull Punch: [[d20+@{pull}]]"
      name="roll_bonus_pull"
    />
  </label>
  <label
    ><span>Roll w/ Impact</span>
    <input type="number" value="0" name="attr_roll" />
    <button
      type="roll"
      value="Roll w/ Impact: [[d20+@{roll}]]"
      name="roll_bonus_roll"
    />
  </label>
  <label
    ><span>Body Flip/Throw</span>
    <input type="number" value="0" name="attr_flipthrow" />
    <button
      type="roll"
      value="Body Flip/Throw: [[d20+@{flipthrow}]]"
      name="roll_bonus_flipthrow"
    />
  </label>
  <label
    ><span>Damage</span>
    <input type="text" value="0" name="attr_damage" />
    <button
      type="roll"
      value="?{Add damage modifier?|
          None,Damage: [[@{damage}]]|
          Punch,Damage: [[@{damage}+@{punch}]]|
          P.S. Bonus,Damage: [[@{damage}+@{ps_bonus}]]
        }"
      name="roll_bonus_damage"
    />
  </label>
  <label
    ><span>Dodge: Flight</span>
    <input type="number" value="0" name="attr_dodge_flight" />
    <button
      type="roll"
      value="Dodge in Flight: [[d20+@{dodge_flight}]]"
      name="roll_bonus_dodge_flight"
    />
  </label>
  <label
    >Dodge: Auto
    <input type="number" value="0" name="attr_dodge_auto" />
    <button
      type="roll"
      value="Auto Dodge: [[d20+@{dodge_auto}]]"
      name="roll_bonus_dodge_auto"
    />
  </label>
  <label
    ><span>Dodge: Teleport</span>
    <input type="number" value="0" name="attr_dodge_teleport" />
    <button
      type="roll"
      value="Teleport Dodge: [[d20+@{dodge_teleport}]]"
      name="roll_bonus_dodge_teleport"
    />
  </label>
  <label
    ><span>Dodge: Motion</span>
    <input type="number" value="0" name="attr_dodge_motion" />
    <button
      type="roll"
      value="Dodge in Motion: [[d20+@{dodge_motion}]]"
      name="roll_bonus_dodge_motion"
    />
  </label>
  <label
    ><span>Strike: Range</span>
    <input type="number" value="0" name="attr_strike_range" />
    <button
      type="roll"
      value="Range Strike: [[d20+@{strike_range}]]"
      name="roll_bonus_strike_range"
    />
  </label>
  <label
    ><span>Range: Single</span>
    <input type="number" value="0" name="attr_strike_range_single" />
    <button
      type="roll"
      value="Range Strike: [[d20+@{strike_range_single}]]"
      name="roll_bonus_strike_range_single"
    />
  </label>
  <label
    ><span>Range: Burst</span>
    <input type="number" value="0" name="attr_strike_range_burst" />
    <button
      type="roll"
      value="Range Strike: [[d20+@{strike_range_burst}]]"
      name="roll_bonus_strike_range_burst"
    />
  </label>
  <label
    ><span>Range: Aimed</span>
    <input type="number" value="0" name="attr_strike_range_aimed" />
    <button
      type="roll"
      value="Range Aimed Strike: [[d20+@{strike_range_aimed}]]"
      name="roll_bonus_strike_range_aimed"
    />
  </label>
  <label
    ><span>Range: Aimed Single</span>
    <input type="hidden" value="0" name="attr_strike_range_aimed_single" />
    <span name="attr_strike_range_aimed_single"></span>
    <button
      type="roll"
      value="Range Aimed Single Strike: [[d20+@{strike_range_aimed_single}]]"
      name="roll_bonus_strike_range_aimed_single"
    />
  </label>
  <label
    ><span>Range: Aimed Pulse</span>
    <input type="hidden" value="0" name="attr_strike_range_aimed_pulse" />
    <span name="attr_strike_range_aimed_pulse"></span>
    <button
      type="roll"
      value="Range Aimed Pulse Strike: [[d20+@{strike_range_aimed_pulse}]]"
      name="roll_bonus_strike_range_aimed_pulse"
    />
  </label>
  <label
    ><span>Range: Called</span>
    <input type="number" value="0" name="attr_strike_range_called" />
    <button
      type="roll"
      value="Range Called Strike: [[d20+@{strike_range_called}]]"
      name="roll_bonus_strike_range_called"
    />
  </label>
  <label
    ><span>Range: Called Single</span>
    <input type="hidden" value="0" name="attr_strike_range_called_single" />
    <span name="attr_strike_range_called_single"></span>
    <button
      type="roll"
      value="Range Called Single Strike: [[d20+@{strike_range_called_single}]]"
      name="roll_bonus_strike_range_called_single"
    />
  </label>
  <label
    ><span>Range: Called Pulse</span>
    <input type="hidden" value="0" name="attr_strike_range_called_pulse" />
    <span name="attr_strike_range_called_pulse"></span>
    <button
      type="roll"
      value="Range Called Pulse Strike: [[d20+@{strike_range_called_pulse}]]"
      name="roll_bonus_strike_range_called_pulse"
    />
  </label>
  <label
    ><span>Range: Aimed Called Single</span>
    <input
      type="hidden"
      value="0"
      name="attr_strike_range_aimed_called_single"
    />
    <span name="attr_strike_range_aimed_called_single"></span>
    <button
      type="roll"
      value="Range Aimed Called Single Strike: [[d20+@{strike_range_aimed_called_single}]]"
      name="roll_bonus_strike_range_aimed_called_single"
    />
  </label>
  <label
    ><span>Range: Aimed Called Pulse</span>
    <input
      type="hidden"
      value="0"
      name="attr_strike_range_aimed_called_pulse"
    />
    <span name="attr_strike_range_aimed_called_pulse"></span>
    <button
      type="roll"
      value="Range Aimed Called Pulse Strike: [[d20+@{strike_range_aimed_called_pulse}]]"
      name="roll_bonus_strike_range_aimed_called_pulse"
    />
  </label>
  <label
    ><span>Disarm: Range</span>
    <input type="number" value="0" name="attr_disarm_range" />
    <button
      type="roll"
      value="Range Disarm: [[d20+@{disarm_range}]]"
      name="roll_bonus_disarm_range"
    />
  </label>
  <label
    ><span>Damage: Range</span>
    <input type="text" value="0" name="attr_damage_range" />
    <button
      type="roll"
      value="Range Damage: [[@{damage_range}]]"
      name="roll_bonus_damage_range"
    />
  </label>
  <label
    ><span>Critical</span> <input type="number" value="" name="attr_critical"
  /></label>
  <label
    ><span>Knockout</span> <input type="number" value="" name="attr_knockout"
  /></label>
  <label
    ><span>Death Blow</span>
    <input type="number" value="0" name="attr_deathblow"
  /></label>
</div>
<hr />
<h3>Saving Throws</h3>
<div class="bonus-type-container">
  <label
    ><span>Perception</span>
    <input type="number" value="0" name="attr_perceptioncheck" />
    <button
      type="roll"
      value="Perception Check: [[d20+@{perceptioncheck}]]"
      name="roll_bonus_perceptioncheck"
    />
  </label>
  <label
    ><span>Psionics</span>
    <input type="number" value="0" name="attr_psionics" />
    <button
      type="roll"
      value="Save vs. Psionics: [[d20+@{psionics}]]"
      name="roll_bonus_psionics"
    />
  </label>
  <label
    ><span>Magic</span>
    <input type="number" value="0" name="attr_magic" />
    <button
      type="roll"
      value="Save vs. Magic: [[d20+@{magic}]]"
      name="roll_bonus_magic"
    />
  </label>
  <label
    ><span>Horror Factor</span>
    <input type="number" value="0" name="attr_horrorfactor" />
    <button
      type="roll"
      value="Save vs. Horror Factor: [[d20+@{horrorfactor}]]"
      name="roll_bonus_horrorfactor"
    />
  </label>
  <label
    ><span>Mind Control</span>
    <input type="number" value="0" name="attr_mindcontrol" />
    <button
      type="roll"
      value="Save vs. Mind Control: [[d20+@{mindcontrol}]]"
      name="roll_bonus_mindcontrol"
    />
  </label>
  <label
    ><span>Disease</span>
    <input type="number" value="0" name="attr_disease" />
    <button
      type="roll"
      value="Save vs. Disease: [[d20+@{disease}]]"
      name="roll_bonus_disease"
    />
  </label>
  <label
    ><span>Illusions</span>
    <input type="number" value="0" name="attr_illusions" />
    <button
      type="roll"
      value="Save vs. Illusions: [[d20+@{illusions}]]"
      name="roll_bonus_illusions"
    />
  </label>
  <label
    ><span>Possession</span>
    <input type="number" value="0" name="attr_possession" />
    <button
      type="roll"
      value="Save vs. Possession: [[d20+@{possession}]]"
      name="roll_bonus_possession"
    />
  </label>
  <label
    ><span>Insanity</span>
    <input type="number" value="0" name="attr_insanity" />
    <button
      type="roll"
      value="Save vs. Insanity: [[d20+@{insanity}]]"
      name="roll_bonus_insanity"
    />
  </label>
  <label
    ><span>Pain</span>
    <input type="number" value="0" name="attr_pain" />
    <button
      type="roll"
      value="Save vs. Pain: [[d20+@{pain}]]"
      name="roll_bonus_pain"
    />
  </label>
  <label
    ><span>Lethal Poison</span>
    <input type="number" value="0" name="attr_lethalpoison" />
    <button
      type="roll"
      value="Save vs. Lethal Poison: [[d20+@{lethalpoison}]]"
      name="roll_bonus_lethalpoison"
    />
  </label>
  <label
    ><span>Non-Lethal Poison</span>
    <input type="number" value="0" name="attr_nonlethalpoison" />
    <button
      type="roll"
      value="Save vs. Non-Lethal Poison: [[d20+@{nonlethalpoison}]]"
      name="roll_bonus_nonlethalpoison"
    />
  </label>
  <label
    ><span>Drugs</span>
    <input type="number" value="0" name="attr_drugs" />
    <button
      type="roll"
      value="Save vs. Drugs: [[d20+@{drugs}]]"
      name="roll_bonus_drugs"
    />
  </label>
  <label
    ><span>Curses</span>
    <input type="number" value="0" name="attr_curses" />
    <button
      type="roll"
      value="Save vs. Curses: [[d20+@{curses}]]"
      name="roll_bonus_curses"
    />
  </label>
  <label
    ><span>Coma/Death</span>
    <input type="number" value="0" name="attr_comadeath" />
    <button
      type="roll"
      value="Save vs. Coma/Death: [[d100-@{comadeath}]]"
      name="roll_bonus_comadeath"
    />
  </label>
</div>
<label class="description"
  ><b>Description</b>
  <textarea class="full" name="attr_description" value=""></textarea>
</label>
<div class="macro-help">
  <label
    ><span><b>Row ID:</b></span>
    <input type="text" readonly name="attr_rowid" value=""
  /></label>
</div>

          <!-- endinject -->
        </details>
      </fieldset>
    </div>
  </div>

  <div class="magic">
    <h3>Magic</h3>
    <details>
      <summary><b>Instructions</b></summary>
      <p>
        Enter a Spell name and its PPE. Click the <b>&#9432;</b> icon to expand
        each row., and fill in the applicable values.
      </p>
      <p>
        Range, Duration, Damage, D.C., and Skill are all calculated from the
        per-level values you enter in the details. For Starting Damage and
        Damage per Level enter values that roll20 would use for dice rolls. Ex.
        "4d6", "1d6", etc.
      </p>
      <p>
        Press the Cast button to remove the PPE from the
        <b>Current PPE</b> input field. Click <b>Reset PPE</b> to set
        <b>Current PPE</b> back to the value on the Core tab. Note the roll
        buttons beside Damage and Skill.
      </p>
      <!-- inject:partials/repeated_instructions.html -->
      <p>
  The Modifiers section has fields for <b>anything</b> that can be modified.
  Attributes, PS type, MDC, ISP, PPE, combat bonuses, saving throw bonuses, etc.
  This section is available for any Ability, Psionic, Magic, as well in its own
  Modifiers tab. If you have a magic amulet that gives +1 to save vs. magic,
  create an entry on the Modifier tab and add it. If you have an NG-P7 that does
  1d4*10 damage, create an entry on the Modifier tab and add it. Superhuman
  Speed sets your speed to an absolute value of 44 and adds +2 to parry and +6
  to dodge. Add those in the modifiers section in the spell details on the Magic
  tab. Use the <b>|x|</b> checkbox next to Spd to indicate that the value is
  absolute, and not additive. If adding a Magic Spell, Psionic, or Ability that
  includes modifiers, check the <b>Add to Bonuses</b> checkbox. This will make
  those modifiers available on the Bonuses tab to be used in a Profile (see the
  Bonuses tab instructions for details on Profiles).
</p>
<p>
  Note that each section includes a read-only Row ID that can be used in macros.
</p>
<p>
  Don't forget to copy/paste the power description into the Description field to
  make life easier for your GM. Also use that field for any macros you may need
  like Strike with an arbitrary bonus.
</p>

      <!-- endinject -->
    </details>
    <p>Click <b>Instructions</b> for detailed instructions.</p>
    <label
      ><span>Current P.P.E.</span>
      <input type="number" name="attr_currentppe" value="0" />
      <button type="action" name="act_resetppe">Reset P.P.E.</button>
    </label>
    <fieldset class="repeating_magic">
      <details class="info">
        <!-- inject:partials/magic.html -->
        <summary>
  <div class="spells-list">
    <h5>Info</h5>
    <h5>Spell</h5>
    <h5>Spell Level</h5>
    <h5>Range</h5>
    <h5>Duration</h5>
    <h5>Damage</h5>
    <h5></h5>
    <h5 title="Damage Capacity">D.C.</h5>
    <h5>Skill</h5>
    <h5></h5>
    <h5>P.P.E.</h5>
    <h5></h5>
    <b class="click-expand"
      ><span title="Click for more info">&nbsp;&#9432;</span></b
    >
    <input type="text" value="" name="attr_name" />
    <input type="number" value="1" name="attr_spell_level" />
    <input type="hidden" value="0" name="attr_range" />
    <span name="attr_range"></span>
    <input type="hidden" value="0" name="attr_duration" />
    <span name="attr_duration"></span>
    <input type="text" value="0" name="attr_damage" readonly />
    <button
      type="roll"
      value="@{character_name} @{name} [[@{damage}]] @{damage_unit}"
      name="roll_spell_damage"
    />
    <input type="hidden" value="0" name="attr_dc" />
    <span name="attr_dc"></span>
    <input type="hidden" value="0" name="attr_percentage" />
    <span name="attr_percentage"></span>
    <button
      type="roll"
      value="@{character_name} @{name} check: [[d100<@{percentage}]]"
      name="roll_spell_skill"
    />
    <input type="number" value="0" name="attr_ppecost" />
    <button type="action" name="act_usespell">Cast</button>
  </div>
</summary>
<br />
<label
  ><input type="checkbox" name="attr_addtobonuses" value="1" /> Add to
  Bonuses</label
>
<br />
<div class="spell-details">
  <label
    ><span>Starting range</span
    ><input type="number" value="0" name="attr_range_starting"
  /></label>
  <label
    ><span>Range per level</span
    ><input type="number" value="0" name="attr_range_per_level"
  /></label>
  <label
    ><span>Range unit</span
    ><input type="text" value="" name="attr_range_unit" list="distance-units" />
  </label>
  <label
    ><span>Starting duration</span
    ><input type="number" value="0" name="attr_duration_starting"
  /></label>
  <label
    ><span>Duration per level</span
    ><input type="number" value="0" name="attr_duration_per_level"
  /></label>
  <label
    ><span>Duration unit</span
    ><input type="text" value="" name="attr_duration_unit" list="time-units" />
  </label>
  <label
    ><span>Starting damage</span
    ><input type="text" value="0" name="attr_damage_starting"
  /></label>
  <label
    ><span>Damage per level</span
    ><input type="text" value="0" name="attr_damage_per_level"
  /></label>
  <label
    ><span>Damage unit</span
    ><input type="text" value="" name="attr_damage_unit" list="damage-units" />
  </label>
  <label
    ><span>Starting D.C.</span
    ><input type="number" value="0" name="attr_dc_starting"
  /></label>
  <label
    ><span>D.C. per level</span
    ><input type="number" value="0" name="attr_dc_per_level"
  /></label>
  <label
    ><span>D.C. unit</span
    ><input type="text" value="" name="attr_dc_unit" list="damage-units" />
  </label>
  <label
    ><span>Starting skill %</span
    ><input type="number" value="0" name="attr_percentage_starting"
  /></label>
  <label
    ><span>Skill % per level</span
    ><input type="number" value="0" name="attr_percentage_per_level"
  /></label>
  <label
    ><span>School</span
    ><input type="text" value="" name="attr_school" list="spell-schools" />
  </label>
</div>

        <!-- endinject -->
        <h2>Modifiers</h2>
        <!-- inject:partials/repeating_bonuses_details.html -->
        <input type="hidden" name="attr_bonus_id" value="" />
<details>
  <summary>
    <h3>Attributes</h3>
  </summary>
  <div class="bonus-type-container attributes">
    <label
      ><span>I.Q.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_iq"
        title="Intelligence Quotient"
      />
      <label class="abs"
        ><input type="checkbox" value="1" name="attr_iq_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_iq_bonus"
        title="+ Skills %"
      />
      <span name="attr_mod_iq_bonus" title="+ Skills %"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_perception_bonus"
        title="+ Perception (Rifter #13, p.16)"
      />
      <span
        name="attr_mod_perception_bonus"
        title="+ Perception (Rifter #13, p.16)"
      ></span>
    </label>
    <label
      ><span>M.E.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_me"
        title="Mental Endurance"
      />
      <label class="abs"
        ><input type="checkbox" value="1" name="attr_me_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_me_bonus"
        title="+ Save vs. Psionics"
      />
      <span name="attr_mod_me_bonus" title="+ Save vs. Psionics"></span>
    </label>
    <label
      ><span>M.A.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_ma"
        title="Mental Affinity"
      /><label class="abs"
        ><input type="checkbox" value="1" name="attr_ma_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_ma_bonus"
        title="% Trust/Intimidate"
      />
      <span name="attr_mod_ma_bonus" title="% Trust/Intimidate"></span>
    </label>
    <label
      ><span>P.S.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_ps"
        title="Physical Strength"
      /><label class="abs"
        ><input type="checkbox" value="1" name="attr_ps_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_ps_bonus"
        title="+ SDC Damage"
      />
      <span name="attr_mod_ps_bonus" title="+ SDC Damage"></span>
    </label>
    <label
      ><span>P.P.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_pp"
        title="Physical Prowess"
      /><label class="abs"
        ><input type="checkbox" value="1" name="attr_pp_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_pp_bonus"
        title="+ Strike/Parry/Dodge/Entangle/Disarm"
      />
      <span
        name="attr_mod_pp_bonus"
        title="+ Strike/Parry/Dodge/Entangle/Disarm"
      ></span>
    </label>
    <label
      ><span>P.E.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_pe"
        title="Physical Endurance"
      /><label class="abs"
        ><input type="checkbox" value="1" name="attr_pe_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_pe_bonus"
        title="+ Magic/Poison/Toxins"
      />
      <span name="attr_mod_pe_bonus" title="+ Magic/Poison/Toxins"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_pe_coma_bonus"
        title="+ Coma/Death %"
      />
      <span name="attr_mod_pe_coma_bonus" title="+ Coma/Death %"></span>
    </label>
    <label
      ><span>P.B.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_pb"
        title="Physical Beauty"
      /><label class="abs"
        ><input type="checkbox" value="1" name="attr_pb_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_pb_bonus"
        title="% Charm/Impress"
      />
      <span name="attr_mod_pb_bonus" title="% Charm/Impress"></span>
    </label>
    <label
      ><span>Spd</span>
      <input type="number" value="0" name="attr_mod_spd" title="Speed" /><label
        class="abs"
        ><input type="checkbox" value="1" name="attr_spd_abs" />|x|</label
      ></label
    >
  </div>
  <hr />
  <div class="bonus-ps-container">
    <label class="select"
      ><span>PS Type</span>
      <select class="" name="attr_mod_character_ps_type" value="normal">
        <option value="1">Normal</option>
        <option value="2">Augmented</option>
        <option value="3">Robotic</option>
        <option value="3.5">Giant Robotic</option>
        <option value="4">Supernatural</option>
      </select></label
    >
    <label
      ><span>Restrained Punch</span>
      <input type="text" name="attr_mod_restrained_punch" value="0" />
      <select name="attr_mod_restrained_punch_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Punch</span>
      <input type="text" name="attr_mod_punch" value="0" />
      <select name="attr_mod_punch_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Power Punch</span>
      <input type="text" name="attr_mod_power_punch" value="0" />
      <select name="attr_mod_power_punch_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Kick</span>
      <input type="text" name="attr_mod_kick" value="0" />
      <select name="attr_mod_kick_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Leap Kick</span>
      <input type="text" name="attr_mod_leap_kick" value="0" />
      <select name="attr_mod_leap_kick_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select>
    </label>

    <label
      ><span>Lift</span>
      <input type="number" value="0" name="attr_mod_lift" value="0" />
      <span>lbs</span>
    </label>

    <label
      ><span>Carry</span>
      <input type="number" value="0" name="attr_mod_carry" value="0" />
      <span>lbs</span></label
    >

    <label
      ><span>Throw (&frac12; Carry)</span>
      <input type="number" value="0" name="attr_mod_throw_distance" value="0" />
      <span>Feet</span></label
    >

    <label
      ><span>Carry Max</span>
      <input type="number" value="0" name="attr_mod_carry_max" /><span
        >Minutes</span
      ></label
    >

    <label
      ><span>Carry (Running)</span>
      <input type="number" value="0" name="attr_mod_carry_running" /><span
        >Minutes</span
      ></label
    >

    <label
      ><span>Hold Max.</span>
      <input type="number" value="0" name="attr_mod_hold_max" /><span
        >Melees</span
      ></label
    >
  </div>
  <hr />
</details>
<div class="bonus-type-container">
  <label
    ><span title="Hit Points">H.P.</span
    ><input type="number" value="0" name="attr_hp"
  /></label>
  <label
    ><span>S.D.C.</span><input type="number" value="0" name="attr_sdc"
  /></label>
  <label
    ><span>A.R.</span><input type="number" value="0" name="attr_ar"
  /></label>
  <label
    ><span>M.D.C.</span><input type="number" value="0" name="attr_mdc"
  /></label>
  <label
    ><span>P.P.E.</span><input type="number" value="0" name="attr_ppe"
  /></label>
  <label
    ><span>I.S.P.</span><input type="number" value="0" name="attr_isp"
  /></label>
  <label
    ><span>H.F.</span><input type="number" value="0" name="attr_mod_hf" /><label
      class="abs"
      ><input type="checkbox" value="1" name="attr_hf_abs" />|x|</label
    ></label
  >
</div>
<hr />
<h3>Combat</h3>
<div class="bonus-type-container">
  <label
    ><span>Attacks</span>
    <input type="number" value="0" name="attr_attacks" />
  </label>
  <label
    ><span>Initiative</span>
    <input type="number" value="0" name="attr_initiative" />
    <button
      type="roll"
      value="Initiative: [[d20+@{initiative}]]"
      name="roll_bonus_initiative"
    />
  </label>
  <label
    ><span>Strike</span>
    <input type="number" value="0" name="attr_strike" />
    <button
      type="roll"
      value="Strike: [[d20+@{strike}]]"
      name="roll_bonus_strike"
    />
  </label>
  <label
    ><span>Parry</span>
    <input type="number" value="0" name="attr_parry" />
    <button
      type="roll"
      value="Parry: [[d20+@{parry}]]"
      name="roll_bonus_parry"
    />
  </label>
  <label
    ><span>Dodge</span>
    <input type="number" value="0" name="attr_dodge" />
    <button
      type="roll"
      value="Dodge: [[d20+@{dodge}]]"
      name="roll_bonus_dodge"
    />
  </label>
  <label
    ><span>Throw</span>
    <input type="number" value="0" name="attr_throw" />
    <button
      type="roll"
      value="Throw: [[d20+@{throw}]]"
      name="roll_bonus_throw"
    />
  </label>
  <label
    ><span>Disarm</span>
    <input type="number" value="0" name="attr_disarm" />
    <button
      type="roll"
      value="Disarm: [[d20+@{disarm}]]"
      name="roll_bonus_disarm"
    />
  </label>
  <label
    ><span>Entangle</span>
    <input type="number" value="0" name="attr_entangle" />
    <button
      type="roll"
      value="Entangle: [[d20+@{entangle}]]"
      name="roll_bonus_entangle"
    />
  </label>
  <label
    ><span>Pull Punch</span>
    <input type="number" value="0" name="attr_pull" />
    <button
      type="roll"
      value="Pull Punch: [[d20+@{pull}]]"
      name="roll_bonus_pull"
    />
  </label>
  <label
    ><span>Roll w/ Impact</span>
    <input type="number" value="0" name="attr_roll" />
    <button
      type="roll"
      value="Roll w/ Impact: [[d20+@{roll}]]"
      name="roll_bonus_roll"
    />
  </label>
  <label
    ><span>Body Flip/Throw</span>
    <input type="number" value="0" name="attr_flipthrow" />
    <button
      type="roll"
      value="Body Flip/Throw: [[d20+@{flipthrow}]]"
      name="roll_bonus_flipthrow"
    />
  </label>
  <label
    ><span>Damage</span>
    <input type="text" value="0" name="attr_damage" />
    <button
      type="roll"
      value="?{Add damage modifier?|
          None,Damage: [[@{damage}]]|
          Punch,Damage: [[@{damage}+@{punch}]]|
          P.S. Bonus,Damage: [[@{damage}+@{ps_bonus}]]
        }"
      name="roll_bonus_damage"
    />
  </label>
  <label
    ><span>Dodge: Flight</span>
    <input type="number" value="0" name="attr_dodge_flight" />
    <button
      type="roll"
      value="Dodge in Flight: [[d20+@{dodge_flight}]]"
      name="roll_bonus_dodge_flight"
    />
  </label>
  <label
    >Dodge: Auto
    <input type="number" value="0" name="attr_dodge_auto" />
    <button
      type="roll"
      value="Auto Dodge: [[d20+@{dodge_auto}]]"
      name="roll_bonus_dodge_auto"
    />
  </label>
  <label
    ><span>Dodge: Teleport</span>
    <input type="number" value="0" name="attr_dodge_teleport" />
    <button
      type="roll"
      value="Teleport Dodge: [[d20+@{dodge_teleport}]]"
      name="roll_bonus_dodge_teleport"
    />
  </label>
  <label
    ><span>Dodge: Motion</span>
    <input type="number" value="0" name="attr_dodge_motion" />
    <button
      type="roll"
      value="Dodge in Motion: [[d20+@{dodge_motion}]]"
      name="roll_bonus_dodge_motion"
    />
  </label>
  <label
    ><span>Strike: Range</span>
    <input type="number" value="0" name="attr_strike_range" />
    <button
      type="roll"
      value="Range Strike: [[d20+@{strike_range}]]"
      name="roll_bonus_strike_range"
    />
  </label>
  <label
    ><span>Range: Single</span>
    <input type="number" value="0" name="attr_strike_range_single" />
    <button
      type="roll"
      value="Range Strike: [[d20+@{strike_range_single}]]"
      name="roll_bonus_strike_range_single"
    />
  </label>
  <label
    ><span>Range: Burst</span>
    <input type="number" value="0" name="attr_strike_range_burst" />
    <button
      type="roll"
      value="Range Strike: [[d20+@{strike_range_burst}]]"
      name="roll_bonus_strike_range_burst"
    />
  </label>
  <label
    ><span>Range: Aimed</span>
    <input type="number" value="0" name="attr_strike_range_aimed" />
    <button
      type="roll"
      value="Range Aimed Strike: [[d20+@{strike_range_aimed}]]"
      name="roll_bonus_strike_range_aimed"
    />
  </label>
  <label
    ><span>Range: Aimed Single</span>
    <input type="hidden" value="0" name="attr_strike_range_aimed_single" />
    <span name="attr_strike_range_aimed_single"></span>
    <button
      type="roll"
      value="Range Aimed Single Strike: [[d20+@{strike_range_aimed_single}]]"
      name="roll_bonus_strike_range_aimed_single"
    />
  </label>
  <label
    ><span>Range: Aimed Pulse</span>
    <input type="hidden" value="0" name="attr_strike_range_aimed_pulse" />
    <span name="attr_strike_range_aimed_pulse"></span>
    <button
      type="roll"
      value="Range Aimed Pulse Strike: [[d20+@{strike_range_aimed_pulse}]]"
      name="roll_bonus_strike_range_aimed_pulse"
    />
  </label>
  <label
    ><span>Range: Called</span>
    <input type="number" value="0" name="attr_strike_range_called" />
    <button
      type="roll"
      value="Range Called Strike: [[d20+@{strike_range_called}]]"
      name="roll_bonus_strike_range_called"
    />
  </label>
  <label
    ><span>Range: Called Single</span>
    <input type="hidden" value="0" name="attr_strike_range_called_single" />
    <span name="attr_strike_range_called_single"></span>
    <button
      type="roll"
      value="Range Called Single Strike: [[d20+@{strike_range_called_single}]]"
      name="roll_bonus_strike_range_called_single"
    />
  </label>
  <label
    ><span>Range: Called Pulse</span>
    <input type="hidden" value="0" name="attr_strike_range_called_pulse" />
    <span name="attr_strike_range_called_pulse"></span>
    <button
      type="roll"
      value="Range Called Pulse Strike: [[d20+@{strike_range_called_pulse}]]"
      name="roll_bonus_strike_range_called_pulse"
    />
  </label>
  <label
    ><span>Range: Aimed Called Single</span>
    <input
      type="hidden"
      value="0"
      name="attr_strike_range_aimed_called_single"
    />
    <span name="attr_strike_range_aimed_called_single"></span>
    <button
      type="roll"
      value="Range Aimed Called Single Strike: [[d20+@{strike_range_aimed_called_single}]]"
      name="roll_bonus_strike_range_aimed_called_single"
    />
  </label>
  <label
    ><span>Range: Aimed Called Pulse</span>
    <input
      type="hidden"
      value="0"
      name="attr_strike_range_aimed_called_pulse"
    />
    <span name="attr_strike_range_aimed_called_pulse"></span>
    <button
      type="roll"
      value="Range Aimed Called Pulse Strike: [[d20+@{strike_range_aimed_called_pulse}]]"
      name="roll_bonus_strike_range_aimed_called_pulse"
    />
  </label>
  <label
    ><span>Disarm: Range</span>
    <input type="number" value="0" name="attr_disarm_range" />
    <button
      type="roll"
      value="Range Disarm: [[d20+@{disarm_range}]]"
      name="roll_bonus_disarm_range"
    />
  </label>
  <label
    ><span>Damage: Range</span>
    <input type="text" value="0" name="attr_damage_range" />
    <button
      type="roll"
      value="Range Damage: [[@{damage_range}]]"
      name="roll_bonus_damage_range"
    />
  </label>
  <label
    ><span>Critical</span> <input type="number" value="" name="attr_critical"
  /></label>
  <label
    ><span>Knockout</span> <input type="number" value="" name="attr_knockout"
  /></label>
  <label
    ><span>Death Blow</span>
    <input type="number" value="0" name="attr_deathblow"
  /></label>
</div>
<hr />
<h3>Saving Throws</h3>
<div class="bonus-type-container">
  <label
    ><span>Perception</span>
    <input type="number" value="0" name="attr_perceptioncheck" />
    <button
      type="roll"
      value="Perception Check: [[d20+@{perceptioncheck}]]"
      name="roll_bonus_perceptioncheck"
    />
  </label>
  <label
    ><span>Psionics</span>
    <input type="number" value="0" name="attr_psionics" />
    <button
      type="roll"
      value="Save vs. Psionics: [[d20+@{psionics}]]"
      name="roll_bonus_psionics"
    />
  </label>
  <label
    ><span>Magic</span>
    <input type="number" value="0" name="attr_magic" />
    <button
      type="roll"
      value="Save vs. Magic: [[d20+@{magic}]]"
      name="roll_bonus_magic"
    />
  </label>
  <label
    ><span>Horror Factor</span>
    <input type="number" value="0" name="attr_horrorfactor" />
    <button
      type="roll"
      value="Save vs. Horror Factor: [[d20+@{horrorfactor}]]"
      name="roll_bonus_horrorfactor"
    />
  </label>
  <label
    ><span>Mind Control</span>
    <input type="number" value="0" name="attr_mindcontrol" />
    <button
      type="roll"
      value="Save vs. Mind Control: [[d20+@{mindcontrol}]]"
      name="roll_bonus_mindcontrol"
    />
  </label>
  <label
    ><span>Disease</span>
    <input type="number" value="0" name="attr_disease" />
    <button
      type="roll"
      value="Save vs. Disease: [[d20+@{disease}]]"
      name="roll_bonus_disease"
    />
  </label>
  <label
    ><span>Illusions</span>
    <input type="number" value="0" name="attr_illusions" />
    <button
      type="roll"
      value="Save vs. Illusions: [[d20+@{illusions}]]"
      name="roll_bonus_illusions"
    />
  </label>
  <label
    ><span>Possession</span>
    <input type="number" value="0" name="attr_possession" />
    <button
      type="roll"
      value="Save vs. Possession: [[d20+@{possession}]]"
      name="roll_bonus_possession"
    />
  </label>
  <label
    ><span>Insanity</span>
    <input type="number" value="0" name="attr_insanity" />
    <button
      type="roll"
      value="Save vs. Insanity: [[d20+@{insanity}]]"
      name="roll_bonus_insanity"
    />
  </label>
  <label
    ><span>Pain</span>
    <input type="number" value="0" name="attr_pain" />
    <button
      type="roll"
      value="Save vs. Pain: [[d20+@{pain}]]"
      name="roll_bonus_pain"
    />
  </label>
  <label
    ><span>Lethal Poison</span>
    <input type="number" value="0" name="attr_lethalpoison" />
    <button
      type="roll"
      value="Save vs. Lethal Poison: [[d20+@{lethalpoison}]]"
      name="roll_bonus_lethalpoison"
    />
  </label>
  <label
    ><span>Non-Lethal Poison</span>
    <input type="number" value="0" name="attr_nonlethalpoison" />
    <button
      type="roll"
      value="Save vs. Non-Lethal Poison: [[d20+@{nonlethalpoison}]]"
      name="roll_bonus_nonlethalpoison"
    />
  </label>
  <label
    ><span>Drugs</span>
    <input type="number" value="0" name="attr_drugs" />
    <button
      type="roll"
      value="Save vs. Drugs: [[d20+@{drugs}]]"
      name="roll_bonus_drugs"
    />
  </label>
  <label
    ><span>Curses</span>
    <input type="number" value="0" name="attr_curses" />
    <button
      type="roll"
      value="Save vs. Curses: [[d20+@{curses}]]"
      name="roll_bonus_curses"
    />
  </label>
  <label
    ><span>Coma/Death</span>
    <input type="number" value="0" name="attr_comadeath" />
    <button
      type="roll"
      value="Save vs. Coma/Death: [[d100-@{comadeath}]]"
      name="roll_bonus_comadeath"
    />
  </label>
</div>
<label class="description"
  ><b>Description</b>
  <textarea class="full" name="attr_description" value=""></textarea>
</label>
<div class="macro-help">
  <label
    ><span><b>Row ID:</b></span>
    <input type="text" readonly name="attr_rowid" value=""
  /></label>
</div>

        <!-- endinject -->
      </details>
    </fieldset>
  </div>

  <div class="psionics">
    <h3>Psionics</h3>
    <details>
      <summary><b>Instructions</b></summary>
      <p>
        Enter a Psionic name and its ISP. Click the <b>&#9432;</b> icon to
        expand each row, and fill in the applicable values.
      </p>
      <p>
        Range, Duration, Damage, D.C., and Skill are all calculated from the
        per-level values you enter in the details. For Starting Damage and
        Damage per Level enter values that roll20 would use for dice rolls. Ex.
        "4d6", "1d6", etc.
      </p>
      <p>
        Press the Use button to remove the ISP from the <b>Current ISP</b> input
        field. Click <b>Reset ISP</b> to set <b>Current ISP</b> back to the
        value on the Core tab. Note the roll button beside Damage and Skill.
      </p>
      <!-- inject:partials/repeated_instructions.html -->
      <p>
  The Modifiers section has fields for <b>anything</b> that can be modified.
  Attributes, PS type, MDC, ISP, PPE, combat bonuses, saving throw bonuses, etc.
  This section is available for any Ability, Psionic, Magic, as well in its own
  Modifiers tab. If you have a magic amulet that gives +1 to save vs. magic,
  create an entry on the Modifier tab and add it. If you have an NG-P7 that does
  1d4*10 damage, create an entry on the Modifier tab and add it. Superhuman
  Speed sets your speed to an absolute value of 44 and adds +2 to parry and +6
  to dodge. Add those in the modifiers section in the spell details on the Magic
  tab. Use the <b>|x|</b> checkbox next to Spd to indicate that the value is
  absolute, and not additive. If adding a Magic Spell, Psionic, or Ability that
  includes modifiers, check the <b>Add to Bonuses</b> checkbox. This will make
  those modifiers available on the Bonuses tab to be used in a Profile (see the
  Bonuses tab instructions for details on Profiles).
</p>
<p>
  Note that each section includes a read-only Row ID that can be used in macros.
</p>
<p>
  Don't forget to copy/paste the power description into the Description field to
  make life easier for your GM. Also use that field for any macros you may need
  like Strike with an arbitrary bonus.
</p>

      <!-- endinject -->
    </details>
    <p>Click <b>Instructions</b> for detailed instructions.</p>
    <label
      ><span>Current I.S.P.</span>
      <input type="number" name="attr_currentisp" value="0" />
      <button type="action" name="act_resetisp">Reset I.S.P.</button>
    </label>
    <fieldset class="repeating_psionics">
      <details class="info">
        <!-- inject:partials/psionics.html -->
        <summary>
  <div class="psionics-list">
    <h5>Info</h5>
    <h5>Psionic</h5>
    <h5>Range</h5>
    <h5>Duration</h5>
    <h5>Damage</h5>
    <h5></h5>
    <h5 title="Damage Capacity">D.C.</h5>
    <h5>Skill</h5>
    <h5></h5>
    <h5>I.S.P.</h5>
    <h5></h5>
    <b class="click-expand"
      ><span title="Click for more info">&nbsp;&#9432;</span></b
    >
    <input type="text" value="" name="attr_name" />
    <input type="hidden" value="0" name="attr_range" />
    <span name="attr_range"></span>
    <input type="hidden" value="0" name="attr_duration" />
    <span name="attr_duration"></span>
    <input type="text" value="0" name="attr_damage" readonly />
    <button
      type="roll"
      value="@{character_name} @{name} [[@{damage}]] @{damage_unit}"
      name="roll_psionic_damage"
    />
    <input type="hidden" value="0" name="attr_dc" />
    <span name="attr_dc"></span>
    <input type="hidden" value="0" name="attr_percentage" />
    <span name="attr_percentage"></span>
    <button
      type="roll"
      value="@{character_name} @{name} check: [[d100<@{percentage}]]"
      name="roll_psionic_skill"
    />
    <input type="number" value="0" name="attr_ispcost" />
    <button type="action" name="act_usepsionic">Use</button>
  </div>
</summary>
<br />
<label
  ><input type="checkbox" name="attr_addtobonuses" value="1" /> Add to
  Bonuses</label
>
<br />
<div class="psionic-details">
  <label
    ><span>Starting range</span
    ><input type="number" value="0" name="attr_range_starting"
  /></label>
  <label
    ><span>Range per level</span
    ><input type="number" value="0" name="attr_range_per_level"
  /></label>
  <label
    ><span>Range unit</span
    ><input type="text" value="" name="attr_range_unit" list="distance-units" />
  </label>
  <label
    ><span>Starting duration</span
    ><input type="number" value="0" name="attr_duration_starting"
  /></label>
  <label
    ><span>Duration per level</span
    ><input type="number" value="0" name="attr_duration_per_level"
  /></label>
  <label
    ><span>Duration unit</span
    ><input type="text" value="" name="attr_duration_unit" list="time-units" />
  </label>
  <label
    ><span>Starting damage</span
    ><input type="text" value="0" name="attr_damage_starting"
  /></label>
  <label
    ><span>Damage per level</span
    ><input type="text" value="0" name="attr_damage_per_level"
  /></label>
  <label
    ><span>Damage unit</span
    ><input type="text" value="" name="attr_damage_unit" list="damage-units" />
  </label>
  <label
    ><span>Starting D.C.</span
    ><input type="number" value="0" name="attr_dc_starting"
  /></label>
  <label
    ><span>D.C. per level</span
    ><input type="number" value="0" name="attr_dc_per_level"
  /></label>
  <label
    ><span>D.C. unit</span
    ><input type="text" value="" name="attr_dc_unit" list="damage-units" />
  </label>
  <label
    ><span>Starting skill %</span
    ><input type="number" value="0" name="attr_percentage_starting"
  /></label>
  <label
    ><span>Skill % per level</span
    ><input type="number" value="0" name="attr_percentage_per_level"
  /></label>
  <label></label>
</div>

        <!-- endinject -->
        <h2>Modifiers</h2>
        <!-- inject:partials/repeating_bonuses_details.html -->
        <input type="hidden" name="attr_bonus_id" value="" />
<details>
  <summary>
    <h3>Attributes</h3>
  </summary>
  <div class="bonus-type-container attributes">
    <label
      ><span>I.Q.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_iq"
        title="Intelligence Quotient"
      />
      <label class="abs"
        ><input type="checkbox" value="1" name="attr_iq_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_iq_bonus"
        title="+ Skills %"
      />
      <span name="attr_mod_iq_bonus" title="+ Skills %"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_perception_bonus"
        title="+ Perception (Rifter #13, p.16)"
      />
      <span
        name="attr_mod_perception_bonus"
        title="+ Perception (Rifter #13, p.16)"
      ></span>
    </label>
    <label
      ><span>M.E.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_me"
        title="Mental Endurance"
      />
      <label class="abs"
        ><input type="checkbox" value="1" name="attr_me_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_me_bonus"
        title="+ Save vs. Psionics"
      />
      <span name="attr_mod_me_bonus" title="+ Save vs. Psionics"></span>
    </label>
    <label
      ><span>M.A.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_ma"
        title="Mental Affinity"
      /><label class="abs"
        ><input type="checkbox" value="1" name="attr_ma_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_ma_bonus"
        title="% Trust/Intimidate"
      />
      <span name="attr_mod_ma_bonus" title="% Trust/Intimidate"></span>
    </label>
    <label
      ><span>P.S.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_ps"
        title="Physical Strength"
      /><label class="abs"
        ><input type="checkbox" value="1" name="attr_ps_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_ps_bonus"
        title="+ SDC Damage"
      />
      <span name="attr_mod_ps_bonus" title="+ SDC Damage"></span>
    </label>
    <label
      ><span>P.P.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_pp"
        title="Physical Prowess"
      /><label class="abs"
        ><input type="checkbox" value="1" name="attr_pp_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_pp_bonus"
        title="+ Strike/Parry/Dodge/Entangle/Disarm"
      />
      <span
        name="attr_mod_pp_bonus"
        title="+ Strike/Parry/Dodge/Entangle/Disarm"
      ></span>
    </label>
    <label
      ><span>P.E.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_pe"
        title="Physical Endurance"
      /><label class="abs"
        ><input type="checkbox" value="1" name="attr_pe_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_pe_bonus"
        title="+ Magic/Poison/Toxins"
      />
      <span name="attr_mod_pe_bonus" title="+ Magic/Poison/Toxins"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_pe_coma_bonus"
        title="+ Coma/Death %"
      />
      <span name="attr_mod_pe_coma_bonus" title="+ Coma/Death %"></span>
    </label>
    <label
      ><span>P.B.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_pb"
        title="Physical Beauty"
      /><label class="abs"
        ><input type="checkbox" value="1" name="attr_pb_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_pb_bonus"
        title="% Charm/Impress"
      />
      <span name="attr_mod_pb_bonus" title="% Charm/Impress"></span>
    </label>
    <label
      ><span>Spd</span>
      <input type="number" value="0" name="attr_mod_spd" title="Speed" /><label
        class="abs"
        ><input type="checkbox" value="1" name="attr_spd_abs" />|x|</label
      ></label
    >
  </div>
  <hr />
  <div class="bonus-ps-container">
    <label class="select"
      ><span>PS Type</span>
      <select class="" name="attr_mod_character_ps_type" value="normal">
        <option value="1">Normal</option>
        <option value="2">Augmented</option>
        <option value="3">Robotic</option>
        <option value="3.5">Giant Robotic</option>
        <option value="4">Supernatural</option>
      </select></label
    >
    <label
      ><span>Restrained Punch</span>
      <input type="text" name="attr_mod_restrained_punch" value="0" />
      <select name="attr_mod_restrained_punch_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Punch</span>
      <input type="text" name="attr_mod_punch" value="0" />
      <select name="attr_mod_punch_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Power Punch</span>
      <input type="text" name="attr_mod_power_punch" value="0" />
      <select name="attr_mod_power_punch_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Kick</span>
      <input type="text" name="attr_mod_kick" value="0" />
      <select name="attr_mod_kick_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Leap Kick</span>
      <input type="text" name="attr_mod_leap_kick" value="0" />
      <select name="attr_mod_leap_kick_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select>
    </label>

    <label
      ><span>Lift</span>
      <input type="number" value="0" name="attr_mod_lift" value="0" />
      <span>lbs</span>
    </label>

    <label
      ><span>Carry</span>
      <input type="number" value="0" name="attr_mod_carry" value="0" />
      <span>lbs</span></label
    >

    <label
      ><span>Throw (&frac12; Carry)</span>
      <input type="number" value="0" name="attr_mod_throw_distance" value="0" />
      <span>Feet</span></label
    >

    <label
      ><span>Carry Max</span>
      <input type="number" value="0" name="attr_mod_carry_max" /><span
        >Minutes</span
      ></label
    >

    <label
      ><span>Carry (Running)</span>
      <input type="number" value="0" name="attr_mod_carry_running" /><span
        >Minutes</span
      ></label
    >

    <label
      ><span>Hold Max.</span>
      <input type="number" value="0" name="attr_mod_hold_max" /><span
        >Melees</span
      ></label
    >
  </div>
  <hr />
</details>
<div class="bonus-type-container">
  <label
    ><span title="Hit Points">H.P.</span
    ><input type="number" value="0" name="attr_hp"
  /></label>
  <label
    ><span>S.D.C.</span><input type="number" value="0" name="attr_sdc"
  /></label>
  <label
    ><span>A.R.</span><input type="number" value="0" name="attr_ar"
  /></label>
  <label
    ><span>M.D.C.</span><input type="number" value="0" name="attr_mdc"
  /></label>
  <label
    ><span>P.P.E.</span><input type="number" value="0" name="attr_ppe"
  /></label>
  <label
    ><span>I.S.P.</span><input type="number" value="0" name="attr_isp"
  /></label>
  <label
    ><span>H.F.</span><input type="number" value="0" name="attr_mod_hf" /><label
      class="abs"
      ><input type="checkbox" value="1" name="attr_hf_abs" />|x|</label
    ></label
  >
</div>
<hr />
<h3>Combat</h3>
<div class="bonus-type-container">
  <label
    ><span>Attacks</span>
    <input type="number" value="0" name="attr_attacks" />
  </label>
  <label
    ><span>Initiative</span>
    <input type="number" value="0" name="attr_initiative" />
    <button
      type="roll"
      value="Initiative: [[d20+@{initiative}]]"
      name="roll_bonus_initiative"
    />
  </label>
  <label
    ><span>Strike</span>
    <input type="number" value="0" name="attr_strike" />
    <button
      type="roll"
      value="Strike: [[d20+@{strike}]]"
      name="roll_bonus_strike"
    />
  </label>
  <label
    ><span>Parry</span>
    <input type="number" value="0" name="attr_parry" />
    <button
      type="roll"
      value="Parry: [[d20+@{parry}]]"
      name="roll_bonus_parry"
    />
  </label>
  <label
    ><span>Dodge</span>
    <input type="number" value="0" name="attr_dodge" />
    <button
      type="roll"
      value="Dodge: [[d20+@{dodge}]]"
      name="roll_bonus_dodge"
    />
  </label>
  <label
    ><span>Throw</span>
    <input type="number" value="0" name="attr_throw" />
    <button
      type="roll"
      value="Throw: [[d20+@{throw}]]"
      name="roll_bonus_throw"
    />
  </label>
  <label
    ><span>Disarm</span>
    <input type="number" value="0" name="attr_disarm" />
    <button
      type="roll"
      value="Disarm: [[d20+@{disarm}]]"
      name="roll_bonus_disarm"
    />
  </label>
  <label
    ><span>Entangle</span>
    <input type="number" value="0" name="attr_entangle" />
    <button
      type="roll"
      value="Entangle: [[d20+@{entangle}]]"
      name="roll_bonus_entangle"
    />
  </label>
  <label
    ><span>Pull Punch</span>
    <input type="number" value="0" name="attr_pull" />
    <button
      type="roll"
      value="Pull Punch: [[d20+@{pull}]]"
      name="roll_bonus_pull"
    />
  </label>
  <label
    ><span>Roll w/ Impact</span>
    <input type="number" value="0" name="attr_roll" />
    <button
      type="roll"
      value="Roll w/ Impact: [[d20+@{roll}]]"
      name="roll_bonus_roll"
    />
  </label>
  <label
    ><span>Body Flip/Throw</span>
    <input type="number" value="0" name="attr_flipthrow" />
    <button
      type="roll"
      value="Body Flip/Throw: [[d20+@{flipthrow}]]"
      name="roll_bonus_flipthrow"
    />
  </label>
  <label
    ><span>Damage</span>
    <input type="text" value="0" name="attr_damage" />
    <button
      type="roll"
      value="?{Add damage modifier?|
          None,Damage: [[@{damage}]]|
          Punch,Damage: [[@{damage}+@{punch}]]|
          P.S. Bonus,Damage: [[@{damage}+@{ps_bonus}]]
        }"
      name="roll_bonus_damage"
    />
  </label>
  <label
    ><span>Dodge: Flight</span>
    <input type="number" value="0" name="attr_dodge_flight" />
    <button
      type="roll"
      value="Dodge in Flight: [[d20+@{dodge_flight}]]"
      name="roll_bonus_dodge_flight"
    />
  </label>
  <label
    >Dodge: Auto
    <input type="number" value="0" name="attr_dodge_auto" />
    <button
      type="roll"
      value="Auto Dodge: [[d20+@{dodge_auto}]]"
      name="roll_bonus_dodge_auto"
    />
  </label>
  <label
    ><span>Dodge: Teleport</span>
    <input type="number" value="0" name="attr_dodge_teleport" />
    <button
      type="roll"
      value="Teleport Dodge: [[d20+@{dodge_teleport}]]"
      name="roll_bonus_dodge_teleport"
    />
  </label>
  <label
    ><span>Dodge: Motion</span>
    <input type="number" value="0" name="attr_dodge_motion" />
    <button
      type="roll"
      value="Dodge in Motion: [[d20+@{dodge_motion}]]"
      name="roll_bonus_dodge_motion"
    />
  </label>
  <label
    ><span>Strike: Range</span>
    <input type="number" value="0" name="attr_strike_range" />
    <button
      type="roll"
      value="Range Strike: [[d20+@{strike_range}]]"
      name="roll_bonus_strike_range"
    />
  </label>
  <label
    ><span>Range: Single</span>
    <input type="number" value="0" name="attr_strike_range_single" />
    <button
      type="roll"
      value="Range Strike: [[d20+@{strike_range_single}]]"
      name="roll_bonus_strike_range_single"
    />
  </label>
  <label
    ><span>Range: Burst</span>
    <input type="number" value="0" name="attr_strike_range_burst" />
    <button
      type="roll"
      value="Range Strike: [[d20+@{strike_range_burst}]]"
      name="roll_bonus_strike_range_burst"
    />
  </label>
  <label
    ><span>Range: Aimed</span>
    <input type="number" value="0" name="attr_strike_range_aimed" />
    <button
      type="roll"
      value="Range Aimed Strike: [[d20+@{strike_range_aimed}]]"
      name="roll_bonus_strike_range_aimed"
    />
  </label>
  <label
    ><span>Range: Aimed Single</span>
    <input type="hidden" value="0" name="attr_strike_range_aimed_single" />
    <span name="attr_strike_range_aimed_single"></span>
    <button
      type="roll"
      value="Range Aimed Single Strike: [[d20+@{strike_range_aimed_single}]]"
      name="roll_bonus_strike_range_aimed_single"
    />
  </label>
  <label
    ><span>Range: Aimed Pulse</span>
    <input type="hidden" value="0" name="attr_strike_range_aimed_pulse" />
    <span name="attr_strike_range_aimed_pulse"></span>
    <button
      type="roll"
      value="Range Aimed Pulse Strike: [[d20+@{strike_range_aimed_pulse}]]"
      name="roll_bonus_strike_range_aimed_pulse"
    />
  </label>
  <label
    ><span>Range: Called</span>
    <input type="number" value="0" name="attr_strike_range_called" />
    <button
      type="roll"
      value="Range Called Strike: [[d20+@{strike_range_called}]]"
      name="roll_bonus_strike_range_called"
    />
  </label>
  <label
    ><span>Range: Called Single</span>
    <input type="hidden" value="0" name="attr_strike_range_called_single" />
    <span name="attr_strike_range_called_single"></span>
    <button
      type="roll"
      value="Range Called Single Strike: [[d20+@{strike_range_called_single}]]"
      name="roll_bonus_strike_range_called_single"
    />
  </label>
  <label
    ><span>Range: Called Pulse</span>
    <input type="hidden" value="0" name="attr_strike_range_called_pulse" />
    <span name="attr_strike_range_called_pulse"></span>
    <button
      type="roll"
      value="Range Called Pulse Strike: [[d20+@{strike_range_called_pulse}]]"
      name="roll_bonus_strike_range_called_pulse"
    />
  </label>
  <label
    ><span>Range: Aimed Called Single</span>
    <input
      type="hidden"
      value="0"
      name="attr_strike_range_aimed_called_single"
    />
    <span name="attr_strike_range_aimed_called_single"></span>
    <button
      type="roll"
      value="Range Aimed Called Single Strike: [[d20+@{strike_range_aimed_called_single}]]"
      name="roll_bonus_strike_range_aimed_called_single"
    />
  </label>
  <label
    ><span>Range: Aimed Called Pulse</span>
    <input
      type="hidden"
      value="0"
      name="attr_strike_range_aimed_called_pulse"
    />
    <span name="attr_strike_range_aimed_called_pulse"></span>
    <button
      type="roll"
      value="Range Aimed Called Pulse Strike: [[d20+@{strike_range_aimed_called_pulse}]]"
      name="roll_bonus_strike_range_aimed_called_pulse"
    />
  </label>
  <label
    ><span>Disarm: Range</span>
    <input type="number" value="0" name="attr_disarm_range" />
    <button
      type="roll"
      value="Range Disarm: [[d20+@{disarm_range}]]"
      name="roll_bonus_disarm_range"
    />
  </label>
  <label
    ><span>Damage: Range</span>
    <input type="text" value="0" name="attr_damage_range" />
    <button
      type="roll"
      value="Range Damage: [[@{damage_range}]]"
      name="roll_bonus_damage_range"
    />
  </label>
  <label
    ><span>Critical</span> <input type="number" value="" name="attr_critical"
  /></label>
  <label
    ><span>Knockout</span> <input type="number" value="" name="attr_knockout"
  /></label>
  <label
    ><span>Death Blow</span>
    <input type="number" value="0" name="attr_deathblow"
  /></label>
</div>
<hr />
<h3>Saving Throws</h3>
<div class="bonus-type-container">
  <label
    ><span>Perception</span>
    <input type="number" value="0" name="attr_perceptioncheck" />
    <button
      type="roll"
      value="Perception Check: [[d20+@{perceptioncheck}]]"
      name="roll_bonus_perceptioncheck"
    />
  </label>
  <label
    ><span>Psionics</span>
    <input type="number" value="0" name="attr_psionics" />
    <button
      type="roll"
      value="Save vs. Psionics: [[d20+@{psionics}]]"
      name="roll_bonus_psionics"
    />
  </label>
  <label
    ><span>Magic</span>
    <input type="number" value="0" name="attr_magic" />
    <button
      type="roll"
      value="Save vs. Magic: [[d20+@{magic}]]"
      name="roll_bonus_magic"
    />
  </label>
  <label
    ><span>Horror Factor</span>
    <input type="number" value="0" name="attr_horrorfactor" />
    <button
      type="roll"
      value="Save vs. Horror Factor: [[d20+@{horrorfactor}]]"
      name="roll_bonus_horrorfactor"
    />
  </label>
  <label
    ><span>Mind Control</span>
    <input type="number" value="0" name="attr_mindcontrol" />
    <button
      type="roll"
      value="Save vs. Mind Control: [[d20+@{mindcontrol}]]"
      name="roll_bonus_mindcontrol"
    />
  </label>
  <label
    ><span>Disease</span>
    <input type="number" value="0" name="attr_disease" />
    <button
      type="roll"
      value="Save vs. Disease: [[d20+@{disease}]]"
      name="roll_bonus_disease"
    />
  </label>
  <label
    ><span>Illusions</span>
    <input type="number" value="0" name="attr_illusions" />
    <button
      type="roll"
      value="Save vs. Illusions: [[d20+@{illusions}]]"
      name="roll_bonus_illusions"
    />
  </label>
  <label
    ><span>Possession</span>
    <input type="number" value="0" name="attr_possession" />
    <button
      type="roll"
      value="Save vs. Possession: [[d20+@{possession}]]"
      name="roll_bonus_possession"
    />
  </label>
  <label
    ><span>Insanity</span>
    <input type="number" value="0" name="attr_insanity" />
    <button
      type="roll"
      value="Save vs. Insanity: [[d20+@{insanity}]]"
      name="roll_bonus_insanity"
    />
  </label>
  <label
    ><span>Pain</span>
    <input type="number" value="0" name="attr_pain" />
    <button
      type="roll"
      value="Save vs. Pain: [[d20+@{pain}]]"
      name="roll_bonus_pain"
    />
  </label>
  <label
    ><span>Lethal Poison</span>
    <input type="number" value="0" name="attr_lethalpoison" />
    <button
      type="roll"
      value="Save vs. Lethal Poison: [[d20+@{lethalpoison}]]"
      name="roll_bonus_lethalpoison"
    />
  </label>
  <label
    ><span>Non-Lethal Poison</span>
    <input type="number" value="0" name="attr_nonlethalpoison" />
    <button
      type="roll"
      value="Save vs. Non-Lethal Poison: [[d20+@{nonlethalpoison}]]"
      name="roll_bonus_nonlethalpoison"
    />
  </label>
  <label
    ><span>Drugs</span>
    <input type="number" value="0" name="attr_drugs" />
    <button
      type="roll"
      value="Save vs. Drugs: [[d20+@{drugs}]]"
      name="roll_bonus_drugs"
    />
  </label>
  <label
    ><span>Curses</span>
    <input type="number" value="0" name="attr_curses" />
    <button
      type="roll"
      value="Save vs. Curses: [[d20+@{curses}]]"
      name="roll_bonus_curses"
    />
  </label>
  <label
    ><span>Coma/Death</span>
    <input type="number" value="0" name="attr_comadeath" />
    <button
      type="roll"
      value="Save vs. Coma/Death: [[d100-@{comadeath}]]"
      name="roll_bonus_comadeath"
    />
  </label>
</div>
<label class="description"
  ><b>Description</b>
  <textarea class="full" name="attr_description" value=""></textarea>
</label>
<div class="macro-help">
  <label
    ><span><b>Row ID:</b></span>
    <input type="text" readonly name="attr_rowid" value=""
  /></label>
</div>

        <!-- endinject -->
      </details>
    </fieldset>
  </div>

  <div class="modifiers">
    <div class="bonuses-container">
      <h3>Modifiers</h3>
      <details>
        <summary><b>Instructions</b></summary>
        <p>
          Complete the repeating sections for your various combat skills and
          modifiers. Skill dropdowns are free-form, so you can type anything in
          them and don't need to select from the list. What's there is just a
          small sample.
        </p>
        <!-- inject:partials/repeated_instructions.html -->
        <p>
  The Modifiers section has fields for <b>anything</b> that can be modified.
  Attributes, PS type, MDC, ISP, PPE, combat bonuses, saving throw bonuses, etc.
  This section is available for any Ability, Psionic, Magic, as well in its own
  Modifiers tab. If you have a magic amulet that gives +1 to save vs. magic,
  create an entry on the Modifier tab and add it. If you have an NG-P7 that does
  1d4*10 damage, create an entry on the Modifier tab and add it. Superhuman
  Speed sets your speed to an absolute value of 44 and adds +2 to parry and +6
  to dodge. Add those in the modifiers section in the spell details on the Magic
  tab. Use the <b>|x|</b> checkbox next to Spd to indicate that the value is
  absolute, and not additive. If adding a Magic Spell, Psionic, or Ability that
  includes modifiers, check the <b>Add to Bonuses</b> checkbox. This will make
  those modifiers available on the Bonuses tab to be used in a Profile (see the
  Bonuses tab instructions for details on Profiles).
</p>
<p>
  Note that each section includes a read-only Row ID that can be used in macros.
</p>
<p>
  Don't forget to copy/paste the power description into the Description field to
  make life easier for your GM. Also use that field for any macros you may need
  like Strike with an arbitrary bonus.
</p>

        <!-- endinject -->
      </details>
      <p>Click <b>Instructions</b> for detailed instructions.</p>
      <div class="repeating-bonuses-outer">
        <fieldset class="repeating_modifiers">
          <details class="info">
            <summary>
              <div class="bonus-thing-heading">
                <b class="click-expand"
                  ><span title="Click for more info">&nbsp;&#9432;</span></b
                >
                <label
                  ><span>Name</span>
                  <input type="text" list="combat-modifiers" name="attr_name" />
                </label>
                <label
                  ><span>Level</span>
                  <input type="number" value="1" name="attr_level" />
                </label>
              </div>
            </summary>
            <!-- inject:partials/repeating_bonuses_details.html -->
            <input type="hidden" name="attr_bonus_id" value="" />
<details>
  <summary>
    <h3>Attributes</h3>
  </summary>
  <div class="bonus-type-container attributes">
    <label
      ><span>I.Q.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_iq"
        title="Intelligence Quotient"
      />
      <label class="abs"
        ><input type="checkbox" value="1" name="attr_iq_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_iq_bonus"
        title="+ Skills %"
      />
      <span name="attr_mod_iq_bonus" title="+ Skills %"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_perception_bonus"
        title="+ Perception (Rifter #13, p.16)"
      />
      <span
        name="attr_mod_perception_bonus"
        title="+ Perception (Rifter #13, p.16)"
      ></span>
    </label>
    <label
      ><span>M.E.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_me"
        title="Mental Endurance"
      />
      <label class="abs"
        ><input type="checkbox" value="1" name="attr_me_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_me_bonus"
        title="+ Save vs. Psionics"
      />
      <span name="attr_mod_me_bonus" title="+ Save vs. Psionics"></span>
    </label>
    <label
      ><span>M.A.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_ma"
        title="Mental Affinity"
      /><label class="abs"
        ><input type="checkbox" value="1" name="attr_ma_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_ma_bonus"
        title="% Trust/Intimidate"
      />
      <span name="attr_mod_ma_bonus" title="% Trust/Intimidate"></span>
    </label>
    <label
      ><span>P.S.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_ps"
        title="Physical Strength"
      /><label class="abs"
        ><input type="checkbox" value="1" name="attr_ps_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_ps_bonus"
        title="+ SDC Damage"
      />
      <span name="attr_mod_ps_bonus" title="+ SDC Damage"></span>
    </label>
    <label
      ><span>P.P.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_pp"
        title="Physical Prowess"
      /><label class="abs"
        ><input type="checkbox" value="1" name="attr_pp_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_pp_bonus"
        title="+ Strike/Parry/Dodge/Entangle/Disarm"
      />
      <span
        name="attr_mod_pp_bonus"
        title="+ Strike/Parry/Dodge/Entangle/Disarm"
      ></span>
    </label>
    <label
      ><span>P.E.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_pe"
        title="Physical Endurance"
      /><label class="abs"
        ><input type="checkbox" value="1" name="attr_pe_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_pe_bonus"
        title="+ Magic/Poison/Toxins"
      />
      <span name="attr_mod_pe_bonus" title="+ Magic/Poison/Toxins"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_pe_coma_bonus"
        title="+ Coma/Death %"
      />
      <span name="attr_mod_pe_coma_bonus" title="+ Coma/Death %"></span>
    </label>
    <label
      ><span>P.B.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_pb"
        title="Physical Beauty"
      /><label class="abs"
        ><input type="checkbox" value="1" name="attr_pb_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_pb_bonus"
        title="% Charm/Impress"
      />
      <span name="attr_mod_pb_bonus" title="% Charm/Impress"></span>
    </label>
    <label
      ><span>Spd</span>
      <input type="number" value="0" name="attr_mod_spd" title="Speed" /><label
        class="abs"
        ><input type="checkbox" value="1" name="attr_spd_abs" />|x|</label
      ></label
    >
  </div>
  <hr />
  <div class="bonus-ps-container">
    <label class="select"
      ><span>PS Type</span>
      <select class="" name="attr_mod_character_ps_type" value="normal">
        <option value="1">Normal</option>
        <option value="2">Augmented</option>
        <option value="3">Robotic</option>
        <option value="3.5">Giant Robotic</option>
        <option value="4">Supernatural</option>
      </select></label
    >
    <label
      ><span>Restrained Punch</span>
      <input type="text" name="attr_mod_restrained_punch" value="0" />
      <select name="attr_mod_restrained_punch_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Punch</span>
      <input type="text" name="attr_mod_punch" value="0" />
      <select name="attr_mod_punch_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Power Punch</span>
      <input type="text" name="attr_mod_power_punch" value="0" />
      <select name="attr_mod_power_punch_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Kick</span>
      <input type="text" name="attr_mod_kick" value="0" />
      <select name="attr_mod_kick_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Leap Kick</span>
      <input type="text" name="attr_mod_leap_kick" value="0" />
      <select name="attr_mod_leap_kick_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select>
    </label>

    <label
      ><span>Lift</span>
      <input type="number" value="0" name="attr_mod_lift" value="0" />
      <span>lbs</span>
    </label>

    <label
      ><span>Carry</span>
      <input type="number" value="0" name="attr_mod_carry" value="0" />
      <span>lbs</span></label
    >

    <label
      ><span>Throw (&frac12; Carry)</span>
      <input type="number" value="0" name="attr_mod_throw_distance" value="0" />
      <span>Feet</span></label
    >

    <label
      ><span>Carry Max</span>
      <input type="number" value="0" name="attr_mod_carry_max" /><span
        >Minutes</span
      ></label
    >

    <label
      ><span>Carry (Running)</span>
      <input type="number" value="0" name="attr_mod_carry_running" /><span
        >Minutes</span
      ></label
    >

    <label
      ><span>Hold Max.</span>
      <input type="number" value="0" name="attr_mod_hold_max" /><span
        >Melees</span
      ></label
    >
  </div>
  <hr />
</details>
<div class="bonus-type-container">
  <label
    ><span title="Hit Points">H.P.</span
    ><input type="number" value="0" name="attr_hp"
  /></label>
  <label
    ><span>S.D.C.</span><input type="number" value="0" name="attr_sdc"
  /></label>
  <label
    ><span>A.R.</span><input type="number" value="0" name="attr_ar"
  /></label>
  <label
    ><span>M.D.C.</span><input type="number" value="0" name="attr_mdc"
  /></label>
  <label
    ><span>P.P.E.</span><input type="number" value="0" name="attr_ppe"
  /></label>
  <label
    ><span>I.S.P.</span><input type="number" value="0" name="attr_isp"
  /></label>
  <label
    ><span>H.F.</span><input type="number" value="0" name="attr_mod_hf" /><label
      class="abs"
      ><input type="checkbox" value="1" name="attr_hf_abs" />|x|</label
    ></label
  >
</div>
<hr />
<h3>Combat</h3>
<div class="bonus-type-container">
  <label
    ><span>Attacks</span>
    <input type="number" value="0" name="attr_attacks" />
  </label>
  <label
    ><span>Initiative</span>
    <input type="number" value="0" name="attr_initiative" />
    <button
      type="roll"
      value="Initiative: [[d20+@{initiative}]]"
      name="roll_bonus_initiative"
    />
  </label>
  <label
    ><span>Strike</span>
    <input type="number" value="0" name="attr_strike" />
    <button
      type="roll"
      value="Strike: [[d20+@{strike}]]"
      name="roll_bonus_strike"
    />
  </label>
  <label
    ><span>Parry</span>
    <input type="number" value="0" name="attr_parry" />
    <button
      type="roll"
      value="Parry: [[d20+@{parry}]]"
      name="roll_bonus_parry"
    />
  </label>
  <label
    ><span>Dodge</span>
    <input type="number" value="0" name="attr_dodge" />
    <button
      type="roll"
      value="Dodge: [[d20+@{dodge}]]"
      name="roll_bonus_dodge"
    />
  </label>
  <label
    ><span>Throw</span>
    <input type="number" value="0" name="attr_throw" />
    <button
      type="roll"
      value="Throw: [[d20+@{throw}]]"
      name="roll_bonus_throw"
    />
  </label>
  <label
    ><span>Disarm</span>
    <input type="number" value="0" name="attr_disarm" />
    <button
      type="roll"
      value="Disarm: [[d20+@{disarm}]]"
      name="roll_bonus_disarm"
    />
  </label>
  <label
    ><span>Entangle</span>
    <input type="number" value="0" name="attr_entangle" />
    <button
      type="roll"
      value="Entangle: [[d20+@{entangle}]]"
      name="roll_bonus_entangle"
    />
  </label>
  <label
    ><span>Pull Punch</span>
    <input type="number" value="0" name="attr_pull" />
    <button
      type="roll"
      value="Pull Punch: [[d20+@{pull}]]"
      name="roll_bonus_pull"
    />
  </label>
  <label
    ><span>Roll w/ Impact</span>
    <input type="number" value="0" name="attr_roll" />
    <button
      type="roll"
      value="Roll w/ Impact: [[d20+@{roll}]]"
      name="roll_bonus_roll"
    />
  </label>
  <label
    ><span>Body Flip/Throw</span>
    <input type="number" value="0" name="attr_flipthrow" />
    <button
      type="roll"
      value="Body Flip/Throw: [[d20+@{flipthrow}]]"
      name="roll_bonus_flipthrow"
    />
  </label>
  <label
    ><span>Damage</span>
    <input type="text" value="0" name="attr_damage" />
    <button
      type="roll"
      value="?{Add damage modifier?|
          None,Damage: [[@{damage}]]|
          Punch,Damage: [[@{damage}+@{punch}]]|
          P.S. Bonus,Damage: [[@{damage}+@{ps_bonus}]]
        }"
      name="roll_bonus_damage"
    />
  </label>
  <label
    ><span>Dodge: Flight</span>
    <input type="number" value="0" name="attr_dodge_flight" />
    <button
      type="roll"
      value="Dodge in Flight: [[d20+@{dodge_flight}]]"
      name="roll_bonus_dodge_flight"
    />
  </label>
  <label
    >Dodge: Auto
    <input type="number" value="0" name="attr_dodge_auto" />
    <button
      type="roll"
      value="Auto Dodge: [[d20+@{dodge_auto}]]"
      name="roll_bonus_dodge_auto"
    />
  </label>
  <label
    ><span>Dodge: Teleport</span>
    <input type="number" value="0" name="attr_dodge_teleport" />
    <button
      type="roll"
      value="Teleport Dodge: [[d20+@{dodge_teleport}]]"
      name="roll_bonus_dodge_teleport"
    />
  </label>
  <label
    ><span>Dodge: Motion</span>
    <input type="number" value="0" name="attr_dodge_motion" />
    <button
      type="roll"
      value="Dodge in Motion: [[d20+@{dodge_motion}]]"
      name="roll_bonus_dodge_motion"
    />
  </label>
  <label
    ><span>Strike: Range</span>
    <input type="number" value="0" name="attr_strike_range" />
    <button
      type="roll"
      value="Range Strike: [[d20+@{strike_range}]]"
      name="roll_bonus_strike_range"
    />
  </label>
  <label
    ><span>Range: Single</span>
    <input type="number" value="0" name="attr_strike_range_single" />
    <button
      type="roll"
      value="Range Strike: [[d20+@{strike_range_single}]]"
      name="roll_bonus_strike_range_single"
    />
  </label>
  <label
    ><span>Range: Burst</span>
    <input type="number" value="0" name="attr_strike_range_burst" />
    <button
      type="roll"
      value="Range Strike: [[d20+@{strike_range_burst}]]"
      name="roll_bonus_strike_range_burst"
    />
  </label>
  <label
    ><span>Range: Aimed</span>
    <input type="number" value="0" name="attr_strike_range_aimed" />
    <button
      type="roll"
      value="Range Aimed Strike: [[d20+@{strike_range_aimed}]]"
      name="roll_bonus_strike_range_aimed"
    />
  </label>
  <label
    ><span>Range: Aimed Single</span>
    <input type="hidden" value="0" name="attr_strike_range_aimed_single" />
    <span name="attr_strike_range_aimed_single"></span>
    <button
      type="roll"
      value="Range Aimed Single Strike: [[d20+@{strike_range_aimed_single}]]"
      name="roll_bonus_strike_range_aimed_single"
    />
  </label>
  <label
    ><span>Range: Aimed Pulse</span>
    <input type="hidden" value="0" name="attr_strike_range_aimed_pulse" />
    <span name="attr_strike_range_aimed_pulse"></span>
    <button
      type="roll"
      value="Range Aimed Pulse Strike: [[d20+@{strike_range_aimed_pulse}]]"
      name="roll_bonus_strike_range_aimed_pulse"
    />
  </label>
  <label
    ><span>Range: Called</span>
    <input type="number" value="0" name="attr_strike_range_called" />
    <button
      type="roll"
      value="Range Called Strike: [[d20+@{strike_range_called}]]"
      name="roll_bonus_strike_range_called"
    />
  </label>
  <label
    ><span>Range: Called Single</span>
    <input type="hidden" value="0" name="attr_strike_range_called_single" />
    <span name="attr_strike_range_called_single"></span>
    <button
      type="roll"
      value="Range Called Single Strike: [[d20+@{strike_range_called_single}]]"
      name="roll_bonus_strike_range_called_single"
    />
  </label>
  <label
    ><span>Range: Called Pulse</span>
    <input type="hidden" value="0" name="attr_strike_range_called_pulse" />
    <span name="attr_strike_range_called_pulse"></span>
    <button
      type="roll"
      value="Range Called Pulse Strike: [[d20+@{strike_range_called_pulse}]]"
      name="roll_bonus_strike_range_called_pulse"
    />
  </label>
  <label
    ><span>Range: Aimed Called Single</span>
    <input
      type="hidden"
      value="0"
      name="attr_strike_range_aimed_called_single"
    />
    <span name="attr_strike_range_aimed_called_single"></span>
    <button
      type="roll"
      value="Range Aimed Called Single Strike: [[d20+@{strike_range_aimed_called_single}]]"
      name="roll_bonus_strike_range_aimed_called_single"
    />
  </label>
  <label
    ><span>Range: Aimed Called Pulse</span>
    <input
      type="hidden"
      value="0"
      name="attr_strike_range_aimed_called_pulse"
    />
    <span name="attr_strike_range_aimed_called_pulse"></span>
    <button
      type="roll"
      value="Range Aimed Called Pulse Strike: [[d20+@{strike_range_aimed_called_pulse}]]"
      name="roll_bonus_strike_range_aimed_called_pulse"
    />
  </label>
  <label
    ><span>Disarm: Range</span>
    <input type="number" value="0" name="attr_disarm_range" />
    <button
      type="roll"
      value="Range Disarm: [[d20+@{disarm_range}]]"
      name="roll_bonus_disarm_range"
    />
  </label>
  <label
    ><span>Damage: Range</span>
    <input type="text" value="0" name="attr_damage_range" />
    <button
      type="roll"
      value="Range Damage: [[@{damage_range}]]"
      name="roll_bonus_damage_range"
    />
  </label>
  <label
    ><span>Critical</span> <input type="number" value="" name="attr_critical"
  /></label>
  <label
    ><span>Knockout</span> <input type="number" value="" name="attr_knockout"
  /></label>
  <label
    ><span>Death Blow</span>
    <input type="number" value="0" name="attr_deathblow"
  /></label>
</div>
<hr />
<h3>Saving Throws</h3>
<div class="bonus-type-container">
  <label
    ><span>Perception</span>
    <input type="number" value="0" name="attr_perceptioncheck" />
    <button
      type="roll"
      value="Perception Check: [[d20+@{perceptioncheck}]]"
      name="roll_bonus_perceptioncheck"
    />
  </label>
  <label
    ><span>Psionics</span>
    <input type="number" value="0" name="attr_psionics" />
    <button
      type="roll"
      value="Save vs. Psionics: [[d20+@{psionics}]]"
      name="roll_bonus_psionics"
    />
  </label>
  <label
    ><span>Magic</span>
    <input type="number" value="0" name="attr_magic" />
    <button
      type="roll"
      value="Save vs. Magic: [[d20+@{magic}]]"
      name="roll_bonus_magic"
    />
  </label>
  <label
    ><span>Horror Factor</span>
    <input type="number" value="0" name="attr_horrorfactor" />
    <button
      type="roll"
      value="Save vs. Horror Factor: [[d20+@{horrorfactor}]]"
      name="roll_bonus_horrorfactor"
    />
  </label>
  <label
    ><span>Mind Control</span>
    <input type="number" value="0" name="attr_mindcontrol" />
    <button
      type="roll"
      value="Save vs. Mind Control: [[d20+@{mindcontrol}]]"
      name="roll_bonus_mindcontrol"
    />
  </label>
  <label
    ><span>Disease</span>
    <input type="number" value="0" name="attr_disease" />
    <button
      type="roll"
      value="Save vs. Disease: [[d20+@{disease}]]"
      name="roll_bonus_disease"
    />
  </label>
  <label
    ><span>Illusions</span>
    <input type="number" value="0" name="attr_illusions" />
    <button
      type="roll"
      value="Save vs. Illusions: [[d20+@{illusions}]]"
      name="roll_bonus_illusions"
    />
  </label>
  <label
    ><span>Possession</span>
    <input type="number" value="0" name="attr_possession" />
    <button
      type="roll"
      value="Save vs. Possession: [[d20+@{possession}]]"
      name="roll_bonus_possession"
    />
  </label>
  <label
    ><span>Insanity</span>
    <input type="number" value="0" name="attr_insanity" />
    <button
      type="roll"
      value="Save vs. Insanity: [[d20+@{insanity}]]"
      name="roll_bonus_insanity"
    />
  </label>
  <label
    ><span>Pain</span>
    <input type="number" value="0" name="attr_pain" />
    <button
      type="roll"
      value="Save vs. Pain: [[d20+@{pain}]]"
      name="roll_bonus_pain"
    />
  </label>
  <label
    ><span>Lethal Poison</span>
    <input type="number" value="0" name="attr_lethalpoison" />
    <button
      type="roll"
      value="Save vs. Lethal Poison: [[d20+@{lethalpoison}]]"
      name="roll_bonus_lethalpoison"
    />
  </label>
  <label
    ><span>Non-Lethal Poison</span>
    <input type="number" value="0" name="attr_nonlethalpoison" />
    <button
      type="roll"
      value="Save vs. Non-Lethal Poison: [[d20+@{nonlethalpoison}]]"
      name="roll_bonus_nonlethalpoison"
    />
  </label>
  <label
    ><span>Drugs</span>
    <input type="number" value="0" name="attr_drugs" />
    <button
      type="roll"
      value="Save vs. Drugs: [[d20+@{drugs}]]"
      name="roll_bonus_drugs"
    />
  </label>
  <label
    ><span>Curses</span>
    <input type="number" value="0" name="attr_curses" />
    <button
      type="roll"
      value="Save vs. Curses: [[d20+@{curses}]]"
      name="roll_bonus_curses"
    />
  </label>
  <label
    ><span>Coma/Death</span>
    <input type="number" value="0" name="attr_comadeath" />
    <button
      type="roll"
      value="Save vs. Coma/Death: [[d100-@{comadeath}]]"
      name="roll_bonus_comadeath"
    />
  </label>
</div>
<label class="description"
  ><b>Description</b>
  <textarea class="full" name="attr_description" value=""></textarea>
</label>
<div class="macro-help">
  <label
    ><span><b>Row ID:</b></span>
    <input type="text" readonly name="attr_rowid" value=""
  /></label>
</div>

            <!-- endinject -->
          </details>
        </fieldset>
      </div>
    </div>
  </div>

  <div class="bonuses">
    <div class="bonuses-container">
      <h3>Aggregated Bonuses</h3>
      <div class="combat-combined">
        <details>
          <summary><b>Instructions</b></summary>
          <p></p>
          <p>
            Any modifiers you add on the Modifiers tab will appear as checkboxes
            here. Additionally any Abilities, Magic, or Psionics that you
            checked <b>Add to Bonuses</b> will appear here. Any Weapon
            Proficiencies you add on the WPs tab will appear on this page as
            well.
          </p>
          <p>
            Create a new Profile in the Profiles section. Check all of the items
            that make up that particular profile, click the <b>&#9432;</b> icon
            to expand the details, and click the
            <b>Apply Checked Modifiers to this Profile</b> button. This will
            aggregate all of the bonuses and values from all of the checked
            modifiers and store them in that profile. In simple cases, this may
            be all you need - stack all of your gear into one Profile, and
            that's that. But you might have a profile where you have some TW
            Armor that grants abilities, so that's a different profile than your
            default. Or you might have a series of spells you cast to buff up,
            which you might want to add to another profile. Or you might be a
            Glitter Boy pilot that has a totally different set of gear and
            bonuses inside and outside his armor.
          </p>
          <p>
            Profiles also allow you to set up different macros with different
            configurations, as you can reference the individual profiles. Note
            that each Profile includes a read-only field with the Row ID for use
            in macros.
          </p>
          <p>
            PP bonus is added to Strike, Parry, Dodge, Throw, Disarm, Entangle,
            Dodge: Flight, Dodge: Auto, Dodge: Teleport, and Dodge: Motion.
            Damage adds everything together as a rollable field, and prompts to
            add Punch damage. Crit/Knockout/Death Blow use the lowest of the
            available options (ex. Crit: 17 is better than Crit: 19).
          </p>
          <p>
            The first Profile in the list is considered the
            <b>Default</b> profile and is used to perform global calculations
            like speed over time and skill bonuses. Click the
            <b>Modify</b> button and drag to reorder as needed.
          </p>
          <p>
            Note that profiles aren't cumulative, but you can make multiple
            profiles that are very similar with only one or two differences.
          </p>
        </details>
        <p>Click <b>Instructions</b> for detailed instructions.</p>
        <fieldset class="repeating_bonusselections">
          <label>
            <input type="checkbox" name="attr_enabled" value="1" />
            <span name="attr_name"></span
          ></label>
          <input type="hidden" name="attr_name" value="" />
          <input type="hidden" name="attr_bonus_id" value="" />
        </fieldset>
        <div class="selected-ids">
          <b>Selected IDs</b>
          <input
            class="full"
            type="text"
            name="attr_bonus_ids_output"
            value=""
          />
        </div>
        <hr />
        <div class="profiles repeating-bonuses-outer">
          <h3>Profiles</h3>
          <fieldset class="repeating_profiles">
            <details class="info">
              <summary>
                <div class="bonus-thing-heading">
                  <b class="click-expand"
                    ><span title="Click for more info">&nbsp;&#9432;</span></b
                  >
                  <label
                    ><span>Name</span>
                    <input
                      type="text"
                      list="combat-modifiers"
                      name="attr_name"
                    />
                  </label>
                  <label
                    ><span>Level</span>
                    <input type="number" value="1" name="attr_level" />
                  </label>
                </div>
              </summary>
              <div class="profile-management">
                <input type="text" class="full" name="attr_bonus_ids" />
                <input type="hidden" name="attr_bonus_names" />
                <div class="bonus-names">
                  <span name="attr_bonus_names"></span>
                </div>
                <button
                  type="action"
                  name="act_copybonusids"
                  class="metal linear small"
                >
                  Apply Checked Modifiers to this Profile
                </button>
                <!-- <button type="action" name="act_checkbonusids">
                  Apply this Profile to Selected IDs
                </button> -->
                <button
                  type="action"
                  name="act_updateprofile"
                  class="metal linear small"
                >
                  Update Profile if Attributes or Modifiers have changed
                </button>
              </div>
              <!-- inject:partials/repeating_bonuses_details.html -->
              <input type="hidden" name="attr_bonus_id" value="" />
<details>
  <summary>
    <h3>Attributes</h3>
  </summary>
  <div class="bonus-type-container attributes">
    <label
      ><span>I.Q.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_iq"
        title="Intelligence Quotient"
      />
      <label class="abs"
        ><input type="checkbox" value="1" name="attr_iq_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_iq_bonus"
        title="+ Skills %"
      />
      <span name="attr_mod_iq_bonus" title="+ Skills %"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_perception_bonus"
        title="+ Perception (Rifter #13, p.16)"
      />
      <span
        name="attr_mod_perception_bonus"
        title="+ Perception (Rifter #13, p.16)"
      ></span>
    </label>
    <label
      ><span>M.E.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_me"
        title="Mental Endurance"
      />
      <label class="abs"
        ><input type="checkbox" value="1" name="attr_me_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_me_bonus"
        title="+ Save vs. Psionics"
      />
      <span name="attr_mod_me_bonus" title="+ Save vs. Psionics"></span>
    </label>
    <label
      ><span>M.A.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_ma"
        title="Mental Affinity"
      /><label class="abs"
        ><input type="checkbox" value="1" name="attr_ma_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_ma_bonus"
        title="% Trust/Intimidate"
      />
      <span name="attr_mod_ma_bonus" title="% Trust/Intimidate"></span>
    </label>
    <label
      ><span>P.S.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_ps"
        title="Physical Strength"
      /><label class="abs"
        ><input type="checkbox" value="1" name="attr_ps_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_ps_bonus"
        title="+ SDC Damage"
      />
      <span name="attr_mod_ps_bonus" title="+ SDC Damage"></span>
    </label>
    <label
      ><span>P.P.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_pp"
        title="Physical Prowess"
      /><label class="abs"
        ><input type="checkbox" value="1" name="attr_pp_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_pp_bonus"
        title="+ Strike/Parry/Dodge/Entangle/Disarm"
      />
      <span
        name="attr_mod_pp_bonus"
        title="+ Strike/Parry/Dodge/Entangle/Disarm"
      ></span>
    </label>
    <label
      ><span>P.E.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_pe"
        title="Physical Endurance"
      /><label class="abs"
        ><input type="checkbox" value="1" name="attr_pe_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_pe_bonus"
        title="+ Magic/Poison/Toxins"
      />
      <span name="attr_mod_pe_bonus" title="+ Magic/Poison/Toxins"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_pe_coma_bonus"
        title="+ Coma/Death %"
      />
      <span name="attr_mod_pe_coma_bonus" title="+ Coma/Death %"></span>
    </label>
    <label
      ><span>P.B.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_pb"
        title="Physical Beauty"
      /><label class="abs"
        ><input type="checkbox" value="1" name="attr_pb_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_pb_bonus"
        title="% Charm/Impress"
      />
      <span name="attr_mod_pb_bonus" title="% Charm/Impress"></span>
    </label>
    <label
      ><span>Spd</span>
      <input type="number" value="0" name="attr_mod_spd" title="Speed" /><label
        class="abs"
        ><input type="checkbox" value="1" name="attr_spd_abs" />|x|</label
      ></label
    >
  </div>
  <hr />
  <div class="bonus-ps-container">
    <label class="select"
      ><span>PS Type</span>
      <select class="" name="attr_mod_character_ps_type" value="normal">
        <option value="1">Normal</option>
        <option value="2">Augmented</option>
        <option value="3">Robotic</option>
        <option value="3.5">Giant Robotic</option>
        <option value="4">Supernatural</option>
      </select></label
    >
    <label
      ><span>Restrained Punch</span>
      <input type="text" name="attr_mod_restrained_punch" value="0" />
      <select name="attr_mod_restrained_punch_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Punch</span>
      <input type="text" name="attr_mod_punch" value="0" />
      <select name="attr_mod_punch_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Power Punch</span>
      <input type="text" name="attr_mod_power_punch" value="0" />
      <select name="attr_mod_power_punch_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Kick</span>
      <input type="text" name="attr_mod_kick" value="0" />
      <select name="attr_mod_kick_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Leap Kick</span>
      <input type="text" name="attr_mod_leap_kick" value="0" />
      <select name="attr_mod_leap_kick_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select>
    </label>

    <label
      ><span>Lift</span>
      <input type="number" value="0" name="attr_mod_lift" value="0" />
      <span>lbs</span>
    </label>

    <label
      ><span>Carry</span>
      <input type="number" value="0" name="attr_mod_carry" value="0" />
      <span>lbs</span></label
    >

    <label
      ><span>Throw (&frac12; Carry)</span>
      <input type="number" value="0" name="attr_mod_throw_distance" value="0" />
      <span>Feet</span></label
    >

    <label
      ><span>Carry Max</span>
      <input type="number" value="0" name="attr_mod_carry_max" /><span
        >Minutes</span
      ></label
    >

    <label
      ><span>Carry (Running)</span>
      <input type="number" value="0" name="attr_mod_carry_running" /><span
        >Minutes</span
      ></label
    >

    <label
      ><span>Hold Max.</span>
      <input type="number" value="0" name="attr_mod_hold_max" /><span
        >Melees</span
      ></label
    >
  </div>
  <hr />
</details>
<div class="bonus-type-container">
  <label
    ><span title="Hit Points">H.P.</span
    ><input type="number" value="0" name="attr_hp"
  /></label>
  <label
    ><span>S.D.C.</span><input type="number" value="0" name="attr_sdc"
  /></label>
  <label
    ><span>A.R.</span><input type="number" value="0" name="attr_ar"
  /></label>
  <label
    ><span>M.D.C.</span><input type="number" value="0" name="attr_mdc"
  /></label>
  <label
    ><span>P.P.E.</span><input type="number" value="0" name="attr_ppe"
  /></label>
  <label
    ><span>I.S.P.</span><input type="number" value="0" name="attr_isp"
  /></label>
  <label
    ><span>H.F.</span><input type="number" value="0" name="attr_mod_hf" /><label
      class="abs"
      ><input type="checkbox" value="1" name="attr_hf_abs" />|x|</label
    ></label
  >
</div>
<hr />
<h3>Combat</h3>
<div class="bonus-type-container">
  <label
    ><span>Attacks</span>
    <input type="number" value="0" name="attr_attacks" />
  </label>
  <label
    ><span>Initiative</span>
    <input type="number" value="0" name="attr_initiative" />
    <button
      type="roll"
      value="Initiative: [[d20+@{initiative}]]"
      name="roll_bonus_initiative"
    />
  </label>
  <label
    ><span>Strike</span>
    <input type="number" value="0" name="attr_strike" />
    <button
      type="roll"
      value="Strike: [[d20+@{strike}]]"
      name="roll_bonus_strike"
    />
  </label>
  <label
    ><span>Parry</span>
    <input type="number" value="0" name="attr_parry" />
    <button
      type="roll"
      value="Parry: [[d20+@{parry}]]"
      name="roll_bonus_parry"
    />
  </label>
  <label
    ><span>Dodge</span>
    <input type="number" value="0" name="attr_dodge" />
    <button
      type="roll"
      value="Dodge: [[d20+@{dodge}]]"
      name="roll_bonus_dodge"
    />
  </label>
  <label
    ><span>Throw</span>
    <input type="number" value="0" name="attr_throw" />
    <button
      type="roll"
      value="Throw: [[d20+@{throw}]]"
      name="roll_bonus_throw"
    />
  </label>
  <label
    ><span>Disarm</span>
    <input type="number" value="0" name="attr_disarm" />
    <button
      type="roll"
      value="Disarm: [[d20+@{disarm}]]"
      name="roll_bonus_disarm"
    />
  </label>
  <label
    ><span>Entangle</span>
    <input type="number" value="0" name="attr_entangle" />
    <button
      type="roll"
      value="Entangle: [[d20+@{entangle}]]"
      name="roll_bonus_entangle"
    />
  </label>
  <label
    ><span>Pull Punch</span>
    <input type="number" value="0" name="attr_pull" />
    <button
      type="roll"
      value="Pull Punch: [[d20+@{pull}]]"
      name="roll_bonus_pull"
    />
  </label>
  <label
    ><span>Roll w/ Impact</span>
    <input type="number" value="0" name="attr_roll" />
    <button
      type="roll"
      value="Roll w/ Impact: [[d20+@{roll}]]"
      name="roll_bonus_roll"
    />
  </label>
  <label
    ><span>Body Flip/Throw</span>
    <input type="number" value="0" name="attr_flipthrow" />
    <button
      type="roll"
      value="Body Flip/Throw: [[d20+@{flipthrow}]]"
      name="roll_bonus_flipthrow"
    />
  </label>
  <label
    ><span>Damage</span>
    <input type="text" value="0" name="attr_damage" />
    <button
      type="roll"
      value="?{Add damage modifier?|
          None,Damage: [[@{damage}]]|
          Punch,Damage: [[@{damage}+@{punch}]]|
          P.S. Bonus,Damage: [[@{damage}+@{ps_bonus}]]
        }"
      name="roll_bonus_damage"
    />
  </label>
  <label
    ><span>Dodge: Flight</span>
    <input type="number" value="0" name="attr_dodge_flight" />
    <button
      type="roll"
      value="Dodge in Flight: [[d20+@{dodge_flight}]]"
      name="roll_bonus_dodge_flight"
    />
  </label>
  <label
    >Dodge: Auto
    <input type="number" value="0" name="attr_dodge_auto" />
    <button
      type="roll"
      value="Auto Dodge: [[d20+@{dodge_auto}]]"
      name="roll_bonus_dodge_auto"
    />
  </label>
  <label
    ><span>Dodge: Teleport</span>
    <input type="number" value="0" name="attr_dodge_teleport" />
    <button
      type="roll"
      value="Teleport Dodge: [[d20+@{dodge_teleport}]]"
      name="roll_bonus_dodge_teleport"
    />
  </label>
  <label
    ><span>Dodge: Motion</span>
    <input type="number" value="0" name="attr_dodge_motion" />
    <button
      type="roll"
      value="Dodge in Motion: [[d20+@{dodge_motion}]]"
      name="roll_bonus_dodge_motion"
    />
  </label>
  <label
    ><span>Strike: Range</span>
    <input type="number" value="0" name="attr_strike_range" />
    <button
      type="roll"
      value="Range Strike: [[d20+@{strike_range}]]"
      name="roll_bonus_strike_range"
    />
  </label>
  <label
    ><span>Range: Single</span>
    <input type="number" value="0" name="attr_strike_range_single" />
    <button
      type="roll"
      value="Range Strike: [[d20+@{strike_range_single}]]"
      name="roll_bonus_strike_range_single"
    />
  </label>
  <label
    ><span>Range: Burst</span>
    <input type="number" value="0" name="attr_strike_range_burst" />
    <button
      type="roll"
      value="Range Strike: [[d20+@{strike_range_burst}]]"
      name="roll_bonus_strike_range_burst"
    />
  </label>
  <label
    ><span>Range: Aimed</span>
    <input type="number" value="0" name="attr_strike_range_aimed" />
    <button
      type="roll"
      value="Range Aimed Strike: [[d20+@{strike_range_aimed}]]"
      name="roll_bonus_strike_range_aimed"
    />
  </label>
  <label
    ><span>Range: Aimed Single</span>
    <input type="hidden" value="0" name="attr_strike_range_aimed_single" />
    <span name="attr_strike_range_aimed_single"></span>
    <button
      type="roll"
      value="Range Aimed Single Strike: [[d20+@{strike_range_aimed_single}]]"
      name="roll_bonus_strike_range_aimed_single"
    />
  </label>
  <label
    ><span>Range: Aimed Pulse</span>
    <input type="hidden" value="0" name="attr_strike_range_aimed_pulse" />
    <span name="attr_strike_range_aimed_pulse"></span>
    <button
      type="roll"
      value="Range Aimed Pulse Strike: [[d20+@{strike_range_aimed_pulse}]]"
      name="roll_bonus_strike_range_aimed_pulse"
    />
  </label>
  <label
    ><span>Range: Called</span>
    <input type="number" value="0" name="attr_strike_range_called" />
    <button
      type="roll"
      value="Range Called Strike: [[d20+@{strike_range_called}]]"
      name="roll_bonus_strike_range_called"
    />
  </label>
  <label
    ><span>Range: Called Single</span>
    <input type="hidden" value="0" name="attr_strike_range_called_single" />
    <span name="attr_strike_range_called_single"></span>
    <button
      type="roll"
      value="Range Called Single Strike: [[d20+@{strike_range_called_single}]]"
      name="roll_bonus_strike_range_called_single"
    />
  </label>
  <label
    ><span>Range: Called Pulse</span>
    <input type="hidden" value="0" name="attr_strike_range_called_pulse" />
    <span name="attr_strike_range_called_pulse"></span>
    <button
      type="roll"
      value="Range Called Pulse Strike: [[d20+@{strike_range_called_pulse}]]"
      name="roll_bonus_strike_range_called_pulse"
    />
  </label>
  <label
    ><span>Range: Aimed Called Single</span>
    <input
      type="hidden"
      value="0"
      name="attr_strike_range_aimed_called_single"
    />
    <span name="attr_strike_range_aimed_called_single"></span>
    <button
      type="roll"
      value="Range Aimed Called Single Strike: [[d20+@{strike_range_aimed_called_single}]]"
      name="roll_bonus_strike_range_aimed_called_single"
    />
  </label>
  <label
    ><span>Range: Aimed Called Pulse</span>
    <input
      type="hidden"
      value="0"
      name="attr_strike_range_aimed_called_pulse"
    />
    <span name="attr_strike_range_aimed_called_pulse"></span>
    <button
      type="roll"
      value="Range Aimed Called Pulse Strike: [[d20+@{strike_range_aimed_called_pulse}]]"
      name="roll_bonus_strike_range_aimed_called_pulse"
    />
  </label>
  <label
    ><span>Disarm: Range</span>
    <input type="number" value="0" name="attr_disarm_range" />
    <button
      type="roll"
      value="Range Disarm: [[d20+@{disarm_range}]]"
      name="roll_bonus_disarm_range"
    />
  </label>
  <label
    ><span>Damage: Range</span>
    <input type="text" value="0" name="attr_damage_range" />
    <button
      type="roll"
      value="Range Damage: [[@{damage_range}]]"
      name="roll_bonus_damage_range"
    />
  </label>
  <label
    ><span>Critical</span> <input type="number" value="" name="attr_critical"
  /></label>
  <label
    ><span>Knockout</span> <input type="number" value="" name="attr_knockout"
  /></label>
  <label
    ><span>Death Blow</span>
    <input type="number" value="0" name="attr_deathblow"
  /></label>
</div>
<hr />
<h3>Saving Throws</h3>
<div class="bonus-type-container">
  <label
    ><span>Perception</span>
    <input type="number" value="0" name="attr_perceptioncheck" />
    <button
      type="roll"
      value="Perception Check: [[d20+@{perceptioncheck}]]"
      name="roll_bonus_perceptioncheck"
    />
  </label>
  <label
    ><span>Psionics</span>
    <input type="number" value="0" name="attr_psionics" />
    <button
      type="roll"
      value="Save vs. Psionics: [[d20+@{psionics}]]"
      name="roll_bonus_psionics"
    />
  </label>
  <label
    ><span>Magic</span>
    <input type="number" value="0" name="attr_magic" />
    <button
      type="roll"
      value="Save vs. Magic: [[d20+@{magic}]]"
      name="roll_bonus_magic"
    />
  </label>
  <label
    ><span>Horror Factor</span>
    <input type="number" value="0" name="attr_horrorfactor" />
    <button
      type="roll"
      value="Save vs. Horror Factor: [[d20+@{horrorfactor}]]"
      name="roll_bonus_horrorfactor"
    />
  </label>
  <label
    ><span>Mind Control</span>
    <input type="number" value="0" name="attr_mindcontrol" />
    <button
      type="roll"
      value="Save vs. Mind Control: [[d20+@{mindcontrol}]]"
      name="roll_bonus_mindcontrol"
    />
  </label>
  <label
    ><span>Disease</span>
    <input type="number" value="0" name="attr_disease" />
    <button
      type="roll"
      value="Save vs. Disease: [[d20+@{disease}]]"
      name="roll_bonus_disease"
    />
  </label>
  <label
    ><span>Illusions</span>
    <input type="number" value="0" name="attr_illusions" />
    <button
      type="roll"
      value="Save vs. Illusions: [[d20+@{illusions}]]"
      name="roll_bonus_illusions"
    />
  </label>
  <label
    ><span>Possession</span>
    <input type="number" value="0" name="attr_possession" />
    <button
      type="roll"
      value="Save vs. Possession: [[d20+@{possession}]]"
      name="roll_bonus_possession"
    />
  </label>
  <label
    ><span>Insanity</span>
    <input type="number" value="0" name="attr_insanity" />
    <button
      type="roll"
      value="Save vs. Insanity: [[d20+@{insanity}]]"
      name="roll_bonus_insanity"
    />
  </label>
  <label
    ><span>Pain</span>
    <input type="number" value="0" name="attr_pain" />
    <button
      type="roll"
      value="Save vs. Pain: [[d20+@{pain}]]"
      name="roll_bonus_pain"
    />
  </label>
  <label
    ><span>Lethal Poison</span>
    <input type="number" value="0" name="attr_lethalpoison" />
    <button
      type="roll"
      value="Save vs. Lethal Poison: [[d20+@{lethalpoison}]]"
      name="roll_bonus_lethalpoison"
    />
  </label>
  <label
    ><span>Non-Lethal Poison</span>
    <input type="number" value="0" name="attr_nonlethalpoison" />
    <button
      type="roll"
      value="Save vs. Non-Lethal Poison: [[d20+@{nonlethalpoison}]]"
      name="roll_bonus_nonlethalpoison"
    />
  </label>
  <label
    ><span>Drugs</span>
    <input type="number" value="0" name="attr_drugs" />
    <button
      type="roll"
      value="Save vs. Drugs: [[d20+@{drugs}]]"
      name="roll_bonus_drugs"
    />
  </label>
  <label
    ><span>Curses</span>
    <input type="number" value="0" name="attr_curses" />
    <button
      type="roll"
      value="Save vs. Curses: [[d20+@{curses}]]"
      name="roll_bonus_curses"
    />
  </label>
  <label
    ><span>Coma/Death</span>
    <input type="number" value="0" name="attr_comadeath" />
    <button
      type="roll"
      value="Save vs. Coma/Death: [[d100-@{comadeath}]]"
      name="roll_bonus_comadeath"
    />
  </label>
</div>
<label class="description"
  ><b>Description</b>
  <textarea class="full" name="attr_description" value=""></textarea>
</label>
<div class="macro-help">
  <label
    ><span><b>Row ID:</b></span>
    <input type="text" readonly name="attr_rowid" value=""
  /></label>
</div>

              <!-- endinject -->
            </details>
          </fieldset>
        </div>
        <hr />
      </div>
      <div class="bonus-sources repeating-bonuses-outer">
        <h3>Bonus Sources</h3>
        <fieldset class="repeating_bonuses">
          <input type="hidden" name="attr_selection_id" value="" />
          <details class="info">
            <summary>
              <div class="bonus-thing-heading">
                <b class="click-expand"
                  ><span title="Click for more info">&nbsp;&#9432;</span></b
                >
                <label
                  ><span>Name</span>
                  <input type="text" list="combat-modifiers" name="attr_name" />
                </label>
                <label
                  ><span>Level</span>
                  <input type="number" value="1" name="attr_level" />
                </label>
              </div>
            </summary>
            <!-- inject:partials/repeating_bonuses_details.html -->
            <input type="hidden" name="attr_bonus_id" value="" />
<details>
  <summary>
    <h3>Attributes</h3>
  </summary>
  <div class="bonus-type-container attributes">
    <label
      ><span>I.Q.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_iq"
        title="Intelligence Quotient"
      />
      <label class="abs"
        ><input type="checkbox" value="1" name="attr_iq_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_iq_bonus"
        title="+ Skills %"
      />
      <span name="attr_mod_iq_bonus" title="+ Skills %"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_perception_bonus"
        title="+ Perception (Rifter #13, p.16)"
      />
      <span
        name="attr_mod_perception_bonus"
        title="+ Perception (Rifter #13, p.16)"
      ></span>
    </label>
    <label
      ><span>M.E.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_me"
        title="Mental Endurance"
      />
      <label class="abs"
        ><input type="checkbox" value="1" name="attr_me_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_me_bonus"
        title="+ Save vs. Psionics"
      />
      <span name="attr_mod_me_bonus" title="+ Save vs. Psionics"></span>
    </label>
    <label
      ><span>M.A.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_ma"
        title="Mental Affinity"
      /><label class="abs"
        ><input type="checkbox" value="1" name="attr_ma_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_ma_bonus"
        title="% Trust/Intimidate"
      />
      <span name="attr_mod_ma_bonus" title="% Trust/Intimidate"></span>
    </label>
    <label
      ><span>P.S.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_ps"
        title="Physical Strength"
      /><label class="abs"
        ><input type="checkbox" value="1" name="attr_ps_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_ps_bonus"
        title="+ SDC Damage"
      />
      <span name="attr_mod_ps_bonus" title="+ SDC Damage"></span>
    </label>
    <label
      ><span>P.P.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_pp"
        title="Physical Prowess"
      /><label class="abs"
        ><input type="checkbox" value="1" name="attr_pp_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_pp_bonus"
        title="+ Strike/Parry/Dodge/Entangle/Disarm"
      />
      <span
        name="attr_mod_pp_bonus"
        title="+ Strike/Parry/Dodge/Entangle/Disarm"
      ></span>
    </label>
    <label
      ><span>P.E.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_pe"
        title="Physical Endurance"
      /><label class="abs"
        ><input type="checkbox" value="1" name="attr_pe_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_pe_bonus"
        title="+ Magic/Poison/Toxins"
      />
      <span name="attr_mod_pe_bonus" title="+ Magic/Poison/Toxins"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_pe_coma_bonus"
        title="+ Coma/Death %"
      />
      <span name="attr_mod_pe_coma_bonus" title="+ Coma/Death %"></span>
    </label>
    <label
      ><span>P.B.</span>
      <input
        type="number"
        value="0"
        name="attr_mod_pb"
        title="Physical Beauty"
      /><label class="abs"
        ><input type="checkbox" value="1" name="attr_pb_abs" />|x|</label
      >
      <input
        type="hidden"
        value="0"
        name="attr_mod_pb_bonus"
        title="% Charm/Impress"
      />
      <span name="attr_mod_pb_bonus" title="% Charm/Impress"></span>
    </label>
    <label
      ><span>Spd</span>
      <input type="number" value="0" name="attr_mod_spd" title="Speed" /><label
        class="abs"
        ><input type="checkbox" value="1" name="attr_spd_abs" />|x|</label
      ></label
    >
  </div>
  <hr />
  <div class="bonus-ps-container">
    <label class="select"
      ><span>PS Type</span>
      <select class="" name="attr_mod_character_ps_type" value="normal">
        <option value="1">Normal</option>
        <option value="2">Augmented</option>
        <option value="3">Robotic</option>
        <option value="3.5">Giant Robotic</option>
        <option value="4">Supernatural</option>
      </select></label
    >
    <label
      ><span>Restrained Punch</span>
      <input type="text" name="attr_mod_restrained_punch" value="0" />
      <select name="attr_mod_restrained_punch_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Punch</span>
      <input type="text" name="attr_mod_punch" value="0" />
      <select name="attr_mod_punch_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Power Punch</span>
      <input type="text" name="attr_mod_power_punch" value="0" />
      <select name="attr_mod_power_punch_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Kick</span>
      <input type="text" name="attr_mod_kick" value="0" />
      <select name="attr_mod_kick_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Leap Kick</span>
      <input type="text" name="attr_mod_leap_kick" value="0" />
      <select name="attr_mod_leap_kick_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select>
    </label>

    <label
      ><span>Lift</span>
      <input type="number" value="0" name="attr_mod_lift" value="0" />
      <span>lbs</span>
    </label>

    <label
      ><span>Carry</span>
      <input type="number" value="0" name="attr_mod_carry" value="0" />
      <span>lbs</span></label
    >

    <label
      ><span>Throw (&frac12; Carry)</span>
      <input type="number" value="0" name="attr_mod_throw_distance" value="0" />
      <span>Feet</span></label
    >

    <label
      ><span>Carry Max</span>
      <input type="number" value="0" name="attr_mod_carry_max" /><span
        >Minutes</span
      ></label
    >

    <label
      ><span>Carry (Running)</span>
      <input type="number" value="0" name="attr_mod_carry_running" /><span
        >Minutes</span
      ></label
    >

    <label
      ><span>Hold Max.</span>
      <input type="number" value="0" name="attr_mod_hold_max" /><span
        >Melees</span
      ></label
    >
  </div>
  <hr />
</details>
<div class="bonus-type-container">
  <label
    ><span title="Hit Points">H.P.</span
    ><input type="number" value="0" name="attr_hp"
  /></label>
  <label
    ><span>S.D.C.</span><input type="number" value="0" name="attr_sdc"
  /></label>
  <label
    ><span>A.R.</span><input type="number" value="0" name="attr_ar"
  /></label>
  <label
    ><span>M.D.C.</span><input type="number" value="0" name="attr_mdc"
  /></label>
  <label
    ><span>P.P.E.</span><input type="number" value="0" name="attr_ppe"
  /></label>
  <label
    ><span>I.S.P.</span><input type="number" value="0" name="attr_isp"
  /></label>
  <label
    ><span>H.F.</span><input type="number" value="0" name="attr_mod_hf" /><label
      class="abs"
      ><input type="checkbox" value="1" name="attr_hf_abs" />|x|</label
    ></label
  >
</div>
<hr />
<h3>Combat</h3>
<div class="bonus-type-container">
  <label
    ><span>Attacks</span>
    <input type="number" value="0" name="attr_attacks" />
  </label>
  <label
    ><span>Initiative</span>
    <input type="number" value="0" name="attr_initiative" />
    <button
      type="roll"
      value="Initiative: [[d20+@{initiative}]]"
      name="roll_bonus_initiative"
    />
  </label>
  <label
    ><span>Strike</span>
    <input type="number" value="0" name="attr_strike" />
    <button
      type="roll"
      value="Strike: [[d20+@{strike}]]"
      name="roll_bonus_strike"
    />
  </label>
  <label
    ><span>Parry</span>
    <input type="number" value="0" name="attr_parry" />
    <button
      type="roll"
      value="Parry: [[d20+@{parry}]]"
      name="roll_bonus_parry"
    />
  </label>
  <label
    ><span>Dodge</span>
    <input type="number" value="0" name="attr_dodge" />
    <button
      type="roll"
      value="Dodge: [[d20+@{dodge}]]"
      name="roll_bonus_dodge"
    />
  </label>
  <label
    ><span>Throw</span>
    <input type="number" value="0" name="attr_throw" />
    <button
      type="roll"
      value="Throw: [[d20+@{throw}]]"
      name="roll_bonus_throw"
    />
  </label>
  <label
    ><span>Disarm</span>
    <input type="number" value="0" name="attr_disarm" />
    <button
      type="roll"
      value="Disarm: [[d20+@{disarm}]]"
      name="roll_bonus_disarm"
    />
  </label>
  <label
    ><span>Entangle</span>
    <input type="number" value="0" name="attr_entangle" />
    <button
      type="roll"
      value="Entangle: [[d20+@{entangle}]]"
      name="roll_bonus_entangle"
    />
  </label>
  <label
    ><span>Pull Punch</span>
    <input type="number" value="0" name="attr_pull" />
    <button
      type="roll"
      value="Pull Punch: [[d20+@{pull}]]"
      name="roll_bonus_pull"
    />
  </label>
  <label
    ><span>Roll w/ Impact</span>
    <input type="number" value="0" name="attr_roll" />
    <button
      type="roll"
      value="Roll w/ Impact: [[d20+@{roll}]]"
      name="roll_bonus_roll"
    />
  </label>
  <label
    ><span>Body Flip/Throw</span>
    <input type="number" value="0" name="attr_flipthrow" />
    <button
      type="roll"
      value="Body Flip/Throw: [[d20+@{flipthrow}]]"
      name="roll_bonus_flipthrow"
    />
  </label>
  <label
    ><span>Damage</span>
    <input type="text" value="0" name="attr_damage" />
    <button
      type="roll"
      value="?{Add damage modifier?|
          None,Damage: [[@{damage}]]|
          Punch,Damage: [[@{damage}+@{punch}]]|
          P.S. Bonus,Damage: [[@{damage}+@{ps_bonus}]]
        }"
      name="roll_bonus_damage"
    />
  </label>
  <label
    ><span>Dodge: Flight</span>
    <input type="number" value="0" name="attr_dodge_flight" />
    <button
      type="roll"
      value="Dodge in Flight: [[d20+@{dodge_flight}]]"
      name="roll_bonus_dodge_flight"
    />
  </label>
  <label
    >Dodge: Auto
    <input type="number" value="0" name="attr_dodge_auto" />
    <button
      type="roll"
      value="Auto Dodge: [[d20+@{dodge_auto}]]"
      name="roll_bonus_dodge_auto"
    />
  </label>
  <label
    ><span>Dodge: Teleport</span>
    <input type="number" value="0" name="attr_dodge_teleport" />
    <button
      type="roll"
      value="Teleport Dodge: [[d20+@{dodge_teleport}]]"
      name="roll_bonus_dodge_teleport"
    />
  </label>
  <label
    ><span>Dodge: Motion</span>
    <input type="number" value="0" name="attr_dodge_motion" />
    <button
      type="roll"
      value="Dodge in Motion: [[d20+@{dodge_motion}]]"
      name="roll_bonus_dodge_motion"
    />
  </label>
  <label
    ><span>Strike: Range</span>
    <input type="number" value="0" name="attr_strike_range" />
    <button
      type="roll"
      value="Range Strike: [[d20+@{strike_range}]]"
      name="roll_bonus_strike_range"
    />
  </label>
  <label
    ><span>Range: Single</span>
    <input type="number" value="0" name="attr_strike_range_single" />
    <button
      type="roll"
      value="Range Strike: [[d20+@{strike_range_single}]]"
      name="roll_bonus_strike_range_single"
    />
  </label>
  <label
    ><span>Range: Burst</span>
    <input type="number" value="0" name="attr_strike_range_burst" />
    <button
      type="roll"
      value="Range Strike: [[d20+@{strike_range_burst}]]"
      name="roll_bonus_strike_range_burst"
    />
  </label>
  <label
    ><span>Range: Aimed</span>
    <input type="number" value="0" name="attr_strike_range_aimed" />
    <button
      type="roll"
      value="Range Aimed Strike: [[d20+@{strike_range_aimed}]]"
      name="roll_bonus_strike_range_aimed"
    />
  </label>
  <label
    ><span>Range: Aimed Single</span>
    <input type="hidden" value="0" name="attr_strike_range_aimed_single" />
    <span name="attr_strike_range_aimed_single"></span>
    <button
      type="roll"
      value="Range Aimed Single Strike: [[d20+@{strike_range_aimed_single}]]"
      name="roll_bonus_strike_range_aimed_single"
    />
  </label>
  <label
    ><span>Range: Aimed Pulse</span>
    <input type="hidden" value="0" name="attr_strike_range_aimed_pulse" />
    <span name="attr_strike_range_aimed_pulse"></span>
    <button
      type="roll"
      value="Range Aimed Pulse Strike: [[d20+@{strike_range_aimed_pulse}]]"
      name="roll_bonus_strike_range_aimed_pulse"
    />
  </label>
  <label
    ><span>Range: Called</span>
    <input type="number" value="0" name="attr_strike_range_called" />
    <button
      type="roll"
      value="Range Called Strike: [[d20+@{strike_range_called}]]"
      name="roll_bonus_strike_range_called"
    />
  </label>
  <label
    ><span>Range: Called Single</span>
    <input type="hidden" value="0" name="attr_strike_range_called_single" />
    <span name="attr_strike_range_called_single"></span>
    <button
      type="roll"
      value="Range Called Single Strike: [[d20+@{strike_range_called_single}]]"
      name="roll_bonus_strike_range_called_single"
    />
  </label>
  <label
    ><span>Range: Called Pulse</span>
    <input type="hidden" value="0" name="attr_strike_range_called_pulse" />
    <span name="attr_strike_range_called_pulse"></span>
    <button
      type="roll"
      value="Range Called Pulse Strike: [[d20+@{strike_range_called_pulse}]]"
      name="roll_bonus_strike_range_called_pulse"
    />
  </label>
  <label
    ><span>Range: Aimed Called Single</span>
    <input
      type="hidden"
      value="0"
      name="attr_strike_range_aimed_called_single"
    />
    <span name="attr_strike_range_aimed_called_single"></span>
    <button
      type="roll"
      value="Range Aimed Called Single Strike: [[d20+@{strike_range_aimed_called_single}]]"
      name="roll_bonus_strike_range_aimed_called_single"
    />
  </label>
  <label
    ><span>Range: Aimed Called Pulse</span>
    <input
      type="hidden"
      value="0"
      name="attr_strike_range_aimed_called_pulse"
    />
    <span name="attr_strike_range_aimed_called_pulse"></span>
    <button
      type="roll"
      value="Range Aimed Called Pulse Strike: [[d20+@{strike_range_aimed_called_pulse}]]"
      name="roll_bonus_strike_range_aimed_called_pulse"
    />
  </label>
  <label
    ><span>Disarm: Range</span>
    <input type="number" value="0" name="attr_disarm_range" />
    <button
      type="roll"
      value="Range Disarm: [[d20+@{disarm_range}]]"
      name="roll_bonus_disarm_range"
    />
  </label>
  <label
    ><span>Damage: Range</span>
    <input type="text" value="0" name="attr_damage_range" />
    <button
      type="roll"
      value="Range Damage: [[@{damage_range}]]"
      name="roll_bonus_damage_range"
    />
  </label>
  <label
    ><span>Critical</span> <input type="number" value="" name="attr_critical"
  /></label>
  <label
    ><span>Knockout</span> <input type="number" value="" name="attr_knockout"
  /></label>
  <label
    ><span>Death Blow</span>
    <input type="number" value="0" name="attr_deathblow"
  /></label>
</div>
<hr />
<h3>Saving Throws</h3>
<div class="bonus-type-container">
  <label
    ><span>Perception</span>
    <input type="number" value="0" name="attr_perceptioncheck" />
    <button
      type="roll"
      value="Perception Check: [[d20+@{perceptioncheck}]]"
      name="roll_bonus_perceptioncheck"
    />
  </label>
  <label
    ><span>Psionics</span>
    <input type="number" value="0" name="attr_psionics" />
    <button
      type="roll"
      value="Save vs. Psionics: [[d20+@{psionics}]]"
      name="roll_bonus_psionics"
    />
  </label>
  <label
    ><span>Magic</span>
    <input type="number" value="0" name="attr_magic" />
    <button
      type="roll"
      value="Save vs. Magic: [[d20+@{magic}]]"
      name="roll_bonus_magic"
    />
  </label>
  <label
    ><span>Horror Factor</span>
    <input type="number" value="0" name="attr_horrorfactor" />
    <button
      type="roll"
      value="Save vs. Horror Factor: [[d20+@{horrorfactor}]]"
      name="roll_bonus_horrorfactor"
    />
  </label>
  <label
    ><span>Mind Control</span>
    <input type="number" value="0" name="attr_mindcontrol" />
    <button
      type="roll"
      value="Save vs. Mind Control: [[d20+@{mindcontrol}]]"
      name="roll_bonus_mindcontrol"
    />
  </label>
  <label
    ><span>Disease</span>
    <input type="number" value="0" name="attr_disease" />
    <button
      type="roll"
      value="Save vs. Disease: [[d20+@{disease}]]"
      name="roll_bonus_disease"
    />
  </label>
  <label
    ><span>Illusions</span>
    <input type="number" value="0" name="attr_illusions" />
    <button
      type="roll"
      value="Save vs. Illusions: [[d20+@{illusions}]]"
      name="roll_bonus_illusions"
    />
  </label>
  <label
    ><span>Possession</span>
    <input type="number" value="0" name="attr_possession" />
    <button
      type="roll"
      value="Save vs. Possession: [[d20+@{possession}]]"
      name="roll_bonus_possession"
    />
  </label>
  <label
    ><span>Insanity</span>
    <input type="number" value="0" name="attr_insanity" />
    <button
      type="roll"
      value="Save vs. Insanity: [[d20+@{insanity}]]"
      name="roll_bonus_insanity"
    />
  </label>
  <label
    ><span>Pain</span>
    <input type="number" value="0" name="attr_pain" />
    <button
      type="roll"
      value="Save vs. Pain: [[d20+@{pain}]]"
      name="roll_bonus_pain"
    />
  </label>
  <label
    ><span>Lethal Poison</span>
    <input type="number" value="0" name="attr_lethalpoison" />
    <button
      type="roll"
      value="Save vs. Lethal Poison: [[d20+@{lethalpoison}]]"
      name="roll_bonus_lethalpoison"
    />
  </label>
  <label
    ><span>Non-Lethal Poison</span>
    <input type="number" value="0" name="attr_nonlethalpoison" />
    <button
      type="roll"
      value="Save vs. Non-Lethal Poison: [[d20+@{nonlethalpoison}]]"
      name="roll_bonus_nonlethalpoison"
    />
  </label>
  <label
    ><span>Drugs</span>
    <input type="number" value="0" name="attr_drugs" />
    <button
      type="roll"
      value="Save vs. Drugs: [[d20+@{drugs}]]"
      name="roll_bonus_drugs"
    />
  </label>
  <label
    ><span>Curses</span>
    <input type="number" value="0" name="attr_curses" />
    <button
      type="roll"
      value="Save vs. Curses: [[d20+@{curses}]]"
      name="roll_bonus_curses"
    />
  </label>
  <label
    ><span>Coma/Death</span>
    <input type="number" value="0" name="attr_comadeath" />
    <button
      type="roll"
      value="Save vs. Coma/Death: [[d100-@{comadeath}]]"
      name="roll_bonus_comadeath"
    />
  </label>
</div>
<label class="description"
  ><b>Description</b>
  <textarea class="full" name="attr_description" value=""></textarea>
</label>
<div class="macro-help">
  <label
    ><span><b>Row ID:</b></span>
    <input type="text" readonly name="attr_rowid" value=""
  /></label>
</div>

            <!-- endinject -->
          </details>
        </fieldset>
      </div>
    </div>
  </div>

  <div class="equipment">
    <h3>Equipment</h3>
    <p>
      Free form equipment list for now. Weapons and armor should go in the
      Modifiers tab.
    </p>
    <textarea class="full tall" name="attr_equipment"></textarea>
  </div>

  <div class="importexport">
    <h3>Import/Export</h3>
    <details>
      <summary><b>Instructions</b></summary>
      <p>
        Click the <b>Export</b> button to get a JSON object representing your
        character. Paste a valid JSON object and click <b>Import</b> to import a
        character.
      </p>
      <p>
        In order to know what the valid fields are, complete all the fields with
        at least one of each repeating section and do an Export.
      </p>
    </details>
    <p>Click <b>Instructions</b> for detailed instructions.</p>
    <button type="action" name="act_import">Import</button>
    <button type="action" name="act_export">Export</button>
    <label>Status: <span name="attr_importexportstatus"></span></label>
    <input type="hidden" name="attr_importexportstatus" />
    <textarea class="full tall" name="attr_importexport"></textarea>
  </div>
</main>
<script type="text/worker">
  // Change from javascript to worker before upload

  /* inject:js/async.js */
  function setActiveCharacterId(charId) {
  var oldAcid = getActiveCharacterId();
  var ev = new CustomEvent("message");
  ev.data = { id: "0", type: "setActiveCharacter", data: charId };
  self.dispatchEvent(ev);
  return oldAcid;
}
var _sIn = setInterval;
setInterval = function (callback, timeout) {
  var acid = getActiveCharacterId();
  _sIn(function () {
    var prevAcid = setActiveCharacterId(acid);
    callback();
    setActiveCharacterId(prevAcid);
  }, timeout);
};
var _sto = setTimeout;
setTimeout = function (callback, timeout) {
  var acid = getActiveCharacterId();
  _sto(function () {
    var prevAcid = setActiveCharacterId(acid);
    callback();
    setActiveCharacterId(prevAcid);
  }, timeout);
};
function getAttrsAsync(props) {
  var acid = getActiveCharacterId(); //save the current activeCharacterID in case it has changed when the promise runs
  var prevAcid = null; //local variable defined here, because it needs to be shared across the promise callbacks defined below
  return new Promise((resolve, reject) => {
    prevAcid = setActiveCharacterId(acid); //in case the activeCharacterId has changed, restore it to what we were expecting and save the current value to restore later
    try {
      getAttrs(props, (values) => {
        resolve(values);
      });
    } catch {
      reject();
    }
  }).finally(() => {
    setActiveCharacterId(prevAcid); //restore activeCharcterId to what it was when the promise first ran
  });
}
//use the same pattern for each of the following...
function setAttrsAsync(propObj, options) {
  var acid = getActiveCharacterId();
  var prevAcid = null;
  return new Promise((resolve, reject) => {
    prevAcid = setActiveCharacterId(acid);
    try {
      setAttrs(propObj, options, (values) => {
        resolve(values);
      });
    } catch {
      reject();
    }
  }).finally(() => {
    setActiveCharacterId(prevAcid);
  });
}

function getSectionIDsAsync(sectionName) {
  var acid = getActiveCharacterId();
  var prevAcid = null;
  return new Promise((resolve, reject) => {
    prevAcid = setActiveCharacterId(acid);
    try {
      getSectionIDs(sectionName, (values) => {
        resolve(values);
      });
    } catch {
      reject();
    }
  }).finally(() => {
    setActiveCharacterId(prevAcid);
  });
}
function getSingleAttrAsync(prop) {
  var acid = getActiveCharacterId();
  var prevAcid = null;
  return new Promise((resolve, reject) => {
    prevAcid = setActiveCharacterId(acid);
    try {
      getAttrs([prop], (values) => {
        resolve(values[prop]);
      });
    } catch {
      reject();
    }
  }).finally(() => {
    setActiveCharacterId(prevAcid);
  });
}

  /* endinject */

  /* inject:js/definitions.js */
  const WP = {
  "w.p. archery": [
    { strike: 1, parry: 1, rof: 2 },
    { strike: 1, disarm: 1, rof: 1 },
    {},
    { strike: 1, rof: 1 },
    { disarm: 1, rof: 1 },
    { strike: 1 },
    {},
    { strike: 1, rof: 1 },
    {},
    { strike: 1, disarm: 1, rof: 1 },
    {},
    { strike: 1, rof: 1 },
    {},
    { strike: 1, rof: 1 },
    { disarm: 1 },
  ],
  "w.p. axe": [
    {},
    { strike: 1, parry: 1 },
    {},
    {},
    { strike: 1, parry: 1, throw: 1 },
    {},
    {},
    { strike: 1, parry: 1, throw: 1 },
    {},
    {},
    {},
    { strike: 1, parry: 1, throw: 1 },
    {},
    {},
    { strike: 1, parry: 1 },
  ],
  "w.p. blunt": [
    { strike: 1, parry: 1 },
    {},
    { strike: 1, parry: 1 },
    {},
    { throw: 1 },
    { strike: 1, parry: 1 },
    {},
    {},
    { strike: 1, parry: 1 },
    { throw: 1 },
    {},
    { strike: 1, parry: 1 },
    {},
    {},
    { throw: 1 },
  ],
  "w.p. chain": [
    { strike: 1 },
    {},
    { strike: 1 },
    { parry: 1 },
    {},
    {},
    { strike: 1 },
    { parry: 1 },
    {},
    { strike: 1 },
    {},
    { parry: 1 },
    { strike: 1 },
    {},
    {},
  ],
  "w.p. forked": [
    { strike: 1, parry: 1, entangle: 1 },
    {},
    { strike: 1, parry: 1, entangle: 1 },
    { throw: 1 },
    { strike: 1, entangle: 1 },
    { parry: 1 },
    {},
    { strike: 1, entangle: 1 },
    {},
    { parry: 1, throw: 1 },
    { strike: 1, entangle: 1 },
    {},
    { strike: 1, parry: 1, entangle: 1 },
    {},
    { throw: 1 },
  ],
  "w.p. knife": [
    { parry: 1, throw: 1 },
    { strike: 1 },
    { parry: 1, throw: 1 },
    { strike: 1 },
    {},
    { parry: 1, throw: 1 },
    { strike: 1 },
    { throw: 1 },
    { parry: 1 },
    { strike: 1, throw: 1 },
    {},
    { parry: 1 },
    { strike: 1, throw: 1 },
    {},
    {},
  ],
  "w.p. grappling hook": [
    {},
    {},
    { strike: 1, entangle: 1 },
    {},
    {},
    { strike: 1, entangle: 1 },
    {},
    {},
    { strike: 1, entangle: 1 },
    {},
    {},
    { strike: 1, entangle: 1 },
    {},
    {},
    {},
  ],
  "w.p. pole arm": [
    { strike: 1, parry: 1 },
    {},
    { strike: 1, parry: 1, throw: 1 },
    {},
    {},
    { strike: 1, parry: 1 },
    {},
    { throw: 1 },
    { strike: 1, parry: 1 },
    {},
    {},
    { strike: 1, parry: 1, throw: 1 },
    {},
    {},
    {},
  ],
  "w.p. rope": [
    { strike: 1, entangle: 1, disarm: 1 },
    {},
    {},
    { strike: 1 },
    {},
    {},
    {},
    { strike: 1 },
    {},
    {},
    {},
    { strike: 1 },
    {},
    {},
    { strike: 1 },
  ],
  "w.p. shield": [
    { parry: 1 },
    {},
    { parry: 1 },
    { strike: 1 },
    {},
    {},
    { parry: 1 },
    { strike: 1 },
    {},
    { parry: 1 },
    {},
    { strike: 1 },
    { parry: 1 },
    {},
    {},
  ],
  "w.p. spear": [
    { strike: 1, parry: 1 },
    {},
    { strike: 1, parry: 1, throw: 1 },
    {},
    {},
    { strike: 1, parry: 1, throw: 1 },
    {},
    {},
    { strike: 1, parry: 1 },
    { throw: 1 },
    {},
    { strike: 1, parry: 1 },
    {},
    { throw: 1 },
    {},
  ],
  "w.p. staff": [
    { strike: 1 },
    { parry: 1 },
    { strike: 1 },
    {},
    { parry: 1, throw: 1 },
    {},
    { strike: 1 },
    { parry: 1 },
    {},
    { strike: 1, throw: 1 },
    { parry: 1 },
    {},
    { strike: 1 },
    { parry: 1 },
    { throw: 1 },
  ],
  "w.p. sword": [
    { strike: 1 },
    { parry: 1 },
    { strike: 1 },
    { parry: 1, throw: 1 },
    {},
    { strike: 1 },
    { parry: 1 },
    { throw: 1 },
    { strike: 1 },
    { parry: 1 },
    {},
    { strike: 1, throw: 1 },
    { parry: 1 },
    {},
    { strike: 1 },
  ],
  "w.p. targeting": [
    { strike: 1 },
    { damage: 1 },
    { strike: 1 },
    {},
    {},
    {},
    { strike: 1 },
    { damage: 1 },
    {},
    { strike: 1 },
    {},
    {},
    {},
    {},
    {},
  ],
  "w.p. whip": [
    {},
    { strike: 1, entangle: 1, disarm: 1, damage: 1 },
    {},
    { strike: 1, entangle: 1, disarm: 1, damage: 1 },
    {},
    {},
    { strike: 1, entangle: 1, disarm: 1 },
    { damage: 1 },
    {},
    { strike: 1, entangle: 1, disarm: 1 },
    {},
    { damage: 1 },
    { strike: 1, entangle: 1, disarm: 1 },
    {},
    {},
  ],
  "w.p. handguns": [
    {},
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    { strike_range_single: 1 },
    {},
  ],
  "w.p. rifles": [
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    { strike_range_single: 1 },
    {},
    {},
  ],
  "w.p. energy heavy": [
    {},
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    {},
    { strike_range_single: 1 },
    {},
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    {},
    { strike_range_single: 1 },
    {},
    {},
  ],
  "w.p. energy pistol": [
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
  ],
  "w.p. energy rifle": [
    {},
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    { strike_range_single: 1 },
    {},
  ],
  "w.p. heavy": [
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    {},
    { strike_range_single: 1 },
    {},
    {},
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    {},
    {},
    { strike_range_single: 1 },
    {},
  ],
  "w.p. speargun": [
    {},
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    {},
    { strike_range_single: 1 },
    {},
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    {},
    {},
    {},
    { strike_range_single: 1 },
  ],
  "w.p. shotgun": [
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    {},
    { strike_range_single: 1 },
    {},
    {},
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    {},
    {},
    { strike_range_single: 1 },
    {},
  ],
  "w.p. submachinegun": [
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    {},
    { strike_range_single: 1 },
    {},
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    {},
    { strike_range_single: 1 },
    {},
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
  ],
  "w.p. flamethrower": [
    {},
    { strike_range_single: 1 },
    {},
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    {},
    {},
    {},
    { strike_range_single: 1 },
    {},
    {},
    {},
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
  ],
};

const WP_KEYS = {
  wp: [
    "name",
    "level",
    "strike",
    "parry",
    "disarm",
    "rof",
    "throw",
    "entangle",
  ],
  wpmodern: [
    "name",
    "level",
    "strike_range_single",
    "disarm",
    "strike_range_burst",
  ],
};

const ATTRIBUTE_KEYS = [
  "mod_iq",
  "iq_abs",
  "mod_iq_bonus",
  "mod_perception_bonus",
  "mod_me",
  "mod_me_bonus",
  "me_abs",
  "mod_ma",
  "mod_ma_bonus",
  "ma_abs",
  "mod_ps",
  "mod_ps_bonus",
  "ps_abs",
  "mod_pp",
  "mod_pp_bonus",
  "pp_abs",
  "mod_pe",
  "mod_pe_bonus",
  "mod_pe_coma_bonus",
  "pe_abs",
  "mod_pb",
  "mod_pb_bonus",
  "pb_abs",
  "mod_spd",
  "spd_abs",
  "mod_character_ps_type",
  "mod_restrained_punch",
  "mod_restrained_punch_unit",
  "mod_punch",
  "mod_punch_unit",
  "mod_power_punch",
  "mod_power_punch_unit",
  "mod_kick",
  "mod_kick_unit",
  "mod_leap_kick",
  "mod_leap_kick_unit",
  "mod_lift",
  "mod_carry",
  "mod_throw_distance",
  "mod_carry_max",
  "mod_carry_running",
  "mod_hold_max",
  "hp",
  "sdc",
  "ar",
  "mdc",
  "ps_type",
  "ppe",
  "isp",
  "mod_hf",
  "hf_abs",
];

const COMBAT_KEYS = [
  // "selection_id",
  "name",
  "level",
  "attacks",
  "sdc",
  "mdc",
  "initiative",
  "strike",
  "parry",
  "dodge",
  "throw",
  "disarm",
  "entangle",
  "pull",
  "roll",
  "damage",
  "dodge_flight",
  "dodge_auto",
  "dodge_teleport",
  "dodge_motion",
  "strike_range",
  "strike_range_single",
  "strike_range_burst",
  "strike_range_aimed",
  "strike_range_aimed_single",
  "strike_range_aimed_pulse",
  "strike_range_called",
  "strike_range_called_single",
  "strike_range_called_pulse",
  "strike_range_aimed_called_single",
  "strike_range_aimed_called_pulse",
  "disarm_range",
  "damage_range",
  "critical",
  "knockout",
  "deathblow",
  "flipthrow",
  "description",
];
const SAVE_KEYS_ATTRIBUTE_BONUSES = {
  me_bonus: ["psionics", "insanity"],
  pe_bonus: [
    "magic",
    "lethalpoison",
    "nonlethalpoison",
    "disease",
    "pain",
    "drugs",
  ],
  pe_coma_bonus: ["comadeath"],
  perception: ["perceptioncheck"],
  none: ["horrorfactor", "mindcontrol", "illusions", "possession", "curses"],
};
const SAVE_KEYS = Object.values(SAVE_KEYS_ATTRIBUTE_BONUSES).reduce(
  (acc, cur) => acc.concat(cur),
  []
);
const REPEATING_BONUS_KEYS = COMBAT_KEYS.concat(SAVE_KEYS, ATTRIBUTE_KEYS);
const SKILL_KEYS = ["name", "base", "bonus", "perlevel", "level", "total"];

const ABILITIES_REPEATERS = ["magic", "psionics", "powersabilities"];

const MAGIC_KEYS = REPEATING_BONUS_KEYS.concat([
  "name",
  "school",
  "spell_level",
  "range",
  "damage",
  "duration",
  "percentage",
  "ppecost",
  "range_starting",
  "range_per_level",
  "range_units",
  "damage_starting",
  "damage_per_level",
  "damage_units",
  "dc_starting",
  "dc_per_level",
  "dc_units",
  "duration_starting",
  "duration_per_level",
  "duration_units",
  "percentage_starting",
  "percentage_per_level",
]);

const PSIONICS_KEYS = REPEATING_BONUS_KEYS.concat([
  "name",
  "range",
  "damage",
  "duration",
  "percentage",
  "ispcost",
  "range_starting",
  "range_per_level",
  "range_units",
  "damage_starting",
  "damage_per_level",
  "damage_units",
  "dc_starting",
  "dc_per_level",
  "dc_units",
  "duration_starting",
  "duration_per_level",
  "duration_units",
  "percentage_starting",
  "percentage_per_level",
]);

const ABILITIES_KEYS = REPEATING_BONUS_KEYS.concat([
  "name",
  "range",
  "damage",
  "duration",
  "percentage",
  "range_starting",
  "range_per_level",
  "range_units",
  "damage_starting",
  "damage_per_level",
  "damage_units",
  "dc_starting",
  "dc_per_level",
  "dc_units",
  "duration_starting",
  "duration_per_level",
  "duration_units",
  "frequency_starting",
  "frequency_per_level",
  "frequency_units",
  "percentage_starting",
  "percentage_per_level",
]);

const PROFILES_KEYS = REPEATING_BONUS_KEYS.concat(["bonus_ids", "bonus_names"]);

const CORE_KEYS = [
  "character_name",
  "truename_name",
  "character_race",
  "occ",
  "character_ps_type",
  "character_level",
  "experience",
  "alignment",
  "character_age",
  "character_gender",
  "character_height",
  "character_weight",
  "character_familyorigin",
  "character_environment",
  "character_languages",
  "character_insanity",
  "character_disposition",
  "iq",
  "iq_bonus",
  "perception_bonus",
  "me",
  "me_bonus",
  "ma",
  "ma_bonus",
  "ps",
  "ps_bonus",
  "pp",
  "pp_bonus",
  "pe",
  "pe_bonus",
  "pe_coma_bonus",
  "pb",
  "pb_bonus",
  "spd",
  "trust_intimidate",
  "charm_impress",
  "restrained_punch",
  "restrained_punch_unit",
  "punch",
  "punch_unit",
  "power_punch",
  "power_punch_unit",
  "kick",
  "kick_unit",
  "leap_kick",
  "leap_kick_unit",
  "lift",
  "carry",
  "throw_distance",
  "carry_max",
  "carry_running",
  "hold_max",
  "character_hp",
  "character_sdc",
  "character_ar",
  "character_mdc",
  "character_ppe",
  "character_isp",
  "hf",
  "perception",
  "run_mph",
  "run_ft_melee",
  "run_ft_attack",
  "run_cruising",
  "run_at_max",
  "leapup",
  "leapout",
  "equipment",
];

const MOVEMENT_KEYS = ["name", "mph", "ft_melee", "cruising", "dur_at_max"];

const EQUIPMENT_KEYS = ["equipment"];

const SECTIONS = {
  wp: WP_KEYS.wp,
  wpmodern: WP_KEYS.wpmodern,
  skills: SKILL_KEYS,
  combat: REPEATING_BONUS_KEYS, // deprecated
  modifiers: REPEATING_BONUS_KEYS,
  magic: MAGIC_KEYS,
  psionics: PSIONICS_KEYS,
  movement: MOVEMENT_KEYS,
  powersabilities: ABILITIES_KEYS,
  // profiles: PROFILES_KEYS, // Tricky to export because IDs that they refer to won't line up
  // equipment: EQUIPMENT_KEYS,
};

  /* endinject */

  /* inject:js/utils.js */
  /**
 * Aggregates repeating values
 * @param {string[]} destinations An array of field names to output to
 * @param {string} section A repeating section name
 * @param {string[]} fields An array of fields to aggregate into the associated destination
 * @param  {...any} extras Some extra stuff
 * If an extra is an object, it will be used for extendedProps.
 */
async function repeatingSumAsync(destinations, section, fields, ...extras) {
  const isNumber = (value) => parseFloat(value).toString() === value.toString();
  const isOption = (value) =>
    [...checks.valid, ...checks.roundtypes].includes(value);
  const isRounding = (value) => checks.roundtypes.includes(value);
  const isFraction = (value) =>
    value.includes("/") && !(value.includes(",") || value.includes("|"));
  const getTrimmed = (value) => value.toLowerCase().replace(/\s/g, "");
  const getRounded = (type, value, pow) =>
    (Math[type](value * Math.pow(10, pow)) / Math.pow(10, pow)).toFixed(
      Math.max(0, pow)
    );
  const getFraction = (value /*{ console.log(`value: ${value}`); */) =>
    parseInt(value.split("/")[0]) / parseInt(value.split("/")[1]);
  const getMultiplier = (value, rounding = 1) =>
    "undefined" === typeof value
      ? rounding
        ? 0
        : 1
      : isNumber(value)
      ? parseFloat(value)
      : isFraction(value)
      ? getFraction(value)
      : value;
  if (!Array.isArray(destinations)) destinations = [getTrimmed(destinations)];
  if (!Array.isArray(fields)) fields = [getTrimmed(fields)];
  const fields_trimmed = fields.map((field) => getTrimmed(field).split(":")[0]);
  const subfields = fields_trimmed.slice(0, destinations.length);
  const checks = {
    valid: ["multiplier"],
    roundtypes: ["ceil", "round", "floor"],
  };
  let properties = { attributes: {}, options: {} };
  let extendedProps = {};
  extras.forEach((extra) => {
    if (extra.constructor.name === "Object") {
      extendedProps = extra;
      return;
    }
    const [prop, v] = getTrimmed(extra).split(":");
    const multiplier_maybe = getMultiplier(v, isRounding(prop));
    const obj = isNumber(multiplier_maybe)
      ? subfields.reduce((obj, field) => {
          obj[field] = multiplier_maybe;
          return obj;
        }, {})
      : multiplier_maybe.split(",").reduce((obj, item) => {
          const [stat, value] = item.split("|");
          const multiplier = getMultiplier(value, isRounding(prop));
          obj[stat] = multiplier;
          return obj;
        }, {});
    properties[isOption(prop) ? "options" : "attributes"][prop] = obj;
  });
  const idArray = await getSectionIDsAsync(`repeating_${section}`);
  const attrArray = idArray.reduce(
    (m, id) => [
      ...m,
      ...fields_trimmed.map((field) => `repeating_${section}_${id}_${field}`),
    ],
    []
  );
  let filteredAttrArray = attrArray;
  if (properties.attributes.filter) {
    filteredAttrArray = attrArray.filter((attr) =>
      Object.keys(properties.attributes.filter).some(
        (sectionId) => sectionId && attr.includes(sectionId)
      )
    );
  }
  const v = await getAttrsAsync([
    ...filteredAttrArray,
    ...Object.keys(properties.attributes),
  ]);
  const getValue = (section, id, field) =>
    v[`repeating_${section}_${id}_${field}`] === "on"
      ? 1
      : parseFloat(v[`repeating_${section}_${id}_${field}`]) || 0;
  const commonMultipliers =
    fields.length <= destinations.length
      ? []
      : fields.splice(destinations.length, fields.length - destinations.length);
  const output = destinations.reduce((obj, destination, index) => {
    let sumTotal = idArray.reduce(
      (total, id) =>
        total +
        getValue(section, id, fields_trimmed[index]) *
          commonMultipliers.reduce(
            (subtotal, mult) =>
              subtotal *
              (!mult.includes(":") ||
              mult.split(":")[1].split(",").includes(fields_trimmed[index])
                ? getValue(section, id, mult.split(":")[0])
                : 1),
            1
          ),
      0
    );
    sumTotal *=
      properties.options.hasOwnProperty("multiplier") &&
      Object.keys(properties.options.multiplier).includes(fields_trimmed[index])
        ? parseFloat(properties.options.multiplier[fields_trimmed[index]]) || 0
        : 1;
    sumTotal += Object.entries(properties.attributes).reduce(
      (total, [key, value]) =>
        (total += value.hasOwnProperty(fields_trimmed[index])
          ? parseFloat(v[key] || 0) *
            (parseFloat(value[fields_trimmed[index]]) || 1)
          : 0),
      0
    );
    checks.roundtypes.forEach((type) => {
      if (properties.options.hasOwnProperty(type)) {
        if (
          Object.keys(properties.options[type]).includes(fields_trimmed[index])
        ) {
          sumTotal = getRounded(
            type,
            sumTotal,
            +properties.options[type][fields_trimmed[index]] || 0
          );
        } else if (
          properties.options[type] == "0" ||
          !isNaN(+properties.options[type] || "x")
        ) {
          sumTotal = getRounded(type, sumTotal, +properties.options[type]);
        }
      }
    });
    obj[destination] = sumTotal;
    return obj;
  }, {});
  await setAttrsAsync(output);
}

async function repeatingPickBestAsync({
  destinations,
  section,
  fields,
  defaultValues,
  ranks,
  filter,
}) {
  console.log("repeatingPickBestAsync", {
    destinations,
    section,
    fields,
    defaultValues,
    ranks,
    filter,
  });
  const sectionIds = await getSectionIDsAsync(`repeating_${section}`);
  const attrArray = sectionIds.reduce(
    (m, id) => [
      ...m,
      ...fields.map((field) => `repeating_${section}_${id}_${field}`),
    ],
    []
  );
  let filteredAttrArray = attrArray;
  if (filter) {
    filteredAttrArray = attrArray.filter((attr) =>
      filter.some((sectionId) => sectionId && attr.includes(sectionId))
    );
  }
  const a = await getAttrsAsync(filteredAttrArray);
  const output = destinations.reduce((acc, cur, i) => {
    acc[cur] = Object.keys(a)
      .filter((val) => {
        // the 4th part of `val` needs to match fields[i]
        const [, , , ...attrParts] = val.split("_");
        const attr = attrParts.join("_");
        return attr == fields[i];
      })
      .reduce((accVal, attrCur) => {
        if (+a[attrCur] == 0) {
          return accVal;
        }

        if (+accVal != 0) {
          if (ranks[i] === "high") {
            return +a[attrCur] > +accVal ? a[attrCur] : accVal;
          } else {
            return +a[attrCur] < +accVal ? a[attrCur] : accVal;
          }
        } else {
          return a[attrCur];
        }
      }, defaultValues[i]);
    return acc;
  }, {});
  console.log(output);
  await setAttrsAsync(output);
}

async function repeatingStringConcatAsync({
  destinations,
  section,
  fields,
  filter,
}) {
  console.log({
    destinations,
    section,
    fields,
    filter,
  });
  const sectionIds = await getSectionIDsAsync(`repeating_${section}`);
  const attrArray = sectionIds.reduce(
    (m, id) => [
      ...m,
      ...fields.map((field) => `repeating_${section}_${id}_${field}`),
    ],
    []
  );
  let filteredAttrArray = attrArray;
  if (filter) {
    filteredAttrArray = attrArray.filter((attr) =>
      filter.some((sectionId) => sectionId && attr.includes(sectionId))
    );
  }
  const a = await getAttrsAsync(filteredAttrArray);
  const output = destinations.reduce((acc, cur, i) => {
    acc[cur] = Object.keys(a)
      .filter((val) => {
        // the 4th part of `val` needs to match fields[i]
        const [, , , ...attrParts] = val.split("_");
        const attr = attrParts.join("_");
        return attr == fields[i];
      })
      .reduce((attrAcc, attrCur) => {
        return a[attrCur] == "" || a[attrCur] == "0"
          ? attrAcc
          : `${a[attrCur]}+${attrAcc}`.replace(/\+$/, "");
      }, "");
    return acc;
  }, {});
  await setAttrsAsync(output);
}

function getBiAttributeBonus(attr) {
  const bonus = attr > 15 ? Math.ceil((Math.min(attr, 30) - 15) / 2) : 0;
  return bonus;
}

function mergeAndAddObjects(data) {
  const result = {};
  data.forEach((obj) => {
    for (let [key, value] of Object.entries(obj)) {
      if (result[key]) {
        result[key] += value;
      } else {
        result[key] = value;
      }
    }
  });
  return result;
}

async function getSectionIDsOrderedAsync(sectionName) {
  const v = await getAttrsAsync([`_reporder_repeating_${sectionName}`]);
  const idArray = await getSectionIDsAsync(sectionName);
  const reporderArray = v[`_reporder_repeating_${sectionName}`]
    ? v[`_reporder_repeating_${sectionName}`].toLowerCase().split(",")
    : [];
  const ids = [
    ...new Set(
      reporderArray.filter((x) => idArray.includes(x)).concat(idArray)
    ),
  ];
  return ids;
}

  /* endinject */

  /* inject:js/bonuses.js */
  /**
 * @todo same issue as in movement.js - which profile takes precedence?
 */
on("change:repeating_profiles:attacks", async (e) => {
  console.log("change:repeating_profiles:attacks", e);
  const movementIds = await getSectionIDsAsync("movement");
  const attrNames = movementIds.map(
    (id) => `repeating_movement_${id}_ft_melee`
  );
  const attrs = {};
  const a = await getAttrsAsync(attrNames.concat(["run_ft_melee"]));
  attrs.run_ft_attack = Math.round(a.run_ft_melee / e.newValue);
  movementIds.forEach((id) => {
    const row = `repeating_movement_${id}`;
    const feetPerMelee = a[`${row}_ft_melee`] || 0;
    if (feetPerMelee) {
      attrs[`${row}_ft_attack`] = Math.round(feetPerMelee / e.newValue);
    }
  });
  await setAttrsAsync(attrs);
});

async function addStrikeRangeToCombinedAsync(rowPrefix) {
  console.log("addStrikeRangeToCombinedAsync", rowPrefix);
  const a = await getAttrsAsync([
    `${rowPrefix}_strike_range`,
    `${rowPrefix}_strike_range_single`,
    `${rowPrefix}_strike_range_burst`,
    `${rowPrefix}_strike_range_aimed`,
    `${rowPrefix}_strike_range_called`,
  ]);
  const strikeRangeSingle =
    +a[`${rowPrefix}_strike_range`] + +a[`${rowPrefix}_strike_range_single`];
  const strikeRangeBurst =
    +a[`${rowPrefix}_strike_range`] + +a[`${rowPrefix}_strike_range_burst`];
  const strikeRangeAimedSingle =
    strikeRangeSingle + +a[`${rowPrefix}_strike_range_aimed`] + 2;
  const strikeRangeAimedPulse = Math.floor(strikeRangeAimedSingle / 2);
  const strikeRangeCalledSingle =
    strikeRangeSingle + a[`${rowPrefix}_strike_range_called`];
  const strikeRangeCalledPulse = Math.floor(strikeRangeCalledSingle / 2);
  const strikeRangeAimedCalledSingle =
    strikeRangeAimedSingle + +a[`${rowPrefix}_strike_range_called`];
  const strikeRangeAimedCalledPulse = Math.floor(
    strikeRangeAimedCalledSingle / 2
  );
  const attrs = {
    [`${rowPrefix}_strike_range_single`]: strikeRangeSingle,
    [`${rowPrefix}_strike_range_burst`]: strikeRangeBurst,
    [`${rowPrefix}_strike_range_aimed_single`]: strikeRangeAimedSingle,
    [`${rowPrefix}_strike_range_aimed_pulse`]: strikeRangeAimedPulse,
    [`${rowPrefix}_strike_range_called_single`]: strikeRangeCalledSingle,
    [`${rowPrefix}_strike_range_called_pulse`]: strikeRangeCalledPulse,
    [`${rowPrefix}_strike_range_aimed_called_single`]:
      strikeRangeAimedCalledSingle,
    [`${rowPrefix}_strike_range_aimed_called_pulse`]:
      strikeRangeAimedCalledPulse,
  };
  console.log(attrs);
  await setAttrsAsync(attrs);
}

async function repeatingAbsoluteAttributes(rowIds, destinationPrefix) {
  console.log("repeatingAbsoluteAttributes", rowIds, destinationPrefix);
  const fields = ["iq", "me", "ma", "ps", "pp", "pe", "pb", "spd", "hf"];
  const fieldNames = rowIds.reduce((acc, rowId) => {
    const absFieldNames = fields.map(
      (f) => `repeating_bonuses_${rowId}_${f}_abs`
    );
    const attFieldNames = fields.map(
      (f) => `repeating_bonuses_${rowId}_mod_${f}`
    );
    return acc.concat(absFieldNames, attFieldNames);
  }, []);
  const a = await getAttrsAsync(fieldNames);

  fields.forEach(async (field) => {
    let fieldAbsValue = null;
    rowIds.forEach((rowId) => {
      const rowFieldAbs = a[`repeating_bonuses_${rowId}_${field}_abs`];
      if (Boolean(Number(rowFieldAbs)) == true) {
        rowFieldValue = a[`repeating_bonuses_${rowId}_mod_${field}`];
        fieldAbsValue =
          fieldAbsValue > rowFieldValue ? fieldAbsValue : rowFieldValue;
      }
    });
    if (fieldAbsValue) {
      // compare the modified absolute value against the original attribute
      const coreValue = (await getAttrsAsync([field]))[field];
      const newValue = coreValue > fieldAbsValue ? coreValue : fieldAbsValue;
      const attr = {
        [`${destinationPrefix}_mod_${field}`]: newValue,
      };
      await setAttrsAsync(attr);
    } else {
      // repeatingSum
      const rsaDestinations = [`${destinationPrefix}_mod_${field}`];
      const rsaFields = [`mod_${field}`];
      await repeatingSumAsync(
        rsaDestinations,
        "bonuses",
        rsaFields,
        `filter:${rowIds.toString()}`,
        field
      );
    }
  });
}

async function combineBonuses(rowIds, destinationPrefix) {
  // we need to combine the values of each repeated attribute within
  // each of the sectionIds and aggregate them in the combined combat section
  // +PP +PS, and add a saving throws section with +ME +PE

  console.log("combineBonuses", rowIds, destinationPrefix);

  await repeatingAbsoluteAttributes(rowIds, destinationPrefix);

  await repeatingStringConcatAsync({
    destinations: [
      `${destinationPrefix}_damage`,
      `${destinationPrefix}_damage_range`,
    ],
    section: "bonuses",
    fields: ["damage", "damage_range"],
    filter: rowIds,
  });

  const pickBestFieldsBase = [
    "ar",
    "critical",
    "knockout",
    "deathblow",
    "mod_hf",
    "mod_character_ps_type",
  ];
  const pickBestDestinations = pickBestFieldsBase.map(
    (field) => `${destinationPrefix}_${field}`
  );
  const pickBestFields = pickBestFieldsBase;
  const core = await getAttrsAsync(["character_ps_type", "hf"]);
  await repeatingPickBestAsync({
    destinations: pickBestDestinations,
    section: "bonuses",
    fields: pickBestFields,
    defaultValues: [0, 20, 0, 0, core.hf, core.character_ps_type],
    ranks: ["high", "low", "low", "low", "high", "high"],
    filter: rowIds,
  });

  const noAttributeBonusFields = [
    // "hp",
    // "sdc",
    // "mdc",
    // "ppe",
    // "isp",
    "attacks",
    "initiative",
    "pull",
    "roll",
    "strike_range",
    "strike_range_single",
    "strike_range_burst",
    "strike_range_aimed",
    "strike_range_called",
    "disarm_range",
  ];
  // No attribute bonuses.
  await repeatingSumAsync(
    noAttributeBonusFields.map((field) => `${destinationPrefix}_${field}`),
    "bonuses",
    noAttributeBonusFields,
    `filter:${rowIds.toString()}`
  );
  await addStrikeRangeToCombinedAsync(destinationPrefix);

  await repeatingSumAsync(
    [`${destinationPrefix}_hp`],
    "bonuses",
    ["hp"],
    `filter:${rowIds.toString()}`,
    "character_hp"
  );

  await repeatingSumAsync(
    [`${destinationPrefix}_sdc`],
    "bonuses",
    ["sdc"],
    `filter:${rowIds.toString()}`,
    "character_sdc"
  );

  await repeatingSumAsync(
    [`${destinationPrefix}_mdc`],
    "bonuses",
    ["mdc"],
    `filter:${rowIds.toString()}`,
    "character_mdc"
  );

  await repeatingSumAsync(
    [`${destinationPrefix}_ppe`],
    "bonuses",
    ["ppe"],
    `filter:${rowIds.toString()}`,
    "character_ppe"
  );

  await repeatingSumAsync(
    [`${destinationPrefix}_isp`],
    "bonuses",
    ["isp"],
    `filter:${rowIds.toString()}`,
    "character_isp"
  );

  const ppBonusFields = [
    "strike",
    "parry",
    "dodge",
    "throw",
    "disarm",
    "entangle",
    "dodge_flight",
    "dodge_auto",
    "dodge_teleport",
    "dodge_motion",
    "flipthrow",
  ];
  await repeatingSumAsync(
    ppBonusFields.map((field) => `${destinationPrefix}_${field}`),
    "bonuses",
    ppBonusFields,
    `filter:${rowIds.toString()}`,
    "pp_bonus"
  );

  // Saving Throws
  Object.entries(SAVE_KEYS_ATTRIBUTE_BONUSES).forEach(
    async ([attributeBonus, saves]) => {
      const destinations = saves.map((save) => `${destinationPrefix}_${save}`);
      const section = "bonuses";
      const fields = saves;
      await repeatingSumAsync(
        destinations,
        section,
        fields,
        `filter:${rowIds.toString()}`,
        attributeBonus
      );
    }
  );
}

async function removeBonusSelectionsRowAsync(bonusRowId) {
  const a = await getAttrsAsync([
    `repeating_bonuses_${bonusRowId}_selection_id`,
  ]);
  removeRepeatingRow(
    `repeating_bonusselections_${
      a[`repeating_bonuses_${bonusRowId}_selection_id`]
    }`
  );
}

async function removeBonusRowsAsync(bonusRowId) {
  await removeBonusSelectionsRowAsync(bonusRowId);
  removeRepeatingRow(`repeating_bonuses_${bonusRowId}`);
}

on("remove:repeating_wp remove:repeating_wpmodern", async (e) => {
  console.log("remove wp", e);
  // const [r, section, rowId] = e.sourceAttribute.split('_');
  const bonusRowId = e.removedInfo[`${e.sourceAttribute}_bonus_id`];
  await removeBonusRowsAsync(bonusRowId);
});

async function outputSelectedBonusIds() {
  const bonusselectionsIds = await getSectionIDsAsync("bonusselections");
  const checkboxNames = bonusselectionsIds.map(
    (id) => `repeating_bonusselections_${id}_enabled`
  );
  const bonusIdNames = bonusselectionsIds.map(
    (id) => `repeating_bonusselections_${id}_bonus_id`
  );
  const attrNames = checkboxNames.concat(bonusIdNames);
  const a = await getAttrsAsync(attrNames);
  const bonusRowIds = bonusselectionsIds.reduce((acc, id) => {
    const prefix = `repeating_bonusselections_${id}`;
    if (Boolean(Number(a[`${prefix}_enabled`])) == true) {
      acc.push(a[`${prefix}_bonus_id`]);
    }
    return acc;
  }, []);
  await setAttrsAsync({ bonus_ids_output: bonusRowIds.toString() });
}

on("change:repeating_bonusselections:enabled", async (e) => {
  console.log("change:repeating_bonusselections:enabled", e);
  await outputSelectedBonusIds();
});

async function insertSelection(name, bonusRowId) {
  console.log("insertSelection", name, bonusRowId);
  const selectionRowId = generateRowID();
  const attrs = {};
  attrs[`repeating_bonusselections_${selectionRowId}_bonus_id`] = bonusRowId;
  attrs[`repeating_bonusselections_${selectionRowId}_name`] = name;
  attrs[`repeating_bonuses_${bonusRowId}_selection_id`] = selectionRowId;
  console.log(attrs);
  await setAttrsAsync(attrs);
}

async function updateSelection(name, selectionRowId) {
  console.log("updateSelection", name, selectionRowId);
  const attrs = {};
  attrs[`repeating_bonusselections_${selectionRowId}_name`] = name;
  await setAttrsAsync(attrs);
}

on("change:repeating_bonuses:name", async (e) => {
  console.log("change:repeating_bonuses:name", e);
  const [r, section, rowId] = e.sourceAttribute.split("_");
  const selectionIdKey = `repeating_bonuses_${rowId}_selection_id`;
  const a = await getAttrsAsync([selectionIdKey]);
  console.log(a);
  if (a[selectionIdKey]) {
    await updateSelection(e.newValue, a[selectionIdKey]);
  } else {
    await insertSelection(e.newValue, rowId);
  }
});

on("change:repeating_profiles:name", async (e) => {
  console.log("change:repeating_profiles:name", e);
  const [r, section, rowId] = e.sourceAttribute.split("_");
  await setAttrsAsync({
    repeating_profiles_rowid: `${r}_${section}_${rowId}_`,
  });
});

on("change:repeating_profiles:mod_iq", async (e) => {
  console.log("change:repeating_profiles:mod_iq", e);
  const [r, section, rowId] = e.sourceAttribute.split("_");
  await iqBonus(e.newValue, `${r}_${section}_${rowId}_mod_`);
});

on(
  "change:repeating_profiles:mod_me \
  change:repeating_profiles:mod_pp \
  change:repeating_profiles:mod_pe",
  async (e) => {
    await mePpPeBonus(e.sourceAttribute, e.newValue);
  }
);

on("change:repeating_profiles:mod_ma", async (e) => {
  console.log("change:repeating_profiles:mod_ma", e);
  const [r, section, rowId] = e.sourceAttribute.split("_");
  await maBonus(e.newValue, `${r}_${section}_${rowId}_mod_`);
});

on(
  "change:repeating_profiles:mod_ps \
  change:repeating_profiles:mod_character_ps_type",
  async (e) => {
    console.log("change:repeating_profiles:mod_ps", e);
    const [r, section, rowId] = e.sourceAttribute.split("_");
    await psBonus(`${r}_${section}_${rowId}_mod_`);
  }
);

on("change:repeating_profiles:mod_pb", async (e) => {
  console.log("change:repeating_profiles:mod_pb", e);
  const [r, section, rowId] = e.sourceAttribute.split("_");
  await pbBonus(e.newValue, `${r}_${section}_${rowId}_mod_`);
});

  /* endinject */

  /* inject:js/wps.js */
  async function addWpToBonuses(section, rowId, wpName) {
  console.log("addWpToBonuses", section, rowId);
  if (!section || !rowId || !wpName) {
    return;
  }
  const wpActions = WP_KEYS[section];
  const wpAttrs = wpActions.map(
    (action) => `repeating_${section}_${rowId}_${action}`
  );
  const wpCombatId = `repeating_${section}_${rowId}_bonus_id`;
  wpAttrs.push(wpCombatId);
  const a = await getAttrsAsync(wpAttrs);
  const attrs = {};
  let combatRowId;
  if (a[wpCombatId]) {
    combatRowId = a[wpCombatId];
  } else {
    combatRowId = generateRowID();
    attrs[wpCombatId] = combatRowId;
  }
  REPEATING_BONUS_KEYS.forEach((key) => {
    attrs[`repeating_bonuses_${combatRowId}_${key}`] =
      a[`repeating_${section}_${rowId}_${key}`] || 0;
  });
  await setAttrsAsync(attrs);
}

async function setWpRow(section, name, keyPrefix, level) {
  console.log("setWpRow", name, keyPrefix, level);
  const attrs = {};
  const levelBonuses = WP[name.toLowerCase()].slice(0, level);
  const totalBonuses = mergeAndAddObjects(levelBonuses);
  WP_KEYS[section].forEach((action) => {
    if (action == "name") return; // kick out on name
    const key = `${keyPrefix}_${action}`;
    attrs[key] = action in totalBonuses ? totalBonuses[action] : 0;
  });
  attrs[`${keyPrefix}_level`] = level;
  await setAttrsAsync(attrs);
}

async function setWp({
  section,
  wpName,
  newCharacterLevel,
  oldCharacterLevel,
  newWpLevel,
  rowId,
}) {
  console.log("setWp", {
    section,
    wpName,
    newCharacterLevel,
    oldCharacterLevel,
    newWpLevel,
    rowId,
  });
  const keyPrefix = rowId
    ? `repeating_${section}_${rowId}`
    : `repeating_${section}`;
  if (newWpLevel) {
    await setWpRow(section, wpName, keyPrefix, newWpLevel);
  } else if (!rowId) {
    await setWpRow(section, wpName, keyPrefix, newCharacterLevel);
  } else {
    const a = await getAttrsAsync([`${keyPrefix}_level`]);
    const oldWpLevel = a[`${keyPrefix}_level`];
    if (oldCharacterLevel) {
      const delta = oldCharacterLevel - oldWpLevel;
      if (delta != 0) {
        newWpLevel = newCharacterLevel - delta;
        await setWpRow(section, wpName, keyPrefix, newWpLevel);
      } else {
        await setWpRow(section, wpName, keyPrefix, newCharacterLevel);
      }
    } else {
      await setWpRow(section, wpName, keyPrefix, newCharacterLevel);
    }
  }
}

async function updateWeaponProficiencies(
  section,
  newCharacterLevel,
  oldCharacterLevel
) {
  const ids = await getSectionIDsAsync(section);
  const attrNames = ids.map((id) => `repeating_${section}_${id}_name`);
  const a = await getAttrsAsync(attrNames);
  for (rowId of ids) {
    await setWp({
      section,
      wpName: a[`repeating_${section}_${rowId}_name`].toLowerCase(),
      newCharacterLevel,
      oldCharacterLevel,
      rowId,
    });
  }
}

async function updateWeaponProficiency(section, source, newWpLevel) {
  const ids = await getSectionIDsAsync(section);
  const rowId = ids.find(
    (id) => `repeating_${section}_${id}_level`.toLowerCase() == source
  );
  const a = await getAttrsAsync([`repeating_${section}_${rowId}_name`]);
  const wpName = a[`repeating_${section}_${rowId}_name`];
  await setWp({ section, wpName, newWpLevel, rowId });
  await addWpToBonuses(section, rowId, wpName);
}

on("change:repeating_wp:level change:repeating_wpmodern:level", async (e) => {
  const section = e.sourceAttribute.split("_")[1];
  await updateWeaponProficiency(section, e.sourceAttribute, e.newValue);
});

on("change:repeating_wp:name change:repeating_wpmodern:name", async (e) => {
  console.log("change:repeating_wp:name change:repeating_wpmodern:name", e);
  const [r, section, rowId, attr] = e.sourceAttribute.split("_");
  const wpName = e.newValue.toLowerCase();
  const wpLevelKey = `${r}_${section}_${rowId}_level`;
  setAttrs({ [`${r}_${section}_${rowId}_rowid`]: `${r}_${section}_${rowId}` });
  const a = await getAttrsAsync(["character_level", wpLevelKey]);
  if (Boolean(a[wpLevelKey]) && +a[wpLevelKey] != 0) {
    await setWp({ section, wpName, rowId, newWpLevel: a[wpLevelKey] });
    await addWpToBonuses(section, rowId, wpName);
  } else {
    const attrs = {};
    attrs[`${r}_${section}_${rowId}_level`] = a.character_level;
    await setAttrsAsync(attrs);
  }
});

  /* endinject */

  /* inject:js/modifiers.js */
  /**
 * User adds a thing to repeating_modifiers
 * -> addModifierToBonuses
 * -> triggers "change:repeating_bonuses:name"
 * -> addBonusToSelections
 */

async function addModifierToBonusesAsync(section, rowId) {
  console.log("addModifierToBonusesAsync", section, rowId);
  if (!section || !rowId) {
    return;
  }

  const thingBonusId = `repeating_${section}_${rowId}_bonus_id`;
  const thingAttrs = REPEATING_BONUS_KEYS.map(
    (key) => `repeating_${section}_${rowId}_${key}`
  );
  thingAttrs.push(thingBonusId);
  const a = await getAttrsAsync(thingAttrs);
  console.log(a);
  const attrs = {};
  let bonusRowId;
  if (a[thingBonusId]) {
    bonusRowId = a[thingBonusId];
  } else {
    bonusRowId = generateRowID();
    attrs[thingBonusId] = bonusRowId;
  }
  REPEATING_BONUS_KEYS.forEach((key) => {
    attrs[`repeating_bonuses_${bonusRowId}_${key}`] =
      a[`repeating_${section}_${rowId}_${key}`] || 0;
  });
  await setAttrsAsync(attrs);
}

on(
  "change:repeating_modifiers \
  change:repeating_powersabilities \
  change:repeating_magic \
  change:repeating_psionics",
  async (e) => {
    console.log("change:repeating_modifiers", e);
    const sourceParts = e.sourceAttribute.split("_");
    if (
      e.sourceAttribute.endsWith("_bonus_id") ||
      e.sourceAttribute.endsWith("_rowid") ||
      e.sourceAttribute.endsWith("_addtobonuses") ||
      sourceParts.length < 4
    ) {
      return;
    }
    const [r, section, rowId] = sourceParts;
    await setAttrsAsync({
      [`${r}_${section}_rowid`]: `${r}_${section}_${rowId}_`,
    });
    if (section == "modifiers") {
      await addModifierToBonusesAsync(section, rowId);
    } else {
      const addToBonusesKey = `${r}_${section}_${rowId}_addtobonuses`;
      const a = await getAttrsAsync([addToBonusesKey]);
      const addToBonuses = Boolean(Number(a[addToBonusesKey]));
      if (addToBonuses) {
        await addModifierToBonusesAsync(section, rowId);
      }
    }
  }
);

on(
  "remove:repeating_modifiers \
  remove:repeating_powersabilities \
  remove:repeating_magic \
  remove:repeating_psionics",
  async (e) => {
    console.log("remove:repeating_modifiers", e);
    // remove repeating_bonusselections row with the same index
    const bonusRowId = e.removedInfo[`${e.sourceAttribute}_bonus_id`];
    await removeBonusRowsAsync(bonusRowId);
  }
);

  /* endinject */

  /* inject:js/profiles.js */
  async function updateProfile(rowId) {
  const bonusIds = (
    await getAttrsAsync(["repeating_profiles_bonus_ids"])
  ).repeating_profiles_bonus_ids.split(",");
  console.log(bonusIds);
  const bonusNameKeys = bonusIds.map((id) => `repeating_bonuses_${id}_name`);
  const a = await getAttrsAsync(bonusNameKeys);
  const names = Object.values(a).reduce(
    // using Em Space https://www.compart.com/en/unicode/U+2003
    (acc, cur) => `${acc}     ✔︎${cur}`.trim(),
    ""
  );
  await setAttrsAsync({
    [`repeating_profiles_${rowId}_bonus_names`]: names,
    [`repeating_profiles_${rowId}_rowid`]: `repeating_profiles_${rowId}_`,
  });
  await combineBonuses(bonusIds, `repeating_profiles_${rowId}`);
}

on("clicked:repeating_profiles:copybonusids", async (e) => {
  console.log("clicked:copybonusids", e);
  const a = await getAttrsAsync(["bonus_ids_output"]);
  const attrs = {};
  attrs[`repeating_profiles_bonus_ids`] = a.bonus_ids_output;
  await setAttrsAsync(attrs);
});

on(
  "clicked:repeating_profiles:updateprofile change:repeating_profiles:bonus_ids",
  async (e) => {
    console.log("clicked:repeating_profiles:updateprofile", e);
    const [r, section, rowId] = e.sourceAttribute.split("_");
    await updateProfile(rowId);
  }
);

  /* endinject */

  /* inject:js/attributes.js */
  async function iqBonus(value, prefix = "") {
  console.log("iqBonus", value, prefix);
  const iq_bonus = value > 15 ? value - 14 : 0;
  const perception_bonus = getBiAttributeBonus(value);
  const attrs = {
    [`${prefix}iq_bonus`]: iq_bonus,
    [`${prefix}perception_bonus`]: perception_bonus,
  };
  console.log(attrs);
  await setAttrsAsync(attrs);

  // this should check and only get called if the default (top) profile changes
  const profilesSections = await getSectionIDsOrderedAsync("profiles");
  if (!profilesSections || prefix.includes(profilesSections[0])) {
    await updateSkills();
  }
}

async function mePpPeBonus(attribute, value, prefix = "") {
  console.log("mePpPeBonus", attribute, value, prefix);
  const bonus = getBiAttributeBonus(value);
  const attrs = {};
  attrs[`${prefix}${attribute}_bonus`] = bonus;
  if (attribute.endsWith("pe")) {
    attrs[`${prefix}pe_coma_bonus`] =
      value >= 16
        ? value <= 18
          ? 4 + (value - 16)
          : value <= 30
          ? 8 + (value - 19) * 2
          : 30 + (value - 30)
        : 0;
    attrs[`${prefix}run_at_max`] = Math.round(value / 2);
  }
  console.log(attrs);
  await setAttrsAsync(attrs);
}

async function maBonus(value, prefix = "") {
  const ma_bonus =
    value >= 16
      ? value <= 24
        ? 40 + (value - 16) * 5
        : value <= 27
        ? 80 + (value - 24) * 4
        : value <= 29
        ? 92 + (value - 27) * 2
        : 97
      : 0;
  setAttrs({
    [`${prefix}ma_bonus`]: ma_bonus,
    [`${prefix}trust_intimidate`]: ma_bonus,
  });
}

async function psBonus(prefix = "") {
  const a = await getAttrsAsync([
    `${prefix}ps`,
    `${prefix}character_ps_type`,
    `${prefix}pe`,
  ]);
  const ps = +a[`${prefix}ps`];
  const pe = +a[`${prefix}pe`];
  const ps_type = a[`${prefix}character_ps_type`];
  const ps_bonus = ps > 15 ? ps - 15 : 0;

  let restrained_punch = (punch = power_punch = kick = leap_kick = "");
  let restrained_punch_unit =
    (punch_unit =
    power_punch_unit =
    kick_unit =
    leap_kick_unit =
      "sdc");

  let carry = ps < 17 ? ps * 10 : ps * 20;
  let lift = carry * 2;
  let hold_max = Math.round((pe * 3) / 15);
  let throw_distance = ps;

  switch (ps_type) {
    case "1": // normal
      punch = "1D4";
      kick = "1D4";
      break;
    case "2": // augmented
      throw_distance = ps * 2;
      if (ps < 24) {
        // nop
      } else if (ps == 24) {
        power_punch = "1";
        power_punch_unit = "mdc";
      } else if (ps <= 27) {
        power_punch = "1D4";
        power_punch_unit = "mdc";
      } else if (ps <= 30) {
        power_punch = "1D6";
        power_punch_unit = "mdc";
      } else if (ps <= 40) {
        power_punch = "2D4";
        power_punch_unit = "mdc";
      } else if (ps <= 50) {
        restrained_punch = "3D6";
        punch = "1D4";
        punch_unit = "mdc";
        power_punch = "3D4";
        power_punch_unit = "mdc";
      } else {
        restrained_punch = "4D6";
        punch = "1D8";
        punch_unit = "mdc";
        power_punch = "4D4";
        power_punch_unit = "mdc";
      }
      break;
    case "3": // robotic
    case "3.5": // giant robotic
      if (ps >= 17) {
        if (ps_type == "3") {
          lift = carry = ps * 25;
        } else {
          lift = carry = ps * 100;
        }
      }
      hold_max = 0;
      throw_distance = ps * 3;
      if (ps <= 15) {
        restrained_punch = "1D6";
        punch = "2D6";
        power_punch = "4D6";
        kick = "2D6";
        leap_kick = "3D6";
      } else if (ps <= 20) {
        restrained_punch = "2D6";
        punch = "1";
        power_punch = "1D6";
        kick = "1D4";
        leap_kick = "2D4";
        punch_unit = power_punch_unit = kick_unit = leap_kick_unit = "mdc";
      } else if (ps <= 25) {
        restrained_punch = "6D6";
        punch = "1D4";
        power_punch = "2D4";
        kick = "1D6";
        leap_kick = "2D6";
        punch_unit = power_punch_unit = kick_unit = leap_kick_unit = "mdc";
      } else if (ps <= 30) {
        restrained_punch = "1D4";
        punch = "1D6";
        power_punch = "2D6";
        kick = "2D4";
        leap_kick = "2D8";
        restrained_punch_unit =
          punch_unit =
          power_punch_unit =
          kick_unit =
          leap_kick_unit =
            "mdc";
      } else if (ps <= 35) {
        restrained_punch = "1D4";
        punch = "2D4";
        power_punch = "4D4";
        kick = "2D8";
        leap_kick = "4D8";
        restrained_punch_unit =
          punch_unit =
          power_punch_unit =
          kick_unit =
          leap_kick_unit =
            "mdc";
      } else if (ps <= 40) {
        restrained_punch = "1D4";
        punch = "2D6";
        power_punch = "4D6";
        kick = "3D8";
        leap_kick = "5D8";
        restrained_punch_unit =
          punch_unit =
          power_punch_unit =
          kick_unit =
          leap_kick_unit =
            "mdc";
      } else if (ps <= 50) {
        restrained_punch = "1D6";
        punch = "3D6";
        power_punch = "1D6*10";
        kick = "5D8";
        leap_kick = "1D8*10";
        restrained_punch_unit =
          punch_unit =
          power_punch_unit =
          kick_unit =
          leap_kick_unit =
            "mdc";
      } else {
        restrained_punch = "2D6";
        punch = "6D6";
        power_punch = "2D6*10";
        kick = "6D8";
        leap_kick = "2D6*10";
        restrained_punch_unit =
          punch_unit =
          power_punch_unit =
          kick_unit =
          leap_kick_unit =
            "mdc";
      }
      break;
    case "4": // supernatural
      if (ps >= 18) {
        carry = ps * 50;
      } else {
        carry = ps * 20;
      }
      lift = carry * 2;
      hold_max = pe * 4;
      if (ps <= 16) {
        throw_distance = ps * 3;
      } else {
        throw_distance = ps * 5;
      }
      if (ps <= 15) {
        restrained_punch = "1D6";
        punch = "4D6";
        power_punch = "1D4";
        power_punch_unit = "mdc";
      } else if (ps <= 20) {
        restrained_punch = "3D6";
        punch = "1D6";
        power_punch = "2D6";
        punch_unit = power_punch_unit = "mdc";
      } else if (ps <= 25) {
        restrained_punch = "4D6";
        punch = "2D6";
        power_punch = "4D6";
        punch_unit = power_punch_unit = "mdc";
      } else if (ps <= 30) {
        restrained_punch = "5D6";
        punch = "3D6";
        power_punch = "6D6";
        punch_unit = power_punch_unit = "mdc";
      } else if (ps <= 35) {
        restrained_punch = "5D6";
        punch = "4D6";
        power_punch = "1D4*10";
        punch_unit = power_punch_unit = "mdc";
      } else if (ps <= 40) {
        restrained_punch = "6D6";
        punch = "5D6";
        power_punch = "1D6*10";
        punch_unit = power_punch_unit = "mdc";
      } else if (ps <= 50) {
        restrained_punch = "1D6*10";
        punch = "6D6";
        power_punch = "2D4*10";
        punch_unit = power_punch_unit = "mdc";
      } else if (ps <= 60) {
        restrained_punch = "1D6";
        punch = "1D6*10";
        power_punch = "2D6*10";
        restrained_punch_unit = punch_unit = power_punch_unit = "mdc";
      } else {
        // > 60
        const extra = Math.ceil((ps - 60) / 10) * 10;
        restrained_punch = "1D6";
        punch = `1D6*10+${extra}`;
        power_punch = `2D6*10+${extra * 2}`;
        restrained_punch_unit = punch_unit = power_punch_unit = "mdc";
      }
      break;
  }
  const attrs = {
    [`${prefix}ps_bonus`]: ps_bonus,
    [`${prefix}restrained_punch`]: restrained_punch,
    [`${prefix}punch`]: punch,
    [`${prefix}power_punch`]: power_punch,
    [`${prefix}kick`]: kick,
    [`${prefix}leap_kick`]: leap_kick,
    [`${prefix}restrained_punch_unit`]: restrained_punch_unit,
    [`${prefix}punch_unit`]: punch_unit,
    [`${prefix}power_punch_unit`]: power_punch_unit,
    [`${prefix}kick_unit`]: kick_unit,
    [`${prefix}leap_kick_unit`]: leap_kick_unit,
    [`${prefix}lift`]: lift,
    [`${prefix}carry`]: carry,
    [`${prefix}hold_max`]: hold_max,
    [`${prefix}throw_distance`]: throw_distance,
  };
  console.log(attrs);
  await setAttrsAsync(attrs);
}

async function pbBonus(value, prefix = "") {
  const pb_bonus =
    value >= 16
      ? value <= 26
        ? 30 + (value - 16) * 5
        : value <= 28
        ? 80 + (value - 26) * 3
        : value == 29
        ? 90
        : 92
      : 0;
  await setAttrsAsync({
    [`${prefix}pb_bonus`]: pb_bonus,
    [`${prefix}charm_impress`]: pb_bonus,
  });
}

async function spdBonus(value) {
  const orderedSectionIds = await getSectionIDsOrderedAsync("profiles");
  const a = await getAttrsAsync([
    `repeating_profiles_${orderedSectionIds[0]}_attacks`,
  ]);
  const feetPerMelee = value * 15;
  const attrs = {
    run_mph: ((feetPerMelee * 4 * 60) / 5280).toFixed(1),
    run_ft_melee: feetPerMelee,
    run_ft_attack: Math.round(
      feetPerMelee / a[`repeating_profiles_${orderedSectionIds[0]}_attacks`]
    ),
  };
  await setAttrsAsync(attrs);
}

on("change:iq", async (e) => {
  await iqBonus(e.newValue);
});

on("change:me change:pp change:pe", async (e) => {
  await mePpPeBonus(e.sourceAttribute, e.newValue);
});

on("change:ma", async (e) => {
  await maBonus(e.newValue);
});

on("change:ps change:character_ps_type", async (e) => {
  await psBonus();
});

on("change:pb", async (e) => {
  await pbBonus(e.newValue);
});

on("change:spd", async (e) => {
  await spdBonus(e.newValue);
});

  /* endinject */

  /* inject:js/skills.js */
  async function updateSkill(rowId, iqBonusKey = "iq_bonus") {
  const row = `repeating_skills_${rowId}`;
  const skillAttrs = SKILL_KEYS.map((key) => `${row}_${key}`);
  console.log(skillAttrs);
  const a = await getAttrsAsync(skillAttrs.concat([iqBonusKey]));
  console.log(a);
  const attrs = {};
  const total =
    +a[`${row}_base`] +
    +a[iqBonusKey] +
    +a[`${row}_bonus`] +
    (+a[`${row}_level`] - 1) * +a[`${row}_perlevel`];
  console.log(total);
  attrs[`${row}_total`] = total;
  await setAttrsAsync(attrs);
}

async function updateSkills() {
  const ids = await getSectionIDsAsync("skills");
  for (const id of ids) {
    await updateSkill(id);
  }
}

async function updateSkillLevels(newCharacterLevel, oldCharacterLevel) {
  const delta = newCharacterLevel - oldCharacterLevel;
  const ids = await getSectionIDsAsync("skills");
  const attrNames = ids.map((id) => `repeating_skills_${id}_level`);
  const a = await getAttrsAsync(attrNames);
  const attrs = {};
  ids.forEach((id) => {
    attrs[`repeating_skills_${id}_level`] =
      +a[`repeating_skills_${id}_level`] + delta;
  });
  await setAttrsAsync(attrs);
}

on("change:repeating_skills", async (e) => {
  console.log("change:repeating_skills", e);
  if (e.sourceAttribute.endsWith("_name")) return;
  const sourceParts = e.sourceAttribute.split("_");
  // Return if no attribute is changed and it's the row itself
  if (sourceParts.length < 4) return;
  const [r, section, rowId] = sourceParts;
  await updateSkill(rowId);
});

on("change:repeating_skills:name", async (e) => {
  const [r, section, rowId, attr] = e.sourceAttribute.split("_");
  const a = await getAttrsAsync(["character_level"]);
  console.log(a);
  const attrs = {
    [`${r}_${section}_${rowId}_level`]: a.character_level,
    [`${r}_${section}_${rowId}_rowid`]: `repeating_${section}_${rowId}`,
  };
  console.log(attrs);
  await setAttrsAsync(attrs);
});

  /* endinject */

  /* inject:js/magic_psionics_abilities.js */
  on("clicked:repeating_magic:usespell", async (e) => {
  console.log(e);
  const a = await getAttrsAsync(["repeating_magic_ppecost", "currentppe"]);
  console.log(a);
  await setAttrsAsync({ currentppe: a.currentppe - a.repeating_magic_ppecost });
});

on("clicked:resetppe", async (e) => {
  console.log(e);
  const sectionIds = await getSectionIDsOrderedAsync("profiles");
  const attrs = [`repeating_profiles_${sectionIds[0]}_ppe`];
  const a = await getAttrsAsync(attrs);
  await setAttrsAsync({
    currentppe: +a[`repeating_profiles_${sectionIds[0]}_ppe`],
  });
});

on("clicked:repeating_psionics:usepsionic", async (e) => {
  console.log(e);
  const a = await getAttrsAsync(["repeating_psionics_ispcost", "currentisp"]);
  console.log(a);
  await setAttrsAsync({
    currentisp: a.currentisp - a.repeating_psionics_ispcost,
  });
});

on("clicked:resetisp", async (e) => {
  console.log(e);
  const sectionIds = await getSectionIDsOrderedAsync("profiles");
  const attrs = [`repeating_profiles_${sectionIds[0]}_isp`];
  const a = await getAttrsAsync(attrs);
  await setAttrsAsync({
    currentisp: +a[`repeating_profiles_${sectionIds[0]}_isp`],
  });
});

async function calculateRangeDuration(row) {
  console.log("calculateRangeDuration", row);
  const attrNames = ["starting", "per_level", "unit"].map(
    (subProp) => `${row}_${subProp}`
  );
  console.log(attrNames);
  const a = await getAttrsAsync(attrNames.concat(["character_level"]));
  console.log(a);
  const value =
    +a[`${row}_starting`] + (+a.character_level - 1) * +a[`${row}_per_level`];
  const unit = a[`${row}_unit`];
  const valueWithUnits = `${value} ${unit}`;
  await setAttrsAsync({ [row]: valueWithUnits });
}

async function calculatePercentage(row) {
  const attrNames = ["starting", "per_level"].map(
    (subProp) => `${row}_${subProp}`
  );
  const a = await getAttrsAsync(attrNames.concat(["character_level"]));
  console.log(a);
  const value =
    +a[`${row}_starting`] + (+a.character_level - 1) * +a[`${row}_per_level`];
  await setAttrsAsync({ [row]: value });
}

async function calculateDamage(row) {
  const attrNames = ["starting", "per_level", "unit"].map(
    (subProp) => `${row}_${subProp}`
  );
  const a = await getAttrsAsync(attrNames.concat(["character_level"]));
  console.log(a);
  const perLevel = a[`${row}_per_level`];
  const repeats = perLevel ? `+${perLevel}`.repeat(a.character_level - 1) : "";
  const value = `${a[`${row}_starting`]}${repeats}`;
  await setAttrsAsync({ [row]: value });
}

async function updateMagicPsionicsLevels() {
  for (const section of ABILITIES_REPEATERS) {
    const ids = await getSectionIDsAsync(section);
    for (const id of ids) {
      const row = `repeating_${section}_${id}`;
      console.log("updateMagicPsionicsLevels", row);
      await calculateDamage(`${row}_damage`);
      await calculatePercentage(`${row}_percentage`);
      await calculateRangeDuration(`${row}_range`);
      await calculateRangeDuration(`${row}_duration`);
    }
  }
}

const nameListeners = ABILITIES_REPEATERS.map(
  (repeater) => `change:repeating_${repeater}:name`
).join(" ");

const damageListeners = ABILITIES_REPEATERS.reduce((acc, cur) => {
  acc.push(`change:repeating_${cur}:damage_starting`);
  acc.push(`change:repeating_${cur}:damage_unit`);
  acc.push(`change:repeating_${cur}:damage_per_level`);
  return acc;
}, []).join(" ");

const percentageListeners = ABILITIES_REPEATERS.reduce((acc, cur) => {
  acc.push(`change:repeating_${cur}:percentage_starting`);
  acc.push(`change:repeating_${cur}:percentage_per_level`);
  return acc;
}, []).join(" ");

const rangeDurationFrequencyDcListeners = ABILITIES_REPEATERS.reduce(
  (acc, cur) => {
    ["range", "duration", "frequency", "dc"].forEach((property) => {
      acc.push(`change:repeating_${cur}:${property}_starting`);
      acc.push(`change:repeating_${cur}:${property}_unit`);
      acc.push(`change:repeating_${cur}:${property}_per_level`);
    });
    return acc;
  },
  []
).join(" ");

on(damageListeners, async (e) => {
  console.log(e);
  const [r, section, rowId] = e.sourceAttribute.split("_");
  const row = `${r}_${section}_${rowId}_damage`;
  await calculateDamage(row);
});

on(percentageListeners, async (e) => {
  console.log(e);
  const [r, section, rowId] = e.sourceAttribute.split("_");
  const row = `${r}_${section}_${rowId}_percentage`;
  await calculatePercentage(row);
});

on(rangeDurationFrequencyDcListeners, async (e) => {
  console.log(e);
  const [r, section, rowId, property] = e.sourceAttribute.split("_");
  const row = `${r}_${section}_${rowId}_${property}`;
  await calculateRangeDuration(row);
});

on(nameListeners, async (e) => {
  const [r, section, rowId] = e.sourceAttribute.split("_");
  const attrs = {};
  attrs[`${r}_${section}_rowid`] = `${r}_${section}_${rowId}_`;
  await setAttrsAsync(attrs);
});

on(
  "change:repeating_powersabilities:addtobonuses \
  change:repeating_magic:addtobonuses \
  change:repeating_psionics:addtobonuses",
  async (e) => {
    console.log("change:repeating_powersabilities:addtobonuses", e);
    const [r, section, rowId] = e.sourceAttribute.split("_");
    const enabled = Boolean(Number(e.newValue));
    if (enabled) {
      addModifierToBonusesAsync(section, rowId);
    } else {
      const a = await getAttrsAsync([`${r}_${section}_${rowId}_bonus_id`]);
      await removeBonusRowsAsync(a[`${r}_${section}_${rowId}_bonus_id`]);
    }
  }
);

on(
  "change:repeating_powersabilities:dc \
  change:repeating_magic:dc \
  change:repeating_psionics:dc",
  async (e) => {
    const [r, section, rowId] = e.sourceAttribute.split("_");
    const prefix = `${r}_${section}_${rowId}`;
    const a = await getAttrsAsync([`${prefix}_dc_unit`]);
    const unit = a[`${prefix}_dc_unit`].toLowerCase();
    if (unit == "sdc" || unit == "mdc") {
      const value = parseInt(e.newValue);
      const attrs = { [`${prefix}_${unit}`]: value };
      await setAttrsAsync(attrs);
    }
  }
);

  /* endinject */

  /* inject:js/movement.js */
  on("change:repeating_movement:mph", async (e) => {
  console.log("change:repeating_movement:mph", e);
  const [r, section, rowId] = e.sourceAttribute.split("_");
  const orderedSectionIds = await getSectionIDsOrderedAsync("profiles");
  const a = await getAttrsAsync([
    `repeating_profiles_${orderedSectionIds[0]}_attacks`,
  ]);
  const feetPerMelee = Math.round((e.newValue * 5280) / 60 / 4);
  const attrs = {
    [`repeating_movement_${rowId}_ft_melee`]: feetPerMelee,
    [`repeating_movement_${rowId}_ft_attack`]: Math.round(
      feetPerMelee / a[`repeating_profiles_${orderedSectionIds[0]}_attacks`]
    ),
  };
  await setAttrsAsync(attrs);
});

on("change:repeating_movement:ft_melee", async (e) => {
  const [r, section, rowId] = e.sourceAttribute.split("_");
  const orderedSectionIds = await getSectionIDsOrderedAsync("profiles");
  const a = await getAttrsAsync([
    `repeating_profiles_${orderedSectionIds[0]}_attacks`,
  ]);
  const feetPerMelee = e.newValue;
  const mph = ((feetPerMelee * 4 * 60) / 5280).toFixed(1);
  const attrs = {
    [`repeating_movement_${rowId}_mph`]: mph,
    [`repeating_movement_${rowId}_ft_attack`]: Math.round(
      feetPerMelee / a[`repeating_profiles_${orderedSectionIds[0]}_attacks`]
    ),
  };
  await setAttrsAsync(attrs);
});

  /* endinject */

  /* inject:js/import_export.js */
  (function () {
  async function getRepeatingSectionArrayAsync(section, rowIds, attrNames) {
    let sectionArray = [];
    const attrs = await getAttrsAsync(attrNames);
    rowIds.forEach((rowId) => {
      const wpObj = Object.keys(attrs).reduce((acc, attr) => {
        if (attr.includes(rowId)) {
          acc[attr.replace(`repeating_${section}_${rowId}_`, "")] = attrs[attr];
        }
        return acc;
      }, {});
      sectionArray.push(wpObj);
    });
    return sectionArray;
  }

  async function getRepeatingRowsAsync(section) {
    const ids = await getSectionIDsAsync(section);
    const attrNames = ids.reduce((acc, id) => {
      SECTIONS[section].forEach((key) => {
        acc.push(`repeating_${section}_${id}_${key}`);
      });
      return acc;
    }, []);
    const repeatingSectionArray = await getRepeatingSectionArrayAsync(
      section,
      ids,
      attrNames
    );
    return repeatingSectionArray;
  }

  on("clicked:export", async (e) => {
    console.log("export", e);
    const attrs = {};
    attrs.wp = await getRepeatingRowsAsync("wp");
    attrs.wpmodern = await getRepeatingRowsAsync("wpmodern");
    attrs.skills = await getRepeatingRowsAsync("skills");
    attrs.magic = await getRepeatingRowsAsync("magic");
    attrs.psionics = await getRepeatingRowsAsync("psionics");
    attrs.movement = await getRepeatingRowsAsync("movement");
    attrs.powersabilities = await getRepeatingRowsAsync("powersabilities");
    attrs.modifiers = await getRepeatingRowsAsync("modifiers");
    // Profiles are tricky to export because IDs that they refer to won't line up
    // attrs.profiles = await getRepeatingRowsAsync("profiles");
    const coreAttrs = await getAttrsAsync(CORE_KEYS);
    Object.entries(coreAttrs).forEach(([key, val]) => (attrs[key] = val));
    await setAttrsAsync({ importexport: JSON.stringify(attrs, null, 2) });
  });

  async function setRepeatingRowsAsync(section, data) {
    console.log("setRepeatingRows", section, data);
    if (!data) return;
    console.log("continuing setRepeatingRows", section);
    const attrs = data.reduce((acc, row) => {
      const rowId = generateRowID();
      Object.entries(row).forEach(([key, val]) => {
        acc[`repeating_${section}_${rowId}_${key}`] = val;
      });
      return acc;
    }, {});
    await setAttrsAsync(attrs);
  }

  on("clicked:import", async (e) => {
    console.log("import", e);
    await setAttrsAsync({ importexportstatus: "Importing..." });
    const a = await getAttrsAsync(["importexport"]);
    const data = JSON.parse(a.importexport);
    console.log(data);
    await setRepeatingRowsAsync("wp", data.wp);
    delete data.wp;
    await setRepeatingRowsAsync("wpmodern", data.wpmodern);
    delete data.wpmodern;
    await setRepeatingRowsAsync("skills", data.skills);
    delete data.skills;
    await setRepeatingRowsAsync("magic", data.magic);
    delete data.magic;
    await setRepeatingRowsAsync("psionics", data.psionics);
    delete data.psionics;
    await setRepeatingRowsAsync("movement", data.movement);
    delete data.movement;
    await setRepeatingRowsAsync("powersabilities", data.powersabilities);
    delete data.powersabilities;
    await setRepeatingRowsAsync("modifiers", data.modifiers);
    delete data.modifiers;
    await setAttrsAsync(data);
    // Done isn't actually true until everything is using async and no more callbacks
    await setAttrsAsync({ importexportstatus: "Done Importing!" });
  });
})();

  /* endinject */

  /**
   * [] Add weight to abilities/magic/psionics
   * [] Pressing space when typing an ability name expands and collapses the Details panel
   * [] Removing Bonus Sources doesn't remove them from Selections
   * [x] Magic/... DC should populate S/MDC based on DC unit.
   * [x] Why are Abilities showing up on the Bonuses tab without Add to Bonuses being checked?
   * [x] PPE on Profiles needs to include primary. Reset PPE on Magic tabs needs to pull from default (1st) profile
   * [x] Removing Abilities doesn't seem to remove them from Bonus Sources
   *
   * [x] Add/update Instructions on every tab, then re-release.
   *
   * Add attributes, PS type, ISP, PPE, HP, SDC, MDC, etc. to Bonuses
   * [x] Allow for an "absolute" value
   * [x] Add additional field(s) to Profile for aggregate attribute bonuses
   * [] Use a "text" input and allow for values like `*2` or `/2`
   * Aggregate Logic:
   * - PS includes type
   * - HP, SDC, AR, MDC are grouped on their own Armor row w/ Name
   * - PPE, ISP are grouped on their own "Mana"? row w/ Name
   *
   * [] Have abilities/magic/psionics auto-calculate/populate MDC/SDC/HP/...
   * [x] Make things async
   *
   * @todo Armor tab / repeater; Armor checkboxes in Aggregate Bonuses, and Armor list (name, MDC) underneath
   *    Aggregate Bonuses checkboxes that show and hide based on the check
   *    - Magic and Psionics also provide armor. so you have to add the spell and then have a button to add it to the Armor tab
   *      Hitting "cast" should use up the PPE and check the checkbox. This should also apply to spell which have a duration and provide bonuses.
   *      Buttons: Cast | Cast and add to modifiers | Cast and add to armor
   * @todo add Ammo/Uses to Combat, Magic
   * @todo add import status - add an attribute and update count on each callback, or just once at the end indicating completion
   *
   * @todo Import isn't setting Skill level properly, probably because it's already "1"
   * @todo when Aggregate Attacks change, recalculate ft/attack fields
   *
   * Questions
   * - Paratrooper gets a save vs. Torture. What is this?
   *
   * @todo standardize/improve markup on Core tab
   *
   * @todo add an active combat section above Aggregate bonuses
   *    - track attacks
   *    - track ammo (roll20 has something for this)
   *    - track MDC - for each aggregate MDC modifier, track it separately in a repeater. allow the user to reorder, and deduct from bottom to top
   *
   * @todo combat row `level` needs to populate when `skill` does
   * @todo combat row `level` needs to adjust with Character level like WPs do
   *
   * @todo better better build process with imports/file modules
   *
   * To get Character ID, `getAttrs(["character_id"])`
   * */

  /**
   * This one could be a doozy
   * */
  on("change:character_level", async (e) => {
    console.log("change:character_level", e.newValue, e.previousValue);
    // Update WPs
    await updateWeaponProficiencies("wp", e.newValue, e.previousValue);
    await updateWeaponProficiencies("wpmodern", e.newValue, e.previousValue);
    await updateSkillLevels(+e.newValue, +e.previousValue);
    await updateMagicPsionicsLevels();
  });

  const buttonlist = [
    "core",
    "wp",
    "modifiers",
    "bonuses",
    "equipment",
    "skills",
    "magic",
    "psionics",
    "importexport",
    "powersabilities",
  ];
  buttonlist.forEach((button) => {
    on(`clicked:${button}`, function () {
      setAttrs({ sheetTab: button });
    });
  });
</script>
